function MersenneTwister(a){0==arguments.length&&(a=(new Date).getTime()),this._mt=new Array(624),this.setSeed(a)}!function(){"use strict"}();var tm=tm||{};tm.global=window||global||this,tm.global.tm=tm,"undefined"!=typeof module&&module.exports&&(module.exports=tm),function(){tm.VERSION="0.5.0",tm.LIB_ROOT=function(){if(window.document)for(var a=document.getElementsByTagName("script"),b=0,c=a.length;c>b;++b);}(),tm.BROWSER=function(){return window.navigator?/chrome/i.test(navigator.userAgent)?"Chrome":/safari/i.test(navigator.userAgent)?"Safari":/firefox/i.test(navigator.userAgent)?"Firefox":/opera/i.test(navigator.userAgent)?"Opera":/getcko/i.test(navigator.userAgent)?"Getcko":/msie/i.test(navigator.userAgent)?"IE":"":void 0}(),tm.VENDER_PREFIX=function(){if(window){var a={Chrome:"webkit",Safari:"webkit",Firefox:"moz",Opera:"o",IE:"ms"};return a[tm.BROWSER]||""}}(),tm.isMobile=function(){if(window.navigator){var a=navigator.userAgent;return a.indexOf("iPhone")>0||a.indexOf("iPad")>0||a.indexOf("Android")>0}}(),tm.isLocal=function(){var a="file:"==location.protocol;return function(){return a}}(),tm.createClass=function(a){a.init=a.init||function(){},a.superClass=a.superClass||null;var b=function(){var a=new b.prototype.creator;return b.prototype.init.apply(a,arguments),a};a.superClass&&(a.init.owner=b,b.prototype=Object.create(a.superClass.prototype),b.prototype.superInit=function(){var a=this.superInit.caller,b=a.owner,c=b.prototype.superClass,d=c.prototype.init;d.apply(this,arguments)},b.prototype.constructor=b),b.prototype.selfClass=b;for(var c in a)b.prototype[c]=a[c];return b.prototype.creator=function(){return this},b.prototype.creator.prototype=b.prototype,b._class=!0,b},tm.classes={};var _calssDefinedCallback={};tm.define=function(a,b){{var c=a.lastIndexOf("."),d=a.substring(0,c),e=d?tm.using(d):tm.global,f=d?a.substring(c+1):a;Function.prototype.bind,Array.prototype.unshift}b._path=a,b._className=f;var g=null,h=b.superClass;if(h&&"string"==typeof h){var i=h;if(h=tm.using(h),!h._class)return _calssDefinedCallback[i]||(_calssDefinedCallback[i]=[]),void _calssDefinedCallback[i].push(function(){tm.define(a,b)});b.superClass=h,g=tm.createClass(b)}else g=tm.createClass(b);if(e[f]=tm.classes[a]=g,_calssDefinedCallback[a]){for(var j=_calssDefinedCallback[a],k=0,l=j.length;l>k;++k)j[k]();delete _calssDefinedCallback[a]}return g},tm.namespace=function(a,b){var a=tm.using(a);b.call(a,a)},tm.using=function(a){if(tm.classes[a])return tm.classes[a];for(var b=a.split(/[,.\/ ]|::/),c=tm.global,d=0,e=b.length;e>d;++d){var f=b[d];c=c[f]||(c[f]={})}return tm.classes[a]=c,c},tm.globalize=function(){return tm.$forIn(function(a,b){"object"==typeof b&&"classes"!==a&&"global"!==a&&"event"!==a&&"dom"!==a&&b.$forIn(function(a,b){window[a]||(window[a]=b)})}),this},tm["import"]=function(a){var b=tm[a];return tm.global.$strict(b),this},tm.setLoop=function(a,b){var c=function(){var c=(new Date).getTime();a();var d=(new Date).getTime()-c,e=b-d;e=e>0?e:0,setTimeout(arguments.callee,e)};setTimeout(c,b)},tm.inform=function(parent){parent=parent||document.body;var eInfo=document.createElement("div");with(eInfo.setAttribute("class","tm-info"),eInfo.addEventListener("mouseover",function(){this.style.opacity=.9},!1),eInfo.addEventListener("mouseout",function(){this.style.opacity=.25},!1),eInfo.style)position="absolute",width="100%",bottom="0px",left="0px",right="0px",margin="0px",padding="10px 0px",zIndex="0",textAlign="center",fontFamily='"Meiryo", "メイリオ", "ヒラギノ角ゴ Pro W3", sans-serif',fontSize="13px",opacity="0.25",backgroundColor="rgb(230,230,255)",background="-webkit-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",background="-moz-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",WebkitTransition="1s",MozTransition="1s";eInfo.innerHTML="このプログラムで利用している JavaScript ライブラリ 『tmlib.js』 については<a href='{projectLink}'>こちら</a>.".format({projectLink:"https://github.com/phi1618/tmlib.js"}),parent.appendChild(eInfo)}}(),function(){window&&(window.requestAnimationFrame||(window.requestAnimationFrame=window[tm.VENDER_PREFIX+"RequestAnimationFrame"]||function(a){window.setTimeout(a,1e3/60)}),window.cancelRequestAnimationFrame||(window.cancelRequestAnimationFrame=window[tm.VENDER_PREFIX+"CancelRequestAnimationFrame"]||window.clearTimeout))}(),function(){if(window.document){var a=[];tm.main=function(c){c?a.push(c):b()};var b=function(){for(var b=0,c=a.length;c>b;++b)a[b]();a=[]};window.addEventListener("load",function(){b()},!1)}}(),function(){Object.defineProperty(Object.prototype,"defineVariable",{value:function(a,b){Object.defineProperty(this,a,{value:b,enumerable:!0,writable:!0})}}),Object.defineProperty(Object.prototype,"defineFunction",{value:function(a,b){Object.defineProperty(this,a,{value:b,enumerable:!1,writable:!0})}}),Object.prototype.defineFunction("defineInstanceVariable",function(a,b){Object.defineProperty(this.prototype,a,{value:b,enumerable:!0,writable:!0})}),Object.prototype.defineFunction("defineInstanceMethod",function(a,b){Object.defineProperty(this.prototype,a,{value:b,enumerable:!1,writable:!0})}),Object.defineInstanceMethod("setter",function(a,b){Object.defineProperty(this,a,{set:b,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("getter",function(a,b){Object.defineProperty(this,a,{get:b,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("accessor",function(a,b){Object.defineProperty(this,a,{set:b.set,get:b.get,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("$forIn",function(a,b){return b=b||this,Object.keys(this).forEach(function(c,d){var e=this[c];a.call(b,c,e,d)},this),this}),Object.defineInstanceMethod("$has",function(a){return this.hasOwnProperty(a)}),Object.defineInstanceMethod("$extend",function(){return Array.prototype.forEach.call(arguments,function(a){for(var b in a)this[b]=a[b]},this),this}),Object.defineInstanceMethod("$safe",function(){return Array.prototype.forEach.call(arguments,function(a){for(var b in a)void 0===this[b]&&(this[b]=a[b])},this),this}),Object.defineInstanceMethod("$strict",function(){return Array.prototype.forEach.call(arguments,function(a){for(var b in a)console.assert(!this[b],"tm error: {0} is Already".format(b)),this[b]=a[b]},this),this}),Object.defineInstanceMethod("$pick",function(){var a={};return Array.prototype.forEach.call(arguments,function(b){b in this&&(a[b]=this[b])},this),a}),Object.defineInstanceMethod("$omit",function(){var a={};for(var b in this)-1==Array.prototype.indexOf.call(arguments,b)&&(a[b]=this[b]);return a})}(),function(){Array.prototype.accessor("first",{get:function(){return this[0]},set:function(a){this[0]=a}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(a){this[this.length-1]=a}}),Array.defineInstanceMethod("equals",function(a){if(this.length!==a.length)return!1;for(var b=0,c=this.length;c>b;++b)if(this[b]!==a[b])return!1;return!0}),Array.defineInstanceMethod("deepEquals",function(a){if(this.length!==a.length)return!1;for(var b=0,c=this.length;c>b;++b){var d=this[b].deepEquals?this[b].deepEquals(a[b]):this[b]===a[b];if(d===!1)return!1}return!0}),Array.defineInstanceMethod("contains",function(a,b){return-1!=this.indexOf(a,b)}),Array.defineInstanceMethod("at",function(a){return a%=this.length,a+=this.length,a%=this.length,this[a]}),Array.defineInstanceMethod("swap",function(a,b){var c=this[a];return this[a]=this[b],this[b]=c,this}),Array.defineInstanceMethod("erase",function(a){var b=this.indexOf(a);return b>=0&&this.splice(b,1),this}),Array.defineInstanceMethod("eraseAll",function(a){for(var b=0,c=this.length;c>b;++b)this[b]==a&&this.splice(b--,1);return this}),Array.defineInstanceMethod("eraseIf",function(a){for(var b=0,c=this.length;c>b;++b)if(a(this[b],b,this)){this.splice(b,1);break}return this}),Array.defineInstanceMethod("eraseIfAll",function(a){for(var b=0,c=this.length;c>b;++b)a(this[b],b,this)&&this.splice(b,1);return this}),Array.defineInstanceMethod("random",function(a,b){return a=a||0,b=b||this.length-1,this[Math.rand(a,b)]}),Array.defineInstanceMethod("pickup",function(a,b){return a=a||0,b=b||this.length-1,this[Math.rand(a,b)]}),Array.defineInstanceMethod("uniq",function(){return this.filter(function(a,b,c){return c.indexOf(a)===b})}),Array.defineInstanceMethod("flatten",function(a){var b=null;if(a){b=this;for(var c=0;a>c;++c)b=Array.prototype.concat.apply([],b)}else b=this.reduce(function(a,b){return a.concat(Array.isArray(b)?b.flatten():b)},[]);return b}),Array.defineInstanceMethod("clone",function(a){if(1==a){for(var b=Array(this.length),c=0,d=this.length;d>c;++c)b[c]=this[c].clone?this[c].clone(a):this[c];return b}return Array.prototype.slice.apply(this)}),Array.defineInstanceMethod("clear",function(){return this.length=0,this}),Array.defineInstanceMethod("fill",function(a,b,c){b=b||0,c=c||this.length;for(var d=b;c>d;++d)this[d]=a;return this}),Array.defineInstanceMethod("range",function(a,b,c){if(1==arguments.length){this.clear();for(var d=0;a>d;++d)this[d]=d}else if(b>a){c=c||1,this.clear();for(var d=a,e=0;b>d;d+=c,++e)this[e]=d}else{c=c||-1,this.clear();for(var d=a,e=0;d>b;d+=c,++e)this[e]=d}return this}),Array.defineInstanceMethod("shuffle",function(){for(var a=0,b=this.length;b>a;++a){var c=Math.rand(0,b-1);a!=c&&this.swap(a,c)}return this}),Array.defineInstanceMethod("sum",function(){for(var a=0,b=0,c=this.length;c>b;++b)a+=this[b];return a}),Array.defineInstanceMethod("average",function(){for(var a=0,b=this.length,c=0;b>c;++c)a+=this[c];return a/b}),Array.defineInstanceMethod("each",function(){return this.forEach.apply(this,arguments),this}),Array.defineInstanceMethod("toULElement",function(){}),Array.defineInstanceMethod("toOLElement",function(){}),Array.defineFunction("range",function(){return Array.prototype.range.apply([],arguments)})}(),function(){var a=["January","February","March","April","May","June","July","August","September","October","November","December"],b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.defineInstanceMethod("format",function(c){for(var d=this.getFullYear(),e=this.getMonth(),f=this.getDate(),g=this.getDay(),h=this.getHours(),i=this.getMinutes(),j=this.getSeconds(),k=this.getMilliseconds(),l="",m=0,n=c.length;n>m;++m){var o=c.charAt(m),p="";switch(o){case"d":p=f.padding(2,"0");break;case"D":p=b[g].substr(0,3);break;case"j":p=f;break;case"l":p=b[g];break;case"F":p=a[e];break;case"m":p=(e+1).padding(2,"0");break;case"M":p=a[e].substr(0,3);break;case"n":p=e+1;break;case"Y":p=d;break;case"y":p=d.toString().substr(2,2);break;case"G":p=h;break;case"H":p=h.padding(2,"0");break;case"i":p=i.padding(2,"0");break;case"s":p=j.padding(2,"0");break;case"S":p=k.padding(3,"0");break;default:p=o}l+=p}return l})}(),function(){Function.prototype.bind||Function.defineInstanceMethod("bind",function(a){var b=this;return function(){b.apply(a,arguments)}}),Function.prototype.$has("name")||Function.prototype.getter("name",function(){return(""+this).replace(/^\s*function\s*([^\(]*)[\S\s]+$/im,"$1")}),Function.defineInstanceMethod("toArrayFunction",function(){var a=this;return function(){for(var b=[],c=0,d=this.length;d>c;++c)b.push(a.apply(this[c],arguments));return b}})}(),function(){Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.degToRad=function(a){return a*Math.DEG_TO_RAD},Math.radToDeg=function(a){return a*Math.RAD_TO_DEG},Math.defineFunction("clamp",function(a,b,c){return b>a?b:a>c?c:a}),Math.defineFunction("inside",function(a,b,c){return a>=b&&c>=a}),Math.defineFunction("rand",function(a,b){return window.Math.floor(Math.random()*(b-a+1))+a}),Math.defineFunction("randf",function(a,b){return window.Math.random()*(b-a)+a})}(),function(){Number.defineInstanceMethod("round",function(a){a=a||0;var b=Math.pow(10,a),c=this*b;return c=Math.round(c),c/b}),Number.defineInstanceMethod("ceil",function(a){a=a||0;var b=Math.pow(10,a),c=this*b;return c=Math.ceil(c),c/b}),Number.defineInstanceMethod("floor",function(a){a=a||0;var b=Math.pow(10,a),c=this*b;return c=Math.floor(c),c/b}),Number.defineInstanceMethod("toInt",function(){return 0|this}),Number.defineInstanceMethod("toHex",function(){return this.toString(16)}),Number.defineInstanceMethod("toBin",function(){return this.toString(2)}),Number.defineInstanceMethod("toUnsigned",function(){return this>>>0}),Number.defineInstanceMethod("padding",function(a,b){var c=this+"";for(a-=c.length,b=b||"0";a-->0;)c=b+c;return c}),Number.defineInstanceMethod("times",function(a,b){b=b||this;for(var c=0;this>c;++c)a.call(b,c);return this}),Number.defineInstanceMethod("upto",function(a,b,c){c=c||this;for(var d=+this;a>=d;++d)b.call(c,d);return this}),Number.defineInstanceMethod("downto",function(a,b,c){c=c||this;for(var d=+this;d>=a;--d)b.call(c,d);return this}),Number.defineInstanceMethod("step",function(a,b,c,d){d=d||this;for(var e=+this;a>=e;e+=b)c.call(d,e);return this})}(),function(){String.defineInstanceMethod("format",function(a){var b=void 0;if("object"==typeof a)b=function(b,c){return void 0===a[c]?"":a[c]};else{var c=arguments;b=function(a,b){return c[parseInt(b)]}}return this.replace(/\{(\w+)\}/g,b)}),String.defineInstanceMethod("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.defineInstanceMethod("capitalize",function(){return this.replace(/\w+/g,function(a){return a.capitalizeFirstLetter()})}),String.defineInstanceMethod("capitalizeFirstLetter",function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()}),String.defineInstanceMethod("toDash",function(){return this.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}),String.defineInstanceMethod("toHash",function(){return this.toCRC32()}),String.defineInstanceMethod("padding",function(a,b){var c=this.toString();for(a-=c.length,b=b||" ";a-->0;)c=b+c;return c}),String.defineInstanceMethod("paddingLeft",function(a,b){var c=this.toString();for(a-=c.length,b=b||" ";a-->0;)c=b+c;return c}),String.defineInstanceMethod("paddingRight",function(a,b){var c=this.toString();for(a-=c.length,b=b||" ";a-->0;)c+=b;return c}),String.defineInstanceMethod("quotemeta",function(){return this.replace(/([^0-9A-Za-z_])/g,"\\$1")}),String.defineInstanceMethod("repeat",function(a){for(var b=Array(a),c=0;a>c;++c)b[c]=this;return b.join("")}),String.defineInstanceMethod("count",function(a){var b=new RegExp(a,"gm");return this.match(b).length}),String.defineInstanceMethod("toArray",function(){for(var a=[],b=0,c=this.length;c>b;++b)a.push(this[b]);return a});var a="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");String.defineInstanceMethod("toCRC32",function(){var b=0,c=0,d=0;b=-1^b;for(var e=0,f=this.length;f>e;++e)d=255&(b^this.charCodeAt(e)),c="0x"+a[d],b=b>>>8^c;return(-1^b)>>>0})}(),tm.event=tm.event||{},function(){tm.event.Event=tm.createClass({type:null,init:function(a){this.type=a}})}(),function(){tm.event.TweenEvent=tm.createClass({superClass:tm.event.Event,time:null,now:null,init:function(a,b,c){this.superInit(a),this.time=b,this.now=c}}),tm.event.TweenEvent.CHANGE="change",tm.event.TweenEvent.FINISH="finish",tm.event.TweenEvent.LOOP="loop",tm.event.TweenEvent.RESUME="resume",tm.event.TweenEvent.START="start",tm.event.TweenEvent.STOP="stop"}(),function(){tm.event.MouseEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(a,b,c){this.superInit(a),this.app=b,this.pointing=c}})}(),function(){tm.event.TouchEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(a,b,c){this.superInit(a),this.app=b,this.pointing=c}})}(),function(){tm.event.PointingEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(a,b,c){this.superInit(a),this.app=b,this.pointing=c}})}(),tm.event=tm.event||{},function(){tm.define("tm.event.EventDispatcher",{init:function(){this._listeners={}},on:function(a,b){return void 0===this._listeners[a]&&(this._listeners[a]=[]),this._listeners[a].push(b),this},off:function(a,b){var c=this._listeners[a],d=c.indexOf(b);return-1!=d&&c.splice(d,1),this},fire:function(a){a.target=this;var b="on"+a.type;this[b]&&this[b](a);var c=this._listeners[a.type];if(c)for(var d=c.clone(),e=0,f=d.length;f>e;++e)d[e].call(this,a);return this},flare:function(a,b){var c=tm.event.Event(a);return b&&c.$extend(b),this.fire(c),this},one:function(a,b){var c=this,d=function(){var e=b.apply(c,arguments);return c.off(a,d),e};return this.on(a,d),this},hasEventListener:function(a){return void 0!==this._listeners[a]||this["on"+a]?!0:!1},clearEventListener:function(a){var b="on"+a;return this[b]&&delete this[b],this._listeners[a]=[],this}});var a=tm.event.EventDispatcher.prototype;a.addEventListener=a.on,a.removeEventListener=a.off,a.dispatchEvent=a.fire}(),tm.util=tm.util||{},function(){tm.util.Random={randint:function(a,b){return window.Math.floor(Math.random()*(b-a+1))+a},randfloat:function(a,b){return window.Math.random()*(b-a)+a},randbool:function(){return 1===this.randint(0,1)}}}(),tm.util=tm.util||{},function(){var AJAX_DEFAULT_SETTINGS={type:"GET",async:!0,data:null,contentType:"application/x-www-form-urlencoded",dataType:"text",responseType:"",username:null,password:null,success:function(a){alert("success!!\n"+a)},error:function(){alert("error!!")},beforeSend:null};tm.util.Ajax={load:function(a){for(var b in AJAX_DEFAULT_SETTINGS)a[b]=a[b]||AJAX_DEFAULT_SETTINGS[b];{var c=new XMLHttpRequest,d=tm.util.Ajax.DATA_CONVERTE_TABLE[a.dataType];a.url}if(a.data){var e="";e="string"==typeof a.data?a.data:tm.util.QueryString.stringify(a.data),"GET"==a.type?(a.url+="?"+e,a.data=null):"POST"==a.type&&(a.data=e)}c.onreadystatechange=function(){if(4==c.readyState)if(200===c.status||201===c.status||0===c.status)if("arraybuffer"!==a.responseType){var b=d(c.responseText);a.success(b)}else a.success(this.response);else a.error(c.responseText)},c.open(a.type,a.url,a.async,a.username,a.password),"POST"===a.type&&c.setRequestHeader("Content-Type",a.contentType),a.responseType&&(c.responseType=a.responseType),a.beforeSend&&a.beforeSend(c),a.password&&(c.withCredentials=!0),c.send(a.data)},loadJSONP:function(a,b){var c=tm.global;c.tmlib_js_dummy_func_count=tm.global.tmlib_js_dummy_func||0;var d="tmlib_js_dummy_func"+c.tmlib_js_dummy_func_count++;c[d]=b;var e=document.createElement("script");e.type="text/javascript",e.charset="UTF-8",e.src=a+(a.indexOf("?")<0?"?":"&")+"callback="+d,e.setAttribute("defer",!0),document.getElementsByTagName("head")[0].appendChild(e)}},tm.util.Ajax.DATA_CONVERTE_TABLE={undefined:function(a){return a},text:function(a){return a},xml:function(a){var b=new DOMParser,c=b.parseFromString(a,"text/xml");return c},dom:function(a){var b=document.createElement("div");return b.innerHTML=a,tm.dom.Element(b)},json:function(a){try{return JSON.parse(a)}catch(b){console.dir(b),console.dir(a)}},script:function(data){return eval(data),data},bin:function(a){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=255&a.charCodeAt(c);return b}},tm.util.Ajax.DEFAULT_SETTINGS=AJAX_DEFAULT_SETTINGS}(),tm.util=tm.util||{},function(){tm.define("tm.util.File",{superClass:"tm.event.EventDispatcher",data:null,loaded:!1,init:function(a){this.superInit(),this.loaded=!1,1==arguments.length&&this.load(a)},load:function(a){if("string"==typeof a){var b=a;a={url:b}}var c=this;a.success=function(a){c.setData(a);var b=tm.event.Event("load");c.dispatchEvent(b)},tm.util.Ajax.load(a)},setData:function(a){this.data=a,this.loaded=!0},loadLocalStorage:function(){}})}(),tm.util=tm.util||{},function(){tm.util.Timeline=tm.createClass({target:null,tasks:null,fps:30,init:function(){this.tasks=[],this.time=0},at:function(a,b){return this.tasks.push({time:a,action:b}),this},after:function(a,b){return this.at(this.time+a,b),this},clear:function(){return this.tasks=[],this},removeTime:function(){},removeAction:function(){},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime()},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime()},stop:function(){this.isPlaying=!1},rewind:function(){this.time=0},update:function(){if(this.tasks.length>0)for(var a=0,b=this.tasks.length;b>a;++a){var c=this.tasks[a];this.prev<=c.time&&c.time<this.time&&c.action()}},_startTime:function(){this.startTime=(new Date).getTime()},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_updateTime:function(){this.isPlaying&&(this._nextTime(),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_nextTime:function(){this.prev=this.time,this.time=(new Date).getTime()-this.startTime,this.update()}})}(),tm.util=tm.util||{},function(){tm.util.DataManager={data:{}},tm.util.DataManager.save=function(){for(var a in this.data){var b=this.data[a];localStorage[a]=JSON.stringify(b)}},tm.util.DataManager.load=function(a){for(var a in localStorage)this.data[a]=JSON.parse(localStorage[a])},tm.util.DataManager.set=function(a,b){return this.data[a]=b,this},tm.util.DataManager.get=function(a){return this.data[a]}}(),tm.util=tm.util||{},function(){tm.util.QueryString={parse:function(a,b,c){b=b||"&",c=c||"=";for(var d={},e=a.split(b),f=0,g=e.length;g>f;++f){var h=e[f],i=h.indexOf(c);if(i>0){var j=h.substring(0,i),k=h.substring(i+1);d[j]=k}}return d},stringify:function(a,b,c){b=b||"&",c=c||"=";var d=[];for(var e in a){var f=encodeURIComponent(a[e]);d.push(e+c+f)}return d.join(b)}}}(),tm.namespace("tm.util.Type",function(){var a=this,b=Object.prototype.toString;this.defineFunction("isObject",function(a){return a===Object(a)}),this.defineFunction("isArray",function(a){return"[object Array]"==b.call(a)}),this.defineFunction("isArguments",function(a){return"[object Arguments]"==b.call(a)}),this.defineFunction("isFunction",function(a){return"[object Function]"==b.call(a)}),this.defineFunction("isString",function(a){return"[object String]"==b.call(a)}),this.defineFunction("isNumber",function(a){return"[object Number]"==b.call(a)}),this.defineFunction("isDate",function(a){return"[object Date]"==b.call(a)}),this.defineFunction("isRegExp",function(a){return"[object RegExp]"==b.call(a)}),this.defineFunction("isEmpty",function(b){if(!b)return!0;if(a.isArray(b)||a.isString(b)||a.isArguments(b))return 0===b.length;for(var c in b)if(c)return!1;return!0})}),tm.define("tm.util.Flow",{superClass:"tm.event.EventDispatcher",waits:0,counter:0,args:null,init:function(a,b){this.superInit(),a=a||0,b=b||null,this.setup(a,b)},setup:function(a,b){return this.waits=a,this.callback=b,this.counter=0,this.args={},this._check(),this},pass:function(a,b){++this.counter,arguments.length>=2&&(this.args[a]=b),this._check()},isFinish:function(){return this.counter===this.waits},_check:function(){if(this.isFinish()){var a=this.args;this.callback&&(this.callback(a),this.args=null,this.callback=null);var b=tm.event.Event("flowfinish");b.args=a,this.fire(b)}}}),tm.define("tm.util.GridSystem",{width:640,col:12,init:function(a,b){if("object"==typeof arguments[0]){var c=arguments[0];a=c.width,b=c.col}this.width=a,this.col=b,this.unitWidth=this.width/this.col},span:function(a){return a+=this.col,a%=this.col,this.unitWidth*a},center:function(){return this.unitWidth*(this.col/2)}}),tm.geom=tm.geom||{},function(){tm.geom.Vector2=tm.createClass({x:0,y:0,init:function(a,b){this.set(a,b)},clone:function(){return tm.geom.Vector2(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y?!0:!1},equalsNumber:function(a,b){return this.x===a&&this.y===b?!0:!1},equalsArray:function(a){return this.x===a[0]&&this.y===a[1]?!0:!1},set:function(a,b){this.x=a,this.y=b},setNumber:function(a,b){return this.x=a,this.y=b,this},setArray:function(a){return this.x=a[0],this.y=a[1],this},setObject:function(a){return this.x=a.x,this.y=a.y,this},setString:function(a){var b=a.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(b[1]),this.y=parseFloat(b[3]),this},setSmart:function(a,b){var c=arguments[0];if(2===arguments.length)this.x=a,this.y=b;else if(c instanceof Array)this.x=c[0],this.y=c[1];else if(c instanceof Object)this.x=c.x,this.y=c.y;else if("string"==typeof c){var d=c.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(d[1]),this.y=parseFloat(d[3])}return this},setAngle:function(a,b){var c=a*Math.DEG_TO_RAD;return b=b||1,this.x=Math.cos(c)*b,this.y=Math.sin(c)*b,this},setRadian:function(a,b){return b=b||1,this.x=Math.cos(a)*b,this.y=Math.sin(a)*b,this},setDegree:function(a,b){var c=a*Math.DEG_TO_RAD;return b=b||1,this.x=Math.cos(c)*b,this.y=Math.sin(c)*b,this},setRandom:function(a,b,c){return a=a||0,b=b||360,c=c||1,this.setDegree(Math.randf(a,b),c),this},add:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},mul:function(a){return this.x*=a,this.y*=a,this},div:function(a){return a=a||.01,this.x/=a,this.y/=a,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},distanceSquared:function(a){return Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)},normalize:function(){var a=this.length();return this.div(a),this},toAngle:function(){return Math.atan2(this.y,this.x)},toStyleString:function(){return"{x:{x}, y:{y}}".format(this)},toString:function(){return"{x:{x}, y:{y}}".format(this)},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this}}),tm.geom.Vector2.min=function(a,b){return tm.geom.Vector2(a.x<b.x?a.x:b.x,a.y<b.y?a.y:b.y)},tm.geom.Vector2.max=function(a,b){return tm.geom.Vector2(a.x>b.x?a.x:b.x,a.y>b.y?a.y:b.y)},tm.geom.Vector2.add=function(a,b){return tm.geom.Vector2(a.x+b.x,a.y+b.y)},tm.geom.Vector2.sub=function(a,b){return tm.geom.Vector2(a.x-b.x,a.y-b.y)},tm.geom.Vector2.mul=function(a,b){return tm.geom.Vector2(a.x*b,a.y*b)},tm.geom.Vector2.div=function(a,b){return tm.geom.Vector2(a.x/b,a.y/b)},tm.geom.Vector2.negate=function(a){return tm.geom.Vector2(-a.x,-a.y)},tm.geom.Vector2.dot=function(a,b){return a.x*b.x+a.y*b.y},tm.geom.Vector2.cross=function(a,b){return a.x*b.y-a.y*b.x},tm.geom.Vector2.distance=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},tm.geom.Vector2.distanceSquared=function(a,b){return Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)},tm.geom.Vector2.manhattanDistance=function(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)},tm.geom.Vector2.reflect=function(a,b){var c=Vector2.dot(a,b),d=Vector2.mul(b,2*c);return tm.geom.Vector2.sub(a,d)},tm.geom.Vector2.lerp=function(a,b,c){return tm.geom.Vector2(a.x+(b.x-a.x)*c,a.y+(b.y-a.y)*c)},tm.geom.Vector2.slerp=function(){},tm.geom.Vector2.random=function(a,b,c){return a=a||0,b=b||360,c=c||1,tm.geom.Vector2().setDegree(Math.randf(a,b),c)},tm.geom.Vector2.ZERO=tm.geom.Vector2(0,0),tm.geom.Vector2.LEFT=tm.geom.Vector2(-1,0),tm.geom.Vector2.RIGHT=tm.geom.Vector2(1,0),tm.geom.Vector2.UP=tm.geom.Vector2(0,1),tm.geom.Vector2.DOWN=tm.geom.Vector2(0,-1)}(),tm.geom=tm.geom||{},function(){tm.geom.Vector3=tm.createClass({x:0,y:0,z:0,init:function(a,b,c){this.set(a,b,c)},set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setNumber:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setArray:function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this},setObject:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},setString:function(a){var b=a.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(b[1]),this.y=parseFloat(b[3]),this.z=parseFloat(b[5]),this},setAngle:function(a,b,c){return c=c||1,this.x=c*Math.cos(a)*Math.sin(b),this.y=c*Math.sin(a),this.z=c*Math.cos(a)*Math.cos(b),this},setRadian:function(a,b,c){return this.setAngle(a,b,c)},setDegree:function(a,b,c){return this.setAngle(a*Math.DEG_TO_RAD,b*Math.DEG_TO_RAD,c)},setSmart:function(a,b,c){var d=arguments[0];if(3===arguments.length)this.x=a,this.y=b,this.z=c;else if(d instanceof Array)this.x=d[0],this.y=d[1],this.z=d[2];else if(d instanceof Object)this.x=d.x,this.y=d.y,this.z=d.z;else if("string"==typeof d){var e=d.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(e[1]),this.y=parseFloat(e[3]),this.z=parseFloat(e[5])}return this},add:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},mul:function(a){return this.x*=a,this.y*=a,this.z*=a,this},div:function(a){return console.assert(0!=a,"0 division!!"),this.x/=a,this.y/=a,this.z/=a,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a){var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z,d=this.x*a.y-this.y*a.x;return this.set(b,c,d),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){var a=this.length();return this.div(a),this},toVector2:function(){},toAngleXY:function(){return Math.atan2(this.y,this.x)},to3D:function(){},equals:function(a,b,c){return this.x===a&&this.y===b&&this.z===c},equalsArray:function(a){return this.equals(a[0],a[1],a[2])},equalsObject:function(a){return this.equals(a.x,a.y,a.z)},equalsSmart:function(){},toStyleString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},toString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this}}),tm.geom.Vector3.min=function(a,b){
return Vector3(a.x<b.x?a.x:b.x,a.y<b.y?a.y:b.y,a.z<b.z?a.z:b.z)},tm.geom.Vector3.max=function(a,b){return Vector3(a.x>b.x?a.x:b.x,a.y>b.y?a.y:b.y,a.z>b.z?a.z:b.z)},tm.geom.Vector3.add=function(a,b){return tm.geom.Vector3(a.x+b.x,a.y+b.y,a.z+b.z)},tm.geom.Vector3.sub=function(a,b){return tm.geom.Vector3(a.x-b.x,a.y-b.y,a.z-b.z)},tm.geom.Vector3.mul=function(a,b){return tm.geom.Vector3(a.x*b,a.y*b,a.z*b)},tm.geom.Vector3.div=function(a,b){return tm.geom.Vector3(a.x/b,a.y/b,a.z/b)},tm.geom.Vector3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},tm.geom.Vector3.cross=function(a,b){return tm.geom.Vector3(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)},tm.geom.Vector3.negate=function(a){return tm.geom.Vector3(-a.x,-a.y,-a.z)},tm.geom.Vector3.distance=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)+Math.pow(a.z-b.z,2))},tm.geom.Vector3.distanceSquared=function(a,b){return Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)+Math.pow(a.z-b.z,2)},tm.geom.Vector3.manhattanDistance=function(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)+Math.abs(a.z-b.z)},tm.geom.Vector3.reflect=function(a,b){var c=Vector3.dot(a,b),d=Vector3.mul(b,2*c);return Vector3.sub(a,d)},tm.geom.Vector3.lerp=function(a,b,c){return tm.geom.Vector3(a.x+(b.x-a.x)*c,a.y+(b.y-a.y)*c,a.z+(b.z-a.z)*c)},tm.geom.Vector3.slerp=function(){},tm.geom.Vector3.random=function(a,b,c,d,e){return a=a||0,b=b||360,c=c||0,d=d||360,e=e||1,TM.Geom.Vector3().setFromDegree(TM.randomf(a,b),TM.randomf(c,d),e)},tm.geom.Vector3.ZERO=tm.geom.Vector3(0,0,0),tm.geom.Vector3.LEFT=tm.geom.Vector3(-1,0,0),tm.geom.Vector3.RIGHT=tm.geom.Vector3(1,0,0),tm.geom.Vector3.UP=tm.geom.Vector3(0,1,0),tm.geom.Vector3.DOWN=tm.geom.Vector3(0,-1,0),tm.geom.Vector3.FORWARD=tm.geom.Vector3(0,0,-1),tm.geom.Vector3.BACKWARD=tm.geom.Vector3(0,0,1)}(),tm.geom=tm.geom||{},function(){tm.define("tm.geom.Matrix33",{m:null,init:function(){this.m=[],arguments.length>=9?this.set.apply(this,arguments):this.identity()},clone:function(){var a=this.m;return tm.geom.Matrix33(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])},set:function(a,b,c,d,e,f,g,h,i){return console.assert(arguments.length>=9,""),this.m00=a,this.m01=b,this.m02=c,this.m10=d,this.m11=e,this.m12=f,this.m20=g,this.m21=h,this.m22=i,this},setArray:function(a){return this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]),this},setObject:function(a){return this.set(a.m00,a.m01,a.m02,a.m10,a.m11,a.m12,a.m20,a.m21,a.m22),this},identity:function(){var a=this.m;return a[0]=1,a[3]=0,a[6]=0,a[1]=0,a[4]=1,a[7]=0,a[2]=0,a[5]=0,a[8]=1,this},transpose:function(){return this.m.swap(1,3),this.m.swap(2,6),this.m.swap(5,7),this},invert:function(){var a=this.m,b=a[0],c=a[3],d=a[6],e=a[1],f=a[4],g=a[7],h=a[2],i=a[5],j=a[8],k=this.determinant();return this.m00=(f*j-g*i)/k,this.m01=(e*j-g*h)/k*-1,this.m02=(e*i-f*h)/k,this.m10=(c*j-d*i)/k*-1,this.m11=(b*j-d*h)/k,this.m12=(b*i-c*h)/k*-1,this.m20=(c*g-d*f)/k,this.m21=(b*g-d*e)/k*-1,this.m22=(b*f-c*e)/k,this.transpose(),this},determinant:function(){var a=this.m,b=a[0],c=a[3],d=a[6],e=a[1],f=a[4],g=a[7],h=a[2],i=a[5],j=a[8];return b*f*j+e*i*d+c*g*h-d*f*h-c*e*j-g*i*b},zero:function(){return this.set(0,0,0,0,0,0,0,0,0),this},translate:function(a,b){var c=this.m;return c[6]=c[0]*a+c[3]*b+c[6],c[7]=c[1]*a+c[4]*b+c[7],c[8]=c[2]*a+c[5]*b+c[8],this},rotateX:function(a){return this.multiply(tm.geom.Matrix33.rotateX(a))},rotateY:function(a){return this.multiply(tm.geom.Matrix33.rotateY(a))},rotateZ:function(a){{var b=(Math.sin(a),Math.cos(a),this.m);b[0],b[1],b[2],b[3],b[4],b[5]}return this.multiply(tm.geom.Matrix33.rotateZ(a))},scale:function(a,b){var c=this.m;return c[0]*=a,c[3]*=b,c[1]*=a,c[4]*=b,c[2]*=a,c[5]*=b,this},multiply:function(a){var b=this.m,c=a.m,d=b[0],e=b[3],f=b[6],g=b[1],h=b[4],i=b[7],j=b[2],k=b[5],l=b[8],m=c[0],n=c[3],o=c[6],p=c[1],q=c[4],r=c[7],s=c[2],t=c[5],u=c[8];return b[0]=d*m+e*p+f*s,b[3]=d*n+e*q+f*t,b[6]=d*o+e*r+f*u,b[1]=g*m+h*p+i*s,b[4]=g*n+h*q+i*t,b[7]=g*o+h*r+i*u,b[2]=j*m+k*p+l*s,b[5]=j*n+k*q+l*t,b[8]=j*o+k*r+l*u,this},multiplyVector2:function(a){var b=this.m00*a.x+this.m01*a.y+this.m02,c=this.m10*a.x+this.m11*a.y+this.m12;return tm.geom.Vector2(b,c)},multiplyVector3:function(a){var b=this.m00*a.x+this.m01*a.y+this.m02*a.z,c=this.m10*a.x+this.m11*a.y+this.m12*a.z,d=this.m20*a.x+this.m21*a.y+this.m22*a.z;return tm.geom.Vector3(b,c,d)},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)}}),tm.geom.Matrix33.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(a){this.m[0]=a}}),tm.geom.Matrix33.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(a){this.m[1]=a}}),tm.geom.Matrix33.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(a){this.m[2]=a}}),tm.geom.Matrix33.prototype.accessor("m01",{get:function(){return this.m[3]},set:function(a){this.m[3]=a}}),tm.geom.Matrix33.prototype.accessor("m11",{get:function(){return this.m[4]},set:function(a){this.m[4]=a}}),tm.geom.Matrix33.prototype.accessor("m21",{get:function(){return this.m[5]},set:function(a){this.m[5]=a}}),tm.geom.Matrix33.prototype.accessor("m02",{get:function(){return this.m[6]},set:function(a){this.m[6]=a}}),tm.geom.Matrix33.prototype.accessor("m12",{get:function(){return this.m[7]},set:function(a){this.m[7]=a}}),tm.geom.Matrix33.prototype.accessor("m22",{get:function(){return this.m[8]},set:function(a){this.m[8]=a}}),tm.geom.Matrix33.prototype.accessor("a",{get:function(){return this.m[0]},set:function(a){this.m[0]=a}}),tm.geom.Matrix33.prototype.accessor("b",{get:function(){return this.m[3]},set:function(a){this.m[3]=a}}),tm.geom.Matrix33.prototype.accessor("c",{get:function(){return this.m[1]},set:function(a){this.m[1]=a}}),tm.geom.Matrix33.prototype.accessor("d",{get:function(){return this.m[4]},set:function(a){this.m[4]=a}}),tm.geom.Matrix33.prototype.accessor("tx",{get:function(){return this.m[6]},set:function(a){this.m[6]=a}}),tm.geom.Matrix33.prototype.accessor("ty",{get:function(){return this.m[7]},set:function(a){this.m[7]=a}}),tm.geom.Matrix33.translate=function(a,b){return tm.geom.Matrix33(1,0,a,0,1,b,0,0,1)},tm.geom.Matrix33.rotateX=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix33(1,0,0,0,b,-c,0,c,b)},tm.geom.Matrix33.rotateY=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix33(b,0,c,0,1,0,-c,0,b)},tm.geom.Matrix33.rotateZ=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix33(b,-c,0,c,b,0,0,0,1)},tm.geom.Matrix33.scale=function(a,b){var c=tm.geom.Matrix33();return void 0==b&&(b=a),c.set(a,0,0,0,b,0,0,0,1),c}}(),tm.geom=tm.geom||{},function(){tm.geom.Matrix44=tm.createClass({m:null,init:function(){this.m=[],arguments.length>=16?this.set.apply(this,arguments):this.identity()},set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return console.assert(arguments.length>=16,""),this.m00=a,this.m01=b,this.m02=c,this.m03=d,this.m10=e,this.m11=f,this.m12=g,this.m13=h,this.m20=i,this.m21=j,this.m22=k,this.m23=l,this.m30=m,this.m31=n,this.m32=o,this.m33=p,this},setArray:function(a){return this.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]),this},setObject:function(a){return this.set(a.m00,a.m01,a.m02,a.m03,a.m10,a.m11,a.m12,a.m13,a.m20,a.m21,a.m22,a.m23,a.m30,a.m31,a.m32,a.m33),this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},transpose:function(){return this.m.swap(1,4),this.m.swap(2,8),this.m.swap(3,12),this.m.swap(6,9),this.m.swap(7,13),this.m.swap(11,14),this},translate:function(a,b,c){return this.multiply(tm.geom.Matrix44.translate(a,b,c))},rotate:function(){console.error("Unimplemented")},rotateX:function(a){return this.multiply(tm.geom.Matrix44.rotateX(a))},rotateY:function(a){return this.multiply(tm.geom.Matrix44.rotateY(a))},rotateZ:function(a){return this.multiply(tm.geom.Matrix44.rotateZ(a))},scale:function(a,b,c){return this.multiply(tm.geom.Matrix44.scale(a,b,c))},zero:function(){return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this},multiply:function(a){var b=this.m00*a.m00+this.m01*a.m10+this.m02*a.m20+this.m03*a.m30,c=this.m00*a.m01+this.m01*a.m11+this.m02*a.m21+this.m03*a.m31,d=this.m00*a.m02+this.m01*a.m12+this.m02*a.m22+this.m03*a.m32,e=this.m00*a.m03+this.m01*a.m13+this.m02*a.m23+this.m03*a.m33,f=this.m10*a.m00+this.m11*a.m10+this.m12*a.m20+this.m13*a.m30,g=this.m10*a.m01+this.m11*a.m11+this.m12*a.m21+this.m13*a.m31,h=this.m10*a.m02+this.m11*a.m12+this.m12*a.m22+this.m13*a.m32,i=this.m10*a.m03+this.m11*a.m13+this.m12*a.m23+this.m13*a.m33,j=this.m20*a.m00+this.m21*a.m10+this.m22*a.m20+this.m23*a.m30,k=this.m20*a.m01+this.m21*a.m11+this.m22*a.m21+this.m23*a.m31,l=this.m20*a.m02+this.m21*a.m12+this.m22*a.m22+this.m23*a.m32,m=this.m20*a.m03+this.m21*a.m13+this.m22*a.m23+this.m23*a.m33,n=this.m30*a.m00+this.m31*a.m10+this.m32*a.m20+this.m33*a.m30,o=this.m30*a.m01+this.m31*a.m11+this.m32*a.m21+this.m33*a.m31,p=this.m30*a.m02+this.m31*a.m12+this.m32*a.m22+this.m33*a.m32,q=this.m30*a.m03+this.m31*a.m13+this.m32*a.m23+this.m33*a.m33;return this.set(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q)},getAxisX:function(){return TM.Geom.Vector3(this.m00,this.m01,this.m02)},getAxisY:function(){return TM.Geom.Vector3(this.m10,this.m11,this.m12)},getAxisZ:function(){return TM.Geom.Vector3(this.m20,this.m21,this.m22)},setAxisX:function(a){this.m00=a.x,this.m01=a.y,this.m02=a.z},setAxisY:function(a){this.m10=a.x,this.m11=a.y,this.m12=a.z},setAxisZ:function(a){this.m20=a.x,this.m21=a.y,this.m22=a.z},toMatrix33:function(){},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}, {m03}|\n|{m10}, {m11}, {m12}, {m13}|\n|{m20}, {m21}, {m22}, {m23}|\n|{m30}, {m31}, {m32}, {m33}|".format(this)}}),tm.geom.Matrix44.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(a){this.m[0]=a}}),tm.geom.Matrix44.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(a){this.m[1]=a}}),tm.geom.Matrix44.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(a){this.m[2]=a}}),tm.geom.Matrix44.prototype.accessor("m30",{get:function(){return this.m[3]},set:function(a){this.m[3]=a}}),tm.geom.Matrix44.prototype.accessor("m01",{get:function(){return this.m[4]},set:function(a){this.m[4]=a}}),tm.geom.Matrix44.prototype.accessor("m11",{get:function(){return this.m[5]},set:function(a){this.m[5]=a}}),tm.geom.Matrix44.prototype.accessor("m21",{get:function(){return this.m[6]},set:function(a){this.m[6]=a}}),tm.geom.Matrix44.prototype.accessor("m31",{get:function(){return this.m[7]},set:function(a){this.m[7]=a}}),tm.geom.Matrix44.prototype.accessor("m02",{get:function(){return this.m[8]},set:function(a){this.m[8]=a}}),tm.geom.Matrix44.prototype.accessor("m12",{get:function(){return this.m[9]},set:function(a){this.m[9]=a}}),tm.geom.Matrix44.prototype.accessor("m22",{get:function(){return this.m[10]},set:function(a){this.m[10]=a}}),tm.geom.Matrix44.prototype.accessor("m32",{get:function(){return this.m[11]},set:function(a){this.m[11]=a}}),tm.geom.Matrix44.prototype.accessor("m03",{get:function(){return this.m[12]},set:function(a){this.m[12]=a}}),tm.geom.Matrix44.prototype.accessor("m13",{get:function(){return this.m[13]},set:function(a){this.m[13]=a}}),tm.geom.Matrix44.prototype.accessor("m23",{get:function(){return this.m[14]},set:function(a){this.m[14]=a}}),tm.geom.Matrix44.prototype.accessor("m33",{get:function(){return this.m[15]},set:function(a){this.m[15]=a}}),tm.geom.Matrix44.translate=function(a,b,c){return tm.geom.Matrix44(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1)},tm.geom.Matrix44.rotateX=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix44(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1)},tm.geom.Matrix44.rotateY=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix44(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1)},tm.geom.Matrix44.rotateZ=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix44(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1)},tm.geom.Matrix44.scale=function(a,b,c){var d=tm.geom.Matrix44();return void 0==b&&(b=a),void 0==c&&(c=a),d.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),d},tm.geom.Matrix44.perspective=function(a,b,c,d){var e=1/Math.tan(.5*a*Math.PI/180),f=e/b;return tm.geom.Matrix44(f,0,0,0,0,e,0,0,0,0,d/(d-c),c*d/(c-d),0,0,1,0)},tm.geom.Matrix44.ortho=function(a,b,c,d,e,f){var g=b-a,h=d-c,i=f-e;return tm.geom.Matrix44(2/g,0,0,0,0,2/h,0,0,0,0,-2/i,0,-(a+b)/g,-(d+c)/h,-(f+e)/i,1).transpose()},tm.geom.Matrix44.lookAt=function(a,b,c){var d=tm.geom.Vector3.sub(a,b).normalize(),e=tm.geom.Vector3.cross(c,d).normalize(),f=tm.geom.Vector3.cross(d,e).normalize(),g=tm.geom.Matrix44(e.x,f.x,d.x,0,e.y,f.y,d.y,0,e.z,f.z,d.z,0,0,0,0,1),h=tm.geom.Matrix44(1,0,0,0,0,1,0,0,0,0,1,0,-a.x,-a.y,-a.z,1);return h.multiply(g)}}(),tm.geom=tm.geom||{},function(){tm.geom.Rect=tm.createClass({x:0,y:0,width:0,height:0,init:function(a,b,c,d){this.set(a,b,c,d)},set:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},move:function(a,b){return this.x=a,this.y=b,this},moveBy:function(a,b){return this.x+=a,this.y+=b,this},resize:function(a,b){return this.width=a,this.height=b,this},resizeBy:function(a,b){return this.width+=a,this.height+=b,this},padding:function(a,b,c,d){switch(arguments.length){case 1:a=b=c=d=arguments[0];break;case 2:a=c=arguments[0],b=d=arguments[1];break;case 3:a=arguments[0],b=d=arguments[1],c=arguments[2]}return this.x+=d,this.y+=a,this.width-=d+b,this.height-=a+c,this},contains:function(a,b){return this.left<=a&&a<=this.right&&this.top<=b&&b<=this.bottom},clone:function(){return tm.geom.Rect(this.x,this.y,this.width,this.height)},toCircle:function(){return tm.geom.Circle(this.centerX,this.centerY,(this.width<this.height?this.width:this.height)/2)},toArray:function(){return[this.x,this.y,this.width,this.height]}}),tm.geom.Rect.prototype.accessor("left",{get:function(){return this.x},set:function(a){this.width-=a-this.x,this.x=a}}),tm.geom.Rect.prototype.accessor("top",{get:function(){return this.y},set:function(a){this.height-=a-this.y,this.y=a}}),tm.geom.Rect.prototype.accessor("right",{get:function(){return this.x+this.width},set:function(a){this.width+=a-this.right}}),tm.geom.Rect.prototype.accessor("bottom",{get:function(){return this.y+this.height},set:function(a){this.height+=a-this.bottom}}),tm.geom.Rect.prototype.accessor("centerX",{get:function(){return this.x+this.width/2},set:function(){}}),tm.geom.Rect.prototype.accessor("centerY",{get:function(){return this.y+this.height/2},set:function(){}})}(),tm.geom=tm.geom||{},function(){tm.define("tm.geom.Circle",{x:0,y:0,radius:0,init:function(a,b,c){this.set(a,b,c)},set:function(a,b,c){return this.x=a,this.y=b,this.radius=c,this},move:function(a,b){return this.x=a,this.y=b,this},moveBy:function(a,b){return this.x+=a,this.y+=b,this},resize:function(a){return this.radius=a,this},resizeBy:function(a){return this.radius+=a,this},contains:function(a,b){var c=this.x-a,d=this.y-b,e=c*c+d*d;return e<=this.radius*this.radius},clone:function(){return tm.geom.Circle(this.x,this.y,this.radius)},toRect:function(){return tm.geom.Rect(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},toArray:function(){return[this.x,this.y,this.radius]}}),tm.geom.Circle.prototype.getter("left",function(){return this.x-this.radius}),tm.geom.Circle.prototype.getter("top",function(){return this.y-this.radius}),tm.geom.Circle.prototype.getter("right",function(){return this.x+this.radius}),tm.geom.Circle.prototype.getter("bottom",function(){return this.y+this.radius})}(),tm.collision=tm.collision||{},function(){tm.collision,tm.collision.testCircleCircle=function(a,b){var c=tm.geom.Vector2.distanceSquared(a,b);return c<=Math.pow(a.radius+b.radius,2)},tm.collision.testRectRect=function(a,b){return a.left<b.right&&a.right>b.left&&a.top<b.bottom&&a.bottom>b.top},tm.collision.testCircleRect=function(a,b){var c=tm.geom.Rect(b.left-a.radius,b.top-a.radius,b.width+2*a.radius,b.height+2*a.radius);if(0==c.contains(a.x,a.y))return!1;var d=tm.geom.Rect(b.left-a.radius,b.top,b.width+2*a.radius,b.height);if(d.contains(a.x,a.y))return!0;if(d.set(b.left,b.top-a.radius,b.width,b.height+2*a.radius),d.contains(a.x,a.y))return!0;var e=tm.geom.Circle(a.x,a.y,a.radius);return e.contains(b.left,b.top)?!0:e.contains(b.right,b.top)?!0:e.contains(b.right,b.bottom)?!0:e.contains(b.left,b.bottom)?!0:!1},tm.collision.testRectCircle=function(a,b){return this.testCircleRect(b,a)}}(),tm.dom=tm.dom||{},function(){tm.dom.Element=tm.createClass({element:null,init:function(){this.set.apply(this,arguments)},set:function(a){this.element="string"==typeof a?document.querySelector(a):void 0!=a?a:document},append:function(a){return this.element.appendChild(a.element),this},prepend:function(a){return this.element.insertBefore(a.element,this.element.firstChild),this},after:function(a){return this.element.parentNode.insertBefore(a.element,this.element.nextSibling),this},before:function(a){return this.element.parentNode.insertBefore(a.element,this.element),this},appendTo:function(a){return a.append(this),this},prependTo:function(a){return a.prepend(this),this},clone:function(){return tm.dom.Element(this.element.cloneNode(!0))},remove:function(){return this.element.parentNode.removeChild(this.element),this},create:function(a,b){var c=tm.dom.Element(document.createElement(a));return b||(b="append"),this[b](c),c},query:function(a,b){var c=b?this.element.querySelectorAll(a)[b]:this.element.querySelector(a);return tm.dom.Element(c)},queryAll:function(a){var b=this.element.querySelectorAll(a);return tm.dom.ElementList(b)},fixed:function(a,b,c,d){return this.style.set("position","fixed"),a&&(this.x=a),b&&(this.y=b),c&&(this.width=c),d&&(this.height=d),this},absolute:function(a,b,c,d){return this.style.set("position","absolute"),a&&(this.x=a),b&&(this.y=b),c&&(this.width=c),d&&(this.height=d),this},fullScreen:function(){this.element.webkitRequestFullScreen()},show:function(){this.visible=!0},hide:function(){this.visible=!1},toString:function(){return"tm.dom.element"},getElement:function(){return this.element}}),tm.dom.Element.prototype.accessor("html",{get:function(){return this.element.innerHTML},set:function(a){this.element.innerHTML=a}}),tm.dom.Element.prototype.accessor("value",{get:function(){return this.element.value},set:function(a){this.element.value=a}}),tm.dom.Element.prototype.accessor("x",{get:function(){return Number(this.element.style.left.replace("px",""))},set:function(a){this.element.style.left=a+"px"}}),tm.dom.Element.prototype.accessor("y",{get:function(){return Number(this.element.style.top.replace("px",""))},set:function(a){this.element.style.top=a+"px"}}),tm.dom.Element.prototype.accessor("width",{get:function(){return Number(this.element.style.width.replace("px",""))},set:function(a){this.element.style.width=a+"px"}}),tm.dom.Element.prototype.accessor("height",{get:function(){return Number(this.element.style.height.replace("px",""))},set:function(a){this.element.style.height=a+"px"}}),tm.dom.Element.prototype.accessor("color",{get:function(){return this.element.style.color},set:function(a){this.element.style.color=a}}),tm.dom.Element.prototype.accessor("backgroundColor",{get:function(){return this.element.style.backgroundColor},set:function(a){this.element.style.backgroundColor=a}}),tm.dom.Element.prototype.accessor("visible",{get:function(){return"hidden"!=this.element.style.visibility},set:function(a){this.element.style.visibility=1==a?"visible":"hidden"}}),tm.dom.Element.prototype.accessor("text",{get:function(){return this.element.innerText||this.element.textContent},set:function(a){this.element.innerText?this.element.innerText=a:this.element.textContent=a}}),tm.dom.Element.prototype.getter("classList",function(){return this.element.classList}),tm.dom.Element.prototype.getter("parent",function(){return void 0!=this.element.parentNode?tm.dom.Element(this.element.parentNode):null}),tm.dom.Element.prototype.getter("prev",function(){return void 0!=this.element.previousSibling?tm.dom.Element(this.element.previousSibling):null}),tm.dom.Element.prototype.getter("next",function(){return void 0!=this.element.nextSibling?tm.dom.Element(this.element.nextSibling):null}),tm.dom.Element.prototype.getter("children",function(){return tm.dom.ElementList(this.element.children)})}(),function(){tm.dom.ElementList=tm.createClass({superClass:Array,init:function(a){if("string"==typeof arguments[0]){var b=arguments[0];a=document.querySelectorAll(b)}else if(void 0==a)return;for(var c=0,d=a.length;d>c;++c)this.push(tm.dom.Element(a[c]))},toString:function(){return""}})}(),tm.dom=tm.dom||{},function(){Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1}),Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()}}(),function(){KeyboardEvent.prototype.getter("character",function(){return String.fromCharCode(this.keyCode)})}(),function(){MouseEvent.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top})}(),function(){void 0!==window.TouchEvent&&(TouchEvent.prototype.getter("pointX",function(){return this.touches[0].clientX-this.target.getBoundingClientRect().left}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].clientY-this.target.getBoundingClientRect().top}))}(),function(){tm.dom.Event=tm.createClass({element:null,funcList:null,funcIndex:0,init:function(a){this.element=a,this.domElement=a.element,this.funcList={}},add:function(a,b,c){var d=this.element,e=function(a){var c=b.apply(d,arguments);return c===!1&&(a.preventDefault(),a.returnValue=!1,a.stopPropagation()),c};return this._funcIndex=this._funcIndex||0,c=c||this._funcIndex++,this.funcList[a]=this.funcList[a]||{},this.funcList[a][c]=e,b._id=c,this.domElement.addEventListener(a,e,!1),this},remove:function(a,b){var c="function"==typeof b?b._id:b,d=this.getFunc(a,c);this.domElement.removeEventListener(a,d,!1),delete this.funcList[a][c]},click:function(a,b){return this.add("click",a,b),this},mdlclick:function(a,b){var c=function(b){1==b.button&&a(b)};this.add("click",c,b)},pointstart:function(a,b){this.add(tm.dom.Event.POINT_START,a,b)},pointmove:function(a,b){this.add(tm.dom.Event.POINT_MOVE,a,b)},pointend:function(a,b){this.add(tm.dom.Event.POINT_END,a,b)},hover:function(a,b){return this.add("mouseover",a,b),this},one:function(a,b,c){var d=this,e=this.element,f=function(){var c=b.apply(e,arguments);return d.remove(a,f),c};return this.add(a,f,c),this},toggle:function(a,b){for(var c=this,d=this.element,e=[],f=0;f<b.length;++f){var g=function(f){return function(){var g=b[f].apply(d,arguments);if(g!==!1){var h=(f+1)%b.length;c.one(a,e[h])}}}(f);e.push(g)}return this.one(a,e[0]),this},getFunc:function(a,b){return this.funcList[a][b]}}),tm.dom.Event.POINT_START=tm.isMobile?"touchstart":"mousedown",tm.dom.Event.POINT_MOVE=tm.isMobile?"touchmove":"mousemove",tm.dom.Event.POINT_END=tm.isMobile?"touchend":"mouseup",tm.dom.Element.prototype.getter("event",function(){return this._event||(this._event=tm.dom.Event(this))})}(),tm.dom=tm.dom||{},function(){tm.dom.Attr=tm.createClass({element:null,init:function(a){this.element=a},set:function(a,b){return this.element.setAttribute(a,b),this},add:function(a,b){var c=this.get(a);return b=c?c+" "+b:b,this.element.setAttribute(a,b),this},remove:function(a,b){if(b){var c=this.get(a),d=c?c.replace(b,"").replace("  "," "):"";this.element.setAttribute(a,d.trim())}else this.element.removeAttribute(a);return this},get:function(a){return this.element.getAttribute(a)},contains:function(a,b){var c=this.get(a);return 1==arguments.length?null!=c:2==arguments.length?(" "+c+" ").indexOf(" "+b+" ")>-1:!1},toggle:function(a,b){return this.contains(a,b)?this.remove(a,b):this.add(a,b),this}}),tm.dom.Element.prototype.getter("attr",function(){return this._attr||(this._attr=tm.dom.Attr(this.element))})}(),tm.dom=tm.dom||{},function(){tm.dom.Style=tm.createClass({element:null,init:function(a){this.element=a},set:function(a,b){return this.element.style[a]=b,this},remove:function(a){return this.element.style.removeProperty(a),this},clear:function(){return this},get:function(a){return this.element.style[a]},getPropValue:function(a){return document.defaultView.getComputedStyle(this.element,"").getPropertyValue(a)}}),tm.dom.Element.prototype.getter("style",function(){return this._style||(this._style=tm.dom.Style(this.element))})}(),tm.dom=tm.dom||{},function(){var a=tm.VENDER_PREFIX,b=a+"Animation",c=a+"AnimationEnd",d=a+"AnimationPlayState",e=a+"AnimationName",f=a+"AnimationDuration",g=a+"AnimationTimingFunction",h=a+"AnimationDelay",i=a+"AnimationIterationCount";tm.dom.Anim=tm.createClass({init:function(a){this.element=a;var b=this;this.element.addEventListener(c,function(){b.stop()},!1)},start:function(){return this.element.style[d]="running",this},stop:function(){return this.element.style[d]="paused",this},setProperty:function(a){if("string"==typeof a)this.element.style[b]=a;else for(var c in a){var d=j[c],e=a[c];d.call(this,e)}return this},setName:function(a){return this.element.style[e]=a,this},setDuration:function(a){return this.element.style[f]=a,this},setTimingFunction:function(a){return this.element.style[g]=a,this},setIterationCount:function(a){return this.element.style[i]=a,this},setDelay:function(a){return this.element.style[h]=a,this},setDirection:function(a){return this.element.style[f]=a,this}});var j={name:tm.dom.Anim.prototype.setName,duration:tm.dom.Anim.prototype.setDuration,timingFunction:tm.dom.Anim.prototype.setTimingFunction,iterationCount:tm.dom.Anim.prototype.setIterationCount,delay:tm.dom.Anim.prototype.setDelay,Name:tm.dom.Anim.prototype.setName,Duration:tm.dom.Anim.prototype.setDuration,TimingFunction:tm.dom.Anim.prototype.setTimingFunction,IterationCount:tm.dom.Anim.prototype.setIterationCount,Delay:tm.dom.Anim.prototype.setDelay};tm.dom.Element.prototype.getter("anim",function(){return this._anim||(this._anim=tm.dom.Anim(this.element))})}(),function(){tm.dom.Trans=tm.createClass({element:null,init:function(a){this.element=a},to:function(a,b){return this.set(a).duration(b||1e3),this},set:function(a){var c=this.element.style,d=[];for(var e in a){var f=b(e);d.push(f.toDash()),c[f]=a[e]+""}return c[tm.dom.Trans.PROPERTY]=d.join(", "),this},duration:function(a){var b=this.element.style;return"number"==typeof a&&(a+="ms"),b[tm.dom.Trans.DURATION]=a,this},easing:function(){var a=this.element.style;return a[tm.dom.Trans.TIMING_FUNCTION]=func,this},end:function(a){var b=tm.dom.Element(this.element);return b.event.add(tm.dom.Trans.END_EVENT,a),this},reset:function(){var a=this.element.style;return a[tm.dom.Trans.PROPERTY]="none",this},translate:function(a,b,c){return this.to({transform:"translate({0}px,{1}px)".format(a,b)},c),this},translate3d:function(a,b,c,d){return this.to({transform:"translate3d({0}px,{1}px,{2}px)".format(a,b,c)},d),this},rotate:function(a,b){return this.to({transform:"rotate({0}deg)".format(a)},b),this},rotate3d:function(a,b,c,d,e){return this.to({transform:"rotate3d({0},{1},{2},{3}deg)".format(a,b,c,d)},e),this},scale:function(a,b,c){return this.to({transform:"scale({0},{1})".format(a,b)},c),this},transform:function(){},setProp:function(a){var c=this.element.style,d=[];for(var e in a){var f=b(e);d.push(f.toDash()),c[f]=a[e]}return c[tm.dom.Trans.PROPERTY]=d.join(", "),this},setDuration:function(a){var b=this.element.style;return b[tm.dom.Trans.DURATION]=a,this},setTimingFunction:function(a){var b=this.element.style;return b[tm.dom.Trans.TIMING_FUNCTION]=a,this},resetProp:function(){var a=this.element.style;return a[tm.dom.Trans.PROPERTY]="none",this},setEndFunction:function(a){var b=tm.dom.Element(this.element);return b.event.add(tm.dom.Trans.END_EVENT,a),this}}),tm.dom.Trans.PROPERTY=tm.VENDER_PREFIX+"TransitionProperty",tm.dom.Trans.DURATION=tm.VENDER_PREFIX+"TransitionDuration",tm.dom.Trans.TIMING_FUNCTION=tm.VENDER_PREFIX+"TransitionTimingFunction",tm.dom.Trans.DELAY=tm.VENDER_PREFIX+"TransitionDelay",tm.dom.Trans.END_EVENT=function(){return{webkit:"webkitTransitionEnd",moz:"transitionend",o:"oTransitionEnd"}[tm.VENDER_PREFIX]}(),tm.dom.Element.prototype.getter("trans",function(){return this._trans||(this._trans=tm.dom.Trans(this.element))});var a={transform:!0},b=function(b){return a[b]===!0?"-"+tm.VENDER_PREFIX+b.capitalizeFirstLetter():b}}(),function(){tm.define("tm.dom.Data",{element:null,init:function(a){this.element=a},set:function(a,b){var c="data-"+a.toDash();return this.element.setAttribute(c,b),this},get:function(a){var b="data-"+a.toDash();return this.element.attributes[b].value}}),tm.dom.Element.prototype.getter("data",function(){return this._data||(this._data=tm.dom.Data(this.element))})}(),function(){tm.asset=tm.asset||{},tm.asset.Manager={assets:{},get:function(a){return this.assets[a]},set:function(a,b){return this.assets[a]=b,this},contains:function(a){return this.assets[a]?!0:!1}}}(),function(){tm.define("tm.asset.Loader",{superClass:"tm.event.EventDispatcher",init:function(){this.superInit(),this.assets={}},contains:function(a){return this.assets[a]?!0:!1},load:function(a){return tm.util.Type.isObject(a)?this._loadByObject(a):this._loadString(arguments[0],arguments[1],arguments[2]),this},get:function(a){return this.assets[a]},set:function(a,b){return this.assets[a]=b,tm.asset.Manager.set(a,b),this},_load:function(a,b,c){b=b||a,c=c||b.split("?")[0].split("#")[0].split(".").last;var d=tm.asset.Loader._funcs[c](b,a);return this.set(a,d),d},_loadString:function(a,b,c){var d={};d[a]={url:b,type:c},this._loadByObject(d)},_loadByObject:function(a){var b=tm.util.Flow(Object.keys(a).length,function(){var a=tm.event.Event("load");this.dispatchEvent(a)}.bind(this)),c=function(a,c){var d=tm.event.Event("progress");d.key=c,d.asset=a,d.progress=(b.counter+1)/b.waits,this.dispatchEvent(d),b.pass()}.bind(this);Object.keys(a).each(function(b){var d=a[b],e=null;e="string"==typeof d?this._load(b,d):this._load(b,d.url||d.src||d.path,d.type),e.loaded?c(e,b):e.on("load",function(){c(e,b)})}.bind(this))}}),tm.asset.Loader._funcs=[],tm.asset.Loader.defineFunction("register",function(a,b){this._funcs[a]=b});var a=function(a){var b=tm.asset.Texture(a);return b},b=function(a){var b=tm.sound.WebAudio(a);return b},c=function(a){var b=tm.asset.MapSheet(a);return b},d=function(a){var b=tm.asset.SpriteSheet(a);return b},e=function(a){var b=tm.util.File();if("string"==typeof a)b.load({url:a,dataType:"json"});else{b.setData(a),b.loaded=!0}return b},f=function(a){var b=tm.asset.Script(a);return b};tm.asset.Loader.register("png",a),tm.asset.Loader.register("gif",a),tm.asset.Loader.register("jpg",a),tm.asset.Loader.register("jpeg",a),tm.asset.Loader.register("wav",b),tm.asset.Loader.register("mp3",b),tm.asset.Loader.register("ogg",b),tm.asset.Loader.register("m4a",b),tm.asset.Loader.register("json",e),tm.asset.Loader.register("tmx",c),tm.asset.Loader.register("tmss",d),tm.asset.Loader.register("js",f)}(),function(){tm.define("tm.asset.Texture",{superClass:"tm.event.EventDispatcher",element:null,loaded:!1,init:function(a){this.superInit(),this.element=new Image,!tm.isLocal()&&!/^data:/.test(a),this.element.src=a;var b=this;this.element.onload=function(){b.loaded=!0;var a=tm.event.Event("load");b.dispatchEvent(a)},this.element.onerror=function(b){console.error("[tmlib] {0}の読み込みに失敗!".format(a));var c=a.split("/").last.replace(".png","").split("?").first.split("#").first,d=b.target;d.src="http://dummyimage.com/128x128/444444/eeeeee&text="+c,d.onerror=null}},getElement:function(){return this.element}}),tm.asset.Texture.prototype.getter("width",function(){return this.element.width}),tm.asset.Texture.prototype.getter("height",function(){return this.element.height})}(),function(){tm.define("tm.asset.SpriteSheet",{superClass:"tm.event.EventDispatcher",loaded:!1,init:function(a){this.superInit(),
this.loaded=!1,"string"==typeof a?this.load(a):(this.parse(a),this.loaded=!0,this.dispatchEvent(tm.event.Event("load")))},load:function(a){tm.util.Ajax.load({url:a,dataType:"json",success:function(a){this.parse(a),this.loaded=!0}.bind(this)})},parse:function(a){if(this.frame=a.frame,"string"==typeof a.image){if(!tm.asset.Manager.contains(a.image)){var b=tm.asset.Loader();b.load(a.image)}this.image=tm.asset.Manager.get(a.image)}else this.image=a.image;if(this.image.loaded===!1)this.image.addEventListener("load",function(){this._calcFrames(a.frame);var b=tm.event.Event("load");this.dispatchEvent(b)}.bind(this),!1);else{this._calcFrames(a.frame);var c=tm.event.Event("load");this.dispatchEvent(c)}this._calcAnim(a.animations)},getFrame:function(a){return this.frames[a]},getAnimation:function(a){return this.animations[a]},_calcFrames:function(a){var b=this.frames=[],c=a.width,d=a.height,e=~~(this.image.width/c),f=~~(this.image.height/d);a.count||(a.count=e*f);for(var g=0,h=a.count;h>g;++g){var i=g%e,j=g/e|0,k={x:i*c,y:j*d,width:c,height:d};b.push(k)}},_calcAnim:function(a){this.animations={};for(var b in a){var c=a[b];this.animations[b]=c instanceof Array?{frames:[].range(c[0],c[1]),next:c[2],frequency:c[3]||1}:"number"==typeof c?{frames:[c],next:null,frequency:1}:{frames:c.frames,next:c.next,frequency:c.frequency||1}}this.animations["default"]={frames:[].range(0,this.frame.count),next:"default",frequency:1}}})}(),function(){tm.define("tm.asset.MapSheet",{superClass:"tm.event.EventDispatcher",init:function(a){this.superInit(),this.loaded=!1,"string"==typeof a?tm.util.Ajax.load({url:a,success:function(a){var b=this._parse(a);this.$extend(b),this._checkImage()}.bind(this)}):(this.$extend(arguments[0]),this._checkImage())},_parse:function(a){var b=(Array.prototype.forEach,{}),c=new DOMParser,d=c.parseFromString(a,"text/xml"),e=this._attrToJSON(d.getElementsByTagName("map")[0]);return this.$extend(e),b.tilesets=this._parseTilesets(d),b.layers=this._parseLayers(d),b},_parseTilesets:function(a){var b=Array.prototype.forEach,c=this,d=[],e=a.getElementsByTagName("tileset");return b.call(e,function(a){var b={},e=c._propertiesToJson(a);b.image=e.src?e.src:a.getElementsByTagName("image")[0].getAttribute("source"),d.push(b)}),d},_parseLayers:function(a){var b=Array.prototype.forEach,c=[],d=a.getElementsByTagName("map")[0],e=[];return b.call(d.childNodes,function(a){("layer"==a.tagName||"objectgroup"==a.tagName||"imagelayer"==a.tagName)&&e.push(a)}),e.each(function(a){if("layer"==a.tagName){var d=a.getElementsByTagName("data")[0],e=d.getAttribute("encoding"),f={type:"layer",name:a.getAttribute("name")};"csv"==e?f.data=this._parseCSV(d.textContent):"base64"==e&&(f.data=this._parseBase64(d.textContent));var g=this._attrToJSON(a);f.$extend(g),c.push(f)}else if("objectgroup"==a.tagName){var f={type:"objectgroup",objects:[],name:a.getAttribute("name")};b.call(a.childNodes,function(a){if(3!=a.nodeType){var b=this._attrToJSON(a);b.properties=this._propertiesToJson(a),f.objects.push(b)}}.bind(this)),c.push(f)}else if("imagelayer"==a.tagName){var f={type:"imagelayer",name:a.getAttribute("name"),x:a.getAttribute("x")||0,y:a.getAttribute("y")||0,alpha:a.getAttribute("opacity")||1,visible:void 0===a.getAttribute("visible")||0!=a.getAttribute("visible")},h=a.getElementsByTagName("image")[0];f.image={source:h.getAttribute("source")},c.push(f)}}.bind(this)),c},_parseCSV:function(a){var b=a.split(","),c=[];return b.each(function(a){var b=parseInt(a,10)-1;c.push(b)}),c},_parseBase64:function(a){var b=atob(a.trim()),c=[];b=b.split("").map(function(a){return a.charCodeAt(0)});for(var d=0,e=b.length/4;e>d;++d){var f=b[4*d];c[d]=parseInt(f,10)-1}return c},_propertiesToJson:function(a){var b=a.getElementsByTagName("properties")[0],c={};if(void 0===b)return c;for(var d=0;d<b.childNodes.length;d++){var e=b.childNodes[d];"property"===e.tagName&&(c[e.getAttribute("name")]=e.getAttribute("value"))}return c},_attrToJSON:function(a){for(var b={},c=0;c<a.attributes.length;c++){var d=a.attributes[c].value;d=isNaN(parseFloat(d))?d:parseFloat(d),b[a.attributes[c].name]=d}return b},_checkImage:function(){var a=this,b=[];if(this.tilesets.length&&Array.prototype.push.apply(b,this.tilesets.map(function(a){return a.image})),this.layers.each(function(a){"imagelayer"==a.type&&b.push(a.image.source)}),b.length){var c=0,d=b.length,e=function(){if(c++,c==d){this.loaded=!0;var a=tm.event.Event("load");this.dispatchEvent(a)}}.bind(this);b.each(function(b){var f=tm.asset.Manager.get(b);if(f)if(f.loaded){if(++c,c==d){this.loaded=!0;var g=tm.event.Event("load");a.dispatchEvent(g)}}else f.addEventListener("load",e);else{var h=tm.asset.Loader();h.load(b);var i=tm.asset.Manager.get(b);i.addEventListener("load",e)}})}else{this.loaded=!0;var f=tm.event.Event("load");this.dispatchEvent(f)}}})}(),tm.asset=tm.asset||{},function(){tm.define("tm.asset.Font",{superClass:"tm.event.EventDispatcher",init:function(a,b,c){this.superInit();var d=tm.dom.Element("head").create("style");d.text="@font-face { font-family: '{0}'; src: url({1}) format('{2}'); }".format(b,a,c),tm.asset.Font.checkLoaded(b,function(){this.flare("load")}.bind(this))}}),tm.asset.Font.checkLoaded=function(a,b){var c=tm.dom.Element("body").create("span");c.style.set("color","rgba(0, 0, 0, 0)").set("fontSize","40px"),c.text="QW@HhsXJ=/()あいうえお＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝";var d=c.element.offsetWidth;c.style.set("fontFamily","'{0}', 'monospace'".format(a));var e=function(){c.element.offsetWidth!==d?(c.remove(),b&&b()):setTimeout(e,100)};setTimeout(e,100)},tm.asset.Loader.register("ttf",function(a,b){return tm.asset.Font(a,b,"truetype")}),tm.asset.Loader.register("otf",function(a,b){return tm.asset.Font(a,b,"opentype")}),tm.asset.Loader.register("woff",function(a,b){return tm.asset.Font(a,b,"woff")}),tm.asset.Loader.register("woff2",function(a,b){return tm.asset.Font(a,b,"woff2")})}(),tm.util=tm.util||{},function(){tm.define("tm.asset.Script",{superClass:"tm.event.EventDispatcher",element:null,loaded:!1,init:function(a){this.superInit(),this.loaded=!1,this.element=document.createElement("script"),this.element.type="text/javascript",this.element.src=a,this.element.charset="UTF-8",this.element.setAttribute("defer",!0),document.head.appendChild(this.element);var b=this;this.element.onload=function(){b.loaded=!0,b.fire(tm.event.Event("load"))}},getElement:function(){return this.element}}),tm.asset.Script.load=function(a){var b=tm.asset.Script(a);return b},tm.asset.Script.loadStats=function(a){a=a||"r11";var b=null;return b=-1!=["r6","r7","r8","r9","10"].indexOf(a)?"https://cdn.rawgit.com/mrdoob/stats.js/"+a+"/build/Stats.js":"http://cdn.rawgit.com/mrdoob/stats.js/"+a+"/build/stats.min.js",this.load(b)},tm.asset.Script.loadDatGUI=function(a){a=a||"0.5";var b="http://dat-gui.googlecode.com/git/build/dat.gui.js";return this.load(b)},tm.asset.Script.loadThree=function(a){var b="http://cdn.rawgit.com/mrdoob/three.js/{version}/build/three.js";a=a||"r55";var c=b.format({version:a});return this.load(c)},tm.asset.Script.loadBulletML=function(a){var b="http://cdn.rawgit.com/daishihmr/bulletml.js/{version}/target/bulletml.for.tmlib.js";a=a||"v0.4.2";var c=b.format({version:a});return this.load(c)}}(),tm.input=tm.input||{},function(){tm.input.Keyboard=tm.createClass({element:null,key:null,press:null,down:null,up:null,last:null,init:function(a){this.element=a||document,this.key={},this.press={},this.down={},this.up={},this.last={};var b=this;this.element.addEventListener("keydown",function(a){b.key[a.keyCode]=!0}),this.element.addEventListener("keyup",function(a){b.key[a.keyCode]=!1}),this.element.addEventListener("keypress",function(){})},run:function(a){var b=this;a=a||30,tm.setLoop(function(){b._update(),b.update&&b.update()},1e3/a)},_update:function(){for(var a in this.key)this.last[a]=this.press[a],this.press[a]=this.key[a],this.down[a]=(this.press[a]^this.last[a])&this.press[a],this.up[a]=(this.press[a]^this.last[a])&this.last[a];return this},getKey:function(a){return"string"==typeof a&&(a=b[a]),1==this.press[a]},getKeyDown:function(a){return"string"==typeof a&&(a=b[a]),1==this.down[a]},getKeyUp:function(a){return"string"==typeof a&&(a=b[a]),1==this.up[a]},getKeyAngle:function(){var b=null,c=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return 0!=c&&a.hasOwnProperty(c)&&(b=a[c]),b},getKeyDirection:function(){var a=tm.geom.Vector2(0,0);return this.getKey("left")?a.x=-1:this.getKey("right")&&(a.x=1),this.getKey("up")?a.y=-1:this.getKey("down")&&(a.y=1),a.x&&a.y&&a.div(Math.SQRT2),a},setKey:function(a,c){return"string"==typeof a&&(a=b[a]),this.key[a]=c,this},clearKey:function(){return this.key={},this}});var a={1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0},b={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,q:81,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,"forward slash":191,"/":191,"grave accent":192,"open bracket":219,"back slash":220,"close bracket":221,"single quote":222,space:32}}(),tm.input=tm.input||{},function(){tm.input.Mouse=tm.createClass({element:null,init:function(a){this.element=a||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0),this._x=0,this._y=0,this.touches=[];var b=this;this.element.addEventListener("mousedown",function(a){b._mousemove(a),b.prevPosition.set(b._x,b._y),b.button|=1<<a.button}),this.element.addEventListener("mouseup",function(a){b.button&=~(1<<a.button)}),this.element.addEventListener("mousemove",function(a){b._mousemove(a)})},run:function(a){var b=this;return a=a||30,tm.setLoop(function(){b.update()},1e3/a),this},update:function(){this.last=this.press,this.press=this.button,this.down=(this.press^this.last)&this.press,this.up=(this.press^this.last)&this.last,this.deltaPosition.x=this._x-this.position.x,this.deltaPosition.y=this._y-this.position.y,this.prevPosition.setObject(this.position),this.position.set(this._x,this._y)},getButton:function(b){return"string"==typeof b&&(b=a[b]),0!=(this.press&b)},getButtonDown:function(b){return"string"==typeof b&&(b=a[b]),0!=(this.down&b)},getButtonUp:function(b){return"string"==typeof b&&(b=a[b]),0!=(this.up&b)},_mousemove:function(a){var b=a.target.getBoundingClientRect();this._x=a.clientX-b.left,this._y=a.clientY-b.top},_mousemoveNormal:function(a){var b=a.target.getBoundingClientRect();this._x=a.clientX-b.left,this._y=a.clientY-b.top},_mousemoveScale:function(a){var b=a.target.getBoundingClientRect();this._x=a.clientX-b.left,this._y=a.clientY-b.top,a.target.style.width&&(this._x*=a.target.width/parseInt(a.target.style.width)),a.target.style.height&&(this._y*=a.target.height/parseInt(a.target.style.height))}}),tm.input.Mouse.BUTTON_LEFT=1,tm.input.Mouse.BUTTON_MIDDLE=2,tm.input.Mouse.BUTTON_RIGHT=4;var a={left:tm.input.Mouse.BUTTON_LEFT,middle:tm.input.Mouse.BUTTON_MIDDLE,right:tm.input.Mouse.BUTTON_RIGHT};tm.input.Mouse.prototype.accessor("x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),tm.input.Mouse.prototype.accessor("y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),tm.input.Mouse.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(a){this.deltaPosition.x=a}}),tm.input.Mouse.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(a){this.deltaPosition.y=a}}),tm.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},tm.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},tm.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),tm.input=tm.input||{},function(){tm.input.Touch=tm.createClass({element:null,touched:!1,init:function(a){this.element=a||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0),this._x=0,this._y=0,this.touches=[];var b=this;this.element.addEventListener("touchstart",function(a){b.touched=!0,b._touchmove(a),b.position.set(b._x,b._y),b.prevPosition.set(b._x,b._y),b._setTouches(a)}),this.element.addEventListener("touchend",function(a){b.touched=!1,b._setTouches(a)}),this.element.addEventListener("touchmove",function(a){b._touchmove(a),a.stop(),b._setTouches(a)})},run:function(a){var b=this;return a=a||30,tm.setLoop(function(){b.update()},1e3/a),this},update:function(){this.last=this.now,this.now=Number(this.touched),this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.x=this._x-this.position.x,this.deltaPosition.y=this._y-this.position.y,this.prevPosition.setObject(this.position),this.position.set(this._x,this._y)},getTouch:function(){return 0!=this.touched},getTouchStart:function(){return 0!=this.start},getTouchEnd:function(){return 0!=this.end},_touchmove:function(a){var b=a.touches[0],c=a.target.getBoundingClientRect();this._x=b.clientX-c.left,this._y=b.clientY-c.top},_touchmoveScale:function(a){var b=a.touches[0],c=a.target.getBoundingClientRect();this._x=b.clientX-c.left,this._y=b.clientY-c.top,a.target.style.width&&(this._x*=a.target.width/parseInt(a.target.style.width)),a.target.style.height&&(this._y*=a.target.height/parseInt(a.target.style.height))},_getAdjustPoint:function(a){var b=this.element,c=b.style,d=b.getBoundingClientRect(),a={x:a.clientX-d.left,y:a.clientY-d.top};return c.width&&(a.x*=b.width/parseInt(c.width)),c.height&&(a.y*=b.height/parseInt(c.height)),a},_setTouches:function(a){var b=a.touches;this.touches.clear();for(var c=0,d=b.length;d>c;++c){var e=this._getAdjustPoint(b[c]);this.touches.push(e)}return this}}),tm.input.Touch.prototype.accessor("x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),tm.input.Touch.prototype.accessor("y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),tm.input.Touch.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(a){this.deltaPosition.x=a}}),tm.input.Touch.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(a){this.deltaPosition.y=a}}),tm.input.Touch.prototype.getPointing=tm.input.Touch.prototype.getTouch,tm.input.Touch.prototype.getPointingStart=tm.input.Touch.prototype.getTouchStart,tm.input.Touch.prototype.getPointingEnd=tm.input.Touch.prototype.getTouchEnd}(),tm.input=tm.input||{},function(){tm.input.Accelerometer=tm.createClass({init:function(){this.gravity=tm.geom.Vector3(0,0,0),this.acceleration=tm.geom.Vector3(0,0,0),this.rotation=tm.geom.Vector3(0,0,0),this.orientation=tm.geom.Vector3(0,0,0);var a=this;window.addEventListener("devicemotion",function(b){var c=a.acceleration,d=a.gravity,e=a.rotation;b.acceleration&&(c.x=b.acceleration.x,c.y=b.acceleration.y,c.z=b.acceleration.z),b.accelerationIncludingGravity&&(d.x=b.accelerationIncludingGravity.x,d.y=b.accelerationIncludingGravity.y,d.z=b.accelerationIncludingGravity.z),b.rotationRate&&(e.x=e.beta=b.rotationRate.beta,e.y=e.gamma=b.rotationRate.gamma,e.z=e.alpha=b.rotationRate.alpha)}),window.addEventListener("deviceorientation",function(b){var c=a.orientation;c.alpha=b.alpha,c.beta=b.beta,c.gamma=b.gamma})}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Color=tm.createClass({r:255,g:255,b:255,a:1,init:function(){this.set.apply(this,arguments)},set:function(a,b,c,d){return this.r=a,this.g=b,this.b=c,this.a=void 0!==d?d:1,this},setFromNumber:function(a,b,c,d){return this.r=a,this.g=b,this.b=c,this.a=void 0!==d?d:1,this},setFromArray:function(a){return this.set.apply(this,a)},setFromObject:function(a){return this.set(a.r,a.g,a.b,a.a)},setFromString:function(a){var b=tm.graphics.Color.stringToNumber(a);return this.set(b[0],b[1],b[2],b[3])},setSmart:function(){var a=arguments[0];return arguments.length>=3?this.set(arguments.r,arguments.g,arguments.b,arguments.a):a instanceof Array?this.setFromArray(a):a instanceof Object?this.setFromObject(a):"string"==typeof a&&this.setFromString(a),this},toStyleAsHex:function(){return"#{0}{1}{2}".format(this.r.toString(16).padding(2,"0"),this.g.toString(16).padding(2,"0"),this.b.toString(16).padding(2,"0"))},toStyleAsRGB:function(){return"rgb({r},{g},{b})".format({r:~~this.r,g:~~this.g,b:~~this.b})},toStyleAsRGBA:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})},toStyle:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})}});var a={hex111:{reg:/^#(\w{1})(\w{1})(\w{1})$/,exec:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},hex222:{reg:/^#(\w{2})(\w{2})(\w{2})$/,exec:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},rgb:{reg:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,exec:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},rgba:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseFloat(a[4])]}},hsl:{reg:/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,exec:function(a){return tm.graphics.Color.HSLtoRGB(a[1],a[2],a[3])}},hsla:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(a){return Color.HSLAtoRGBA(a[1],a[2],a[3],a[4])}}};tm.graphics.Color.COLOR_LIST={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]},tm.graphics.Color.strToNum=tm.graphics.Color.stringToNumber=function(b){var c=null;if("#"===b[0]?c=4==b.length?"hex111":"hex222":"r"===b[0]&&"g"===b[1]&&"b"===b[2]?c="a"==b[3]?"rgba":"rgb":"h"===b[0]&&"s"===b[1]&&"l"===b[2]&&(c="a"==b[3]?"hsla":"hsl"),c){var d=a[c],e=b.match(d.reg);value=d.exec(e)}else Color.COLOR_LIST[b]&&(value=Color.COLOR_LIST[b]);return value},tm.graphics.Color.HSLtoRGB=function(a,b,c){var d,e,f;if(a%=360,a+=360,a%=360,b*=.01,c*=.01,0==b){var c=Math.round(255*c);return[c,c,c]}var g=.5>c?c*(1+b):c+b-c*b,h=2*c-g,i=(a+120)%360;return d=60>i?h+(g-h)*i/60:180>i?g:h,i=a,e=60>i?h+(g-h)*i/60:180>i?g:240>i?h+(g-h)*(240-i)/60:h,i=(a-120+360)%360,f=60>i?h+(g-h)*i/60:180>i?g:240>i?h+(g-h)*(240-i)/60:h,[parseInt(255*d),parseInt(255*e),parseInt(255*f)]},tm.graphics.Color.HSLAtoRGBA=function(a,b,c,d){var e=Color.HSLtoRGB(a,b,c);return e[3]=d,rgb},tm.graphics.Color.createStyleRGB=function(a,b,c){return"rgba("+a+","+b+","+c+")"},tm.graphics.Color.createStyleRGBA=function(a,b,c,d){return"rgba("+a+","+b+","+c+","+d+")"},tm.graphics.Color.createStyleHSL=function(a,b,c){return"hsl("+a+","+b+"%,"+c+"%)"},tm.graphics.Color.createStyleHSLA=function(a,b,c,d){return"hsla("+a+","+b+"%,"+c+"%,"+d+")"}}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas=tm.createClass({element:null,canvas:null,context:null,init:function(a){this.canvas=null,this.canvas="string"==typeof a?document.querySelector(a):a||document.createElement("canvas"),this.element=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},resize:function(a,b){return this.canvas.width=a,this.canvas.height=b,this},resizeWindow:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},resizeToFitScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},fitWindow:function(a){var b=function(){a=void 0===a?!0:a;var b=this.element,c=b.style;c.position="absolute",c.margin="auto",c.left="0px",c.top="0px",c.bottom="0px",c.right="0px";var d=b.width/window.innerWidth,e=b.height/window.innerHeight,f=b.height/b.width;d>e?(c.width=innerWidth.floor()+"px",c.height=(innerWidth*f).floor()+"px"):(c.width=(innerHeight/f).floor()+"px",c.height=innerHeight.floor()+"px")}.bind(this);b(),a&&window.addEventListener("resize",b,!1)},clear:function(a,b,c,d){return a=a||0,b=b||0,c=c||this.width,d=d||this.height,this.context.clearRect(a,b,c,d),this},clearColor:function(a,b,c,d,e){return b=b||0,c=c||0,d=d||this.width,e=e||this.height,this.save(),this.resetTransform(),this.fillStyle=a,this.context.fillRect(b,c,d,e),this.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(a,b){return this.context.moveTo(a,b),this},lineTo:function(a,b){return this.context.lineTo(a,b),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(a,b){return this.strokeRect(a,b,1,1)},line:function(a,b,c,d){return this.moveTo(a,b).lineTo(c,d)},drawLine:function(a,b,c,d){return this.beginPath().line(a,b,c,d).stroke()},drawDashLine:function(a,b,c,d,e){var f=null;"string"==typeof e?f=e:(e=e||61680,f=e.toString(2)),f=f.padding(16,"1");var g=c-a,h=d-b,i=Math.sqrt(g*g+h*h);g/=i,h/=i;for(var j=a,k=b,l=0;i>l;++l)"1"==f[l%16]&&this.drawPoint(j,k),j+=g,k+=h;return this},drawArrow:function(a,b,c,d,e){var f=c-a,g=d-b,h=180*Math.atan2(g,f)/Math.PI;return this.drawLine(a,b,c,d),this.fillPolygon(c,d,e||5,3,h),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var a=1,b=arguments.length/2;b>a;++a)this.lineTo(arguments[2*a],arguments[2*a+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(a,b,c,d,e){var f=a+e,g=a+c-e,h=b+e,i=b+d-e;return this.context.arc(f,h,e,-Math.PI,.5*-Math.PI,!1),this.context.arc(g,h,e,.5*-Math.PI,0,!1),this.context.arc(g,i,e,0,.5*Math.PI,!1),this.context.arc(f,i,e,.5*Math.PI,Math.PI,!1),this.closePath(),this},fillRoundRect:function(a,b,c,d,e){return this.beginPath().roundRect(a,b,c,d,e).fill()},strokeRoundRect:function(a,b,c,d,e){return this.beginPath().roundRect(a,b,c,d,e).stroke()},polygon:function(a,b,c,d,e){var f=2*Math.PI/d,g=void 0!=e?e*Math.PI/180:-Math.PI/2;this.moveTo(a+Math.cos(g)*c,b+Math.sin(g)*c);for(var h=1;d>h;++h){var i=f*h+g;this.lineTo(a+Math.cos(i)*c,b+Math.sin(i)*c)}return this.closePath(),this},fillPolygon:function(a,b,c,d,e){return this.beginPath().polygon(a,b,c,d,e).fill()},strokePolygon:function(a,b,c,d,e){return this.beginPath().polygon(a,b,c,d,e).stroke()},star:function(a,b,c,d,e,f){var g=c*(e||.38),h=f?f*Math.PI/180:-Math.PI/2,i=2*Math.PI/d/2;this.moveTo(a+Math.cos(h)*c,b+Math.sin(h)*c);for(var j=1;2*d>j;++j){var k=i*j+h,l=j%2?g:c;this.lineTo(a+Math.cos(k)*l,b+Math.sin(k)*l)}return this.closePath(),this},fillStar:function(a,b,c,d,e,f){return this.beginPath().star(a,b,c,d,e,f).fill()},strokeStar:function(a,b,c,d,e,f){return this.beginPath().star(a,b,c,d,e,f).stroke()},heart:function(a,b,c,d){var e=.5*c,f=void 0===d?Math.PI/4:Math.degToRad(d),g=Math.cos(f)*e,h=Math.sin(f)*e,i=-e,j=(e*e-g*i)/h,k=j+e,l=e-k/2;return this.moveTo(0+a,j+b+l),this.arc(-e+a,0+b+l,e,Math.PI-f,2*Math.PI),this.arc(e+a,0+b+l,e,Math.PI,f),this.closePath(),this},fillHeart:function(a,b,c,d){return this.beginPath().heart(a,b,c,d).fill()},strokeHeart:function(a,b,c,d){return this.beginPath().heart(a,b,c,d).stroke()},circle:function(a,b,c){return this.context.arc(a,b,c,0,2*Math.PI,!1),this},fillCircle:function(a,b,c){var d=this.context;return d.beginPath(),d.arc(a,b,c,0,2*Math.PI,!1),d.closePath(),d.fill(),this},strokeCircle:function(a,b,c){return this.beginPath().circle(a,b,c).stroke()},arc:function(a,b,c,d,e,f){return this.context.arc(a,b,c,d,e,f),this},fillArc:function(a,b,c,d,e,f){return this.beginPath().arc(a,b,c,d,e,f).fill()},strokeArc:function(a,b,c,d,e,f){return this.beginPath().arc(a,b,c,d,e,f).stroke()},triangle:function(a,b,c,d,e,f){return this.moveTo(a,b).lineTo(c,d).lineTo(e,f),this.closePath(),this},fillTriangle:function(a,b,c,d,e,f){return this.beginPath().triangle(a,b,c,d,e,f).fill()},strokeTriangle:function(a,b,c,d,e,f){return this.beginPath().triangle(a,b,c,d,e,f).stroke()},fillText:function(){return this.context.fillText.apply(this.context,arguments)},strokeText:function(){return this.context.strokeText.apply(this.context,arguments)},fillVerticalText:function(a,b,c){this._drawVerticalText("fillText",a,b,c)},strokeVerticalText:function(a,b,c){this._drawVerticalText("strokeText",a,b,c)},_drawVerticalText:function(a,b,c,d){var e=this.context,f=(b.split("\n"),this.context.measureText("あ").width);e.save(),e.textAlign="right",e.textBaseline="top",Array.prototype.forEach.call(b,function(b,g){e[a](b,c,d+f*g)}),e.restore()},_drawLabelArea:function(a,b){var c=this.context,d=b.text,e=this.context.measureText("あ").width,f=d.split("\n"),g=(b.lineSpace||1)*e;if(c.save(),b.mode&&"horizon"!=b.mode){var h=Math.max(b.height/e|0,1),i=b.x+b.width,j=[];f.each(function(a){for(var b=0,c=a.length;c>b;b+=h){var d=a.substr(b,h);j.push(d)}});var k=a+"VerticalText";j.each(function(a,c){this[k](a,i-c*g,b.y+15)}.bind(this))}else{var h=Math.max(b.width/e|0,1),j=[];c.textAlign="left",c.textBaseline="top",f.each(function(a){for(var b=0,c=a.length;c>b;b+=h){var d=a.substr(b,h);j.push(d)}});var k=a+"Text";j.each(function(a,d){c[k](a,b.x,b.y+d*g+4)})}c.restore()},fillLabelArea:function(a){this._drawLabelArea("fill",a)},strokeLabelArea:function(a){this._drawLabelArea("stroke",a)},drawImage:function(a,b,c){this.context.drawImage.apply(this.context,arguments)},drawTexture:function(a){return arguments[0]=a.element,this.context.drawImage.apply(this.context,arguments),this},drawBitmap:function(a){return arguments[0]=a.imageData,this.context.putImageData.apply(this.context,arguments),this},drawScale9Image:function(a,b,c){var d=c.x,e=c.width,f=a.width-(d+e),g=b.width-(d+f),h=c.y;return this.drawImage(a,0,0,d,h,b.x,b.y,d,h),this.drawImage(a,d,0,e,h,b.x+d,b.y,g,h),this.drawImage(a,d+e,0,f,h,b.x+d+g,b.y,f,h),this},setTransform:function(a,b,c,d,e,f){return this.context.setTransform(a,b,c,d,e,f),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},setTransformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},transform:function(a,b,c,d,e,f){return this.context.transform(a,b,c,d,e,f),this},save:function(){return this.context.save(),this},restore:function(){return this.context.restore(),this},translate:function(a,b){return this.context.translate(a,b),this},rotate:function(a){return this.context.rotate(a),this},scale:function(a,b){return this.context.scale(a,b),this},saveAsImage:function(a){a=a||tm.graphics.Canvas.MIME_TYPE_PNG;var b=this.canvas.toDataURL(a);window.open(b,"save")},setCompositing:function(){},setFillStyle:function(a){return this.context.fillStyle=a,this},setStrokeStyle:function(a){return this.context.strokeStyle=a,this},setColorStyle:function(a,b){return b=b||a,this.context.strokeStyle=a,this.context.fillStyle=b,this},setText:function(a,b,c){var d=this.context;d.font=a,d.textAlign=b,d.textBaseline=c},setLineStyle:function(width,cap,join,miter){with(this.context)lineWidth=width||1,lineCap=cap||"round",lineJoin=join||"round",miterLimit=miter||10;return this},setShadow:function(a,b,c,d){var e=this.context;return e.shadowColor=a||"black",e.shadowOffsetX=b||0,e.shadowOffsetY=c||0,e.shadowBlur=d||0,this},getElement:function(){return this.element}}),tm.graphics.Canvas.MIME_TYPE_PNG="image/png",tm.graphics.Canvas.MIME_TYPE_JPG="image/jpeg",tm.graphics.Canvas.MIME_TYPE_SVG="image/svg+xml",tm.graphics.Canvas.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(a){this.canvas.width=a}}),tm.graphics.Canvas.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(a){this.canvas.height=a}}),tm.graphics.Canvas.prototype.accessor("fillStyle",{get:function(){return this.context.fillStyle},set:function(a){this.context.fillStyle=a}}),tm.graphics.Canvas.prototype.accessor("strokeStyle",{get:function(){return this.context.strokeStyle},set:function(a){this.context.strokeStyle=a}}),tm.graphics.Canvas.prototype.accessor("globalAlpha",{get:function(){return this.context.globalAlpha},set:function(a){this.context.globalAlpha=a}}),tm.graphics.Canvas.prototype.accessor("globalCompositeOperation",{get:function(){return this.context.globalCompositeOperation},set:function(a){this.context.globalCompositeOperation=a}}),tm.graphics.Canvas.prototype.accessor("shadowBlur",{get:function(){return this.context.shadowBlur},set:function(a){this.context.shadowBlur=a}}),tm.graphics.Canvas.prototype.accessor("shadowColor",{get:function(){return this.context.shadowColor},set:function(a){this.context.shadowColor=a}}),tm.graphics.Canvas.prototype.accessor("shadowOffsetX",{get:function(){return this.context.shadowOffsetX},set:function(a){this.context.shadowOffsetX=a}}),tm.graphics.Canvas.prototype.accessor("shadowOffsetY",{get:function(){return this.context.shadowOffsetY},set:function(a){this.context.shadowOffsetY=a}}),tm.graphics.Canvas.prototype.accessor("lineCap",{get:function(){return this.context.lineCap},set:function(a){this.context.lineCap=a}}),tm.graphics.Canvas.prototype.accessor("lineJoin",{get:function(){return this.context.lineJoin},set:function(a){this.context.lineJoin=a}}),tm.graphics.Canvas.prototype.accessor("miterLimit",{get:function(){return this.context.miterLimit},set:function(a){this.context.miterLimit=a}}),tm.graphics.Canvas.prototype.accessor("lineWidth",{get:function(){return this.context.lineWidth},set:function(a){this.context.lineWidth=a}}),tm.graphics.Canvas.prototype.accessor("font",{get:function(){return this.context.font},set:function(a){this.context.font=a}}),tm.graphics.Canvas.prototype.accessor("textAlign",{get:function(){return this.context.textAlign},set:function(a){this.context.textAlign=a}}),tm.graphics.Canvas.prototype.accessor("textBaseline",{get:function(){return this.context.textBaseline},set:function(a){this.context.textBaseline=a}}),tm.graphics.Canvas.prototype.getter("centerX",function(){return this.canvas.width/2}),tm.graphics.Canvas.prototype.getter("centerY",function(){return this.canvas.height/2}),tm.graphics.Canvas.prototype.accessor("imageSmoothingEnabled",{get:function(){return this.context.imageSmoothingEnabled},set:function(a){this.context.imageSmoothingEnabled=a,this.context.webkitImageSmoothingEnabled=a,this.context.mozImageSmoothingEnabled=a}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Bitmap=tm.createClass({imageData:null,init:function(){a||(a=document.createElement("canvas"),b=a.getContext("2d")),this._init.apply(this,arguments),this.init=this._init},_init:function(a){if(1==arguments.length)this.imageData=a,this.data=a.data;else if(2==arguments.length){var c=arguments[0],d=arguments[1];this.imageData=b.createImageData(c,d),this.data=this.imageData.data}},getPixelIndex:function(a){
var b=4*a;return[this.data[b+0],this.data[b+1],this.data[b+2],this.data[b+3]]},getPixelXY:function(a,b){return this.getPixelIndex(this.posToIndex(a,b))},getPixel:function(a,b){return this.getPixelIndex(this.posToIndex(a,b))},getPixelAsNumber:function(a){var b=4*a;return this.data[b+3]<<24|this.data[b+0]<<16|this.data[b+1]<<8|this.data[b+2]},getPixelAsObject:function(a){var b=4*a;return{r:this.data[b+0],g:this.data[b+1],b:this.data[b+2],a:this.data[b+3]}},getPixelAsArray:function(a){var b=4*a;return[this.data[b+0],this.data[b+1],this.data[b+2],this.data[b+3]]},getPixelAverage:function(a,b,c,d){var e=[0,0,0,0],f=a,g=a+c,h=b,i=b+d;0>f&&(f=0),g>this.width&&(g=this.width),0>h&&(h=0),i>this.height&&(i=this.height);for(var j=[],k=this.width,l=h;i>l;++l)for(var m=f;g>m;++m){var n=k*l+m;j.push(this.getPixelIndex(n))}for(var o=o=j.length,l=0;o>l;++l)e[0]+=j[l][0],e[1]+=j[l][1],e[2]+=j[l][2],e[3]+=j[l][3];return e[0]/=o,e[1]/=o,e[2]/=o,e[3]/=o,e},setPixelIndex:function(a,b,c,d){var e=4*a;return this.data[e+0]=b,this.data[e+1]=c,this.data[e+2]=d,this},setPixelXY:function(a,b,c,d,e){return this.setPixelIndex(b*this.imageData.width+a,c,d,e)},setPixel:function(a,b,c,d){return this.setPixelIndex(y*this.imageData.width+x,b,c,d)},setPixel32Index:function(a,b,c,d,e){var f=4*a;return this.data[f+0]=b,this.data[f+1]=c,this.data[f+2]=d,this.data[f+3]=e,this},setPixel32:function(a,b,c,d,e,f){return this.setPixel32Index(b*this.width+a,c,d,e,f)},setPixel32XY:function(a,b,c,d,e,f){return this.setPixel32Index(b*this.width+a,c,d,e,f)},setPixelFromArray:function(a,b){return this.setPixel(a,b[0],b[1],b[2])},setPixel32FromArray:function(a,b){return this.setPixel32(a,b[0],b[1],b[2],b[3])},setPixelFromNumber:function(a,b){return this.setPixel(a,(16711680&b)>>>16,(65280&b)>>>8,(255&b)>>>0)},setPixel32FromNumber:function(a,b){return this.setPixel32(a,(16711680&b)>>>16,(65280&b)>>>8,(255&b)>>>0,(4278190080&b)>>>24)},setPixelFromObject:function(a,b){return this.setPixel(b.r,b.g,b.b)},setPixel32FromObject:function(a,b){return this.setPixel32(b.r,b.g,b.b,b.a)},setPixelFromString:function(){},posToIndex:function(a,b){return b*this.imageData.width+a},filter:function(a){for(var b=0;b<this.height;++b)for(var c=0;c<this.width;++c){var d=this.posToIndex(c,b),e=this.getPixel(c,b);a.calc(e,d,c,b,this)}return this},noise:function(a,b){a=a||0,b=b||255,range=b-a;for(var c=0,d=this.length;d>c;++c){var e=this.getPixelIndex(c);e[0]=Math.random()*range+a,e[1]=Math.random()*range+a,e[2]=Math.random()*range+a,e[3]=255,this.setPixel32Index(c,e[0],e[1],e[2],e[3])}},applyFilter:function(){}}),tm.graphics.Bitmap.prototype.accessor("width",{get:function(){return this.imageData.width},set:function(a){this.imageData.width=a}}),tm.graphics.Bitmap.prototype.accessor("height",{get:function(){return this.imageData.height},set:function(a){this.imageData.height=a}}),tm.graphics.Bitmap.prototype.getter("length",function(){return this.imageData.width*this.imageData.height}),tm.graphics.Canvas.prototype.getBitmap=function(a,b,c,d){return tm.graphics.Bitmap(this.context.getImageData(a||0,b||0,c||this.width,d||this.height))},tm.graphics.Canvas.prototype.createBitmap=function(a,b){return tm.graphics.Bitmap(this.context.createImageData(a||this.width,b||this.height))},tm.asset.Texture.prototype.getBitmap=function(a,b,c,d){var e=tm.graphics.Canvas();return e.resize(this.width,this.height),e.drawTexture(this,0,0,this.width,this.height),e.getBitmap(a,b,c,d)};var a=null,b=null}(),tm.graphics=tm.graphics||{},function(){tm.graphics.MonochromeFilter=tm.createClass({init:function(){},apply:function(a,b){for(var c=a.length,d=0;c>d;++d){var e=a.getPixelIndex(d),f=.3*e[0]+.59*e[1]+.11*e[2];b.setPixel32Index(d,f,f,f,e[3])}return b}})}(),function(){tm.graphics.ReverseFilter=tm.createClass({init:function(){},apply:function(a,b){for(var c=0,d=a.width*a.height;d>c;++c){var e=a.getPixelIndex(c);e[0]=255-e[0],e[1]=255-e[1],e[2]=255-e[2],b.setPixel32Index(c,e[0],e[1],e[2],255)}return b}})}(),function(){tm.graphics.BlurFilter=tm.createClass({init:function(a,b,c){this.blurX=a||4,this.blurY=b||4,this.quality=c||1},apply:function(a,b){for(var c=Math.floor(this.blurX/2),d=Math.floor(this.blurY/2),e=this.blurX,f=this.blurY,g=a.width,h=a.height,i=a.length,j=function(a,b){for(var h=0;i>h;++h){var j=h%g,k=Math.floor(h/g),l=a.getPixelAverage(j-c,k-d,e,f);b.setPixel32Index(h,l[0],l[1],l[2],255)}},k=a,l=0;l<this.quality;++l)a=k,k=tm.graphics.Bitmap(g,h),j(a,k);return b.imageData=k.imageData,b}})}(),function(){for(var a=[],b=0;255>b;++b){var c=0;c=100>b?60:150>b?150:180>b?180:220,a[b]=c}tm.graphics.ToonFilter=tm.createClass({toonTable:null,init:function(b){this.toonTable=b||a},apply:function(a,b){for(var c=0,d=a.width*a.height;d>c;++c){var e=a.getPixelIndex(c),f=this.toonTable[e[0]],g=this.toonTable[e[1]],h=this.toonTable[e[2]];b.setPixel32Index(c,f,g,h,255)}return b}})}(),function(){tm.graphics.ColorMatrixFilter=tm.createClass({init:function(a){this.colorMatrix=a},apply:function(a,b){for(var c=this.colorMatrix,d=0,e=a.length;e>d;++d){var f=a.getPixelIndex(d),g=f[0]*c[0]+f[1]*c[1]+f[2]*c[2]+f[3]*c[3]+c[4],h=f[0]*c[5]+f[1]*c[6]+f[2]*c[7]+f[3]*c[8]+c[9],i=f[0]*c[10]+f[1]*c[11]+f[2]*c[12]+f[3]*c[13]+c[14],j=f[0]*c[15]+f[1]*c[16]+f[2]*c[17]+f[3]*c[18]+c[19];b.setPixel32Index(d,g,h,i,j)}return b}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas.prototype.setGradient=function(a){this.context.fillStyle=a.gradient}}(),function(){tm.graphics.LinearGradient=tm.createClass({init:function(c,d,e,f){a||(a=document.createElement("canvas"),b=a.getContext("2d")),this._init(c,d,e,f),this.init=this._init},_init:function(a,c,d,e){this.gradient=b.createLinearGradient(a,c,d,e)},addColorStop:function(a,b){return this.gradient.addColorStop(a,b),this},addColorStopList:function(a){for(var b=0,c=a.length;c>b;++b){var d=a[b].offset,e=a[b].color;this.addColorStop(d,e)}return this},toStyle:function(){return this.gradient}}),tm.graphics.RadialGradient=tm.createClass({init:function(c,d,e,f,g,h){a||(a=document.createElement("canvas"),b=a.getContext("2d")),this._init(c,d,e,f,g,h),this.init=this._init},_init:function(a,c,d,e,f,g){this.gradient=b.createRadialGradient(a,c,d,e,f,g)},addColorStop:function(a,b){return this.gradient.addColorStop(a,b),this},addColorStopList:function(a){for(var b=0,c=a.length;c>b;++b){var d=a[b].offset,e=a[b].color;this.addColorStop(d,e)}return this},toStyle:function(){return this.gradient}});var a=null,b=null}(),tm.anim=tm.anim||{},function(){tm.anim.Tween=tm.createClass({superClass:tm.event.EventDispatcher,target:null,time:null,prop:null,nowProps:null,now:null,begin:null,finish:null,duration:null,isLooping:null,isPlaying:null,func:Math.linear,fps:30,init:function(){this.superInit(),this.time=0,this.nowProps={},this.isPlaying=!1,arguments.length>0&&this.to.apply(this,arguments)},to:function(a,b,c,d){var e={};for(var f in b)e[f]=a[f];return this.fromTo(a,e,b,c,d),this},by:function(a,b,c,d){var e={},f={};for(var g in b)e[g]=a[g],f[g]=a[g]+b[g];return this.fromTo(a,e,f,c,d),this},fromTo:function(a,b,c,d,e){this.target=a,this.beginProps=b,this.finishProps=c,this.duration=d,this.changeProps={};for(var f in b)this.changeProps[f]=c[f]-b[f];return this.setTransition(e),this},from:function(a,b,c,d){var e={};for(var f in b)e[f]=a[f];return this.fromTo(a,b,e,c,d),this},setTransition:function(a){return this.func="function"==typeof a?a:"string"==typeof a?tm.anim.easing[a]:tm.anim.easing["default"],this},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("resume",this.time,this.nowProps))},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("start",this.time,this.nowProps))},stop:function(){this.isPlaying=!1,this.dispatchEvent(tm.event.TweenEvent("stop",this.time,this.nowProps))},rewind:function(){this.time=0,this.update()},fforward:function(){this.time=this.duration,this.update()},yoyo:function(){var a=this.finishProps;this.finishProps=this.beginProps,this.beginProps=a;for(var b in this.beginProps)this.changeProps[b]=this.finishProps[b]-this.beginProps[b];this.start()},update:function(){for(var a in this.changeProps)this.nowProps[a]=this.func(this.time,this.beginProps[a],this.changeProps[a],this.duration),this.target[a]=this.nowProps[a];this.dispatchEvent(tm.event.TweenEvent("change",this.time,this.nowProps))},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_startTime:function(){this.startTime=(new Date).getTime()},_updateTime:function(){this.isPlaying&&(this._setTime((new Date).getTime()-this.startTime),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_setTime:function(a){var b=a;b>this.duration?this.isLooping?(this.rewind(),this.update(),this.dispatchEvent(tm.event.TweenEvent("loop",this.time,this.nowProps))):(this.time=this.duration,this.update(),this.stop(),this.dispatchEvent(tm.event.TweenEvent("finish",this.time,this.nowProps))):(this.time=b,this.update())}})}(),function(){tm.anim.easing={"default":function(a,b,c,d){return c*a/d+b},linear:function(a,b,c,d){return c*a/d+b},swing:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},easeInOutCubic:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeOutInCubic:function(a,b,c,d){return d/2>a?tm.anim.easing.easeOutCubic(2*a,b,c/2,d):tm.anim.easing.easeInCubic(2*a-d,b+c/2,c/2,d)},easeInQuart:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutQuart:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},easeOutInQuart:function(a,b,c,d){return d/2>a?tm.anim.easing.easeOutQuart(2*a,b,c/2,d):tm.anim.easing.easeInQuart(2*a-d,b+c/2,c/2,d)},easeInQuint:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},easeOutQuint:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},easeOutInQuint:function(a,b,c,d){return d/2>a?tm.anim.easing.easeOutQuint(2*a,b,c/2,d):tm.anim.easing.easeInQuint(2*a-d,b+c/2,c/2,d)},easeInSine:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},easeOutSine:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},easeInOutSine:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},easeOutInSine:function(a,b,c,d){return d/2>a?tm.anim.easing.easeOutSine(2*a,b,c/2,d):tm.anim.easing.easeInSine(2*a-d,b+c/2,c/2,d)},easeInExpo:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b-.001*c},easeOutExpo:function(a,b,c,d){return a==d?b+c:1.001*c*(-Math.pow(2,-10*a/d)+1)+b},easeInOutExpo:function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b-5e-4*c:c/2*1.0005*(-Math.pow(2,-10*--a)+2)+b},easeOutInExpo:function(a,b,c,d){return d/2>a?tm.anim.easing.easeOutExpo(2*a,b,c/2,d):tm.anim.easing.easeInExpo(2*a-d,b+c/2,c/2,d)},easeInCirc:function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},easeOutCirc:function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},easeInOutCirc:function(a,b,c,d){return(a/=d/2)<1?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeOutInCirc:function(a,b,c,d){return d/2>a?tm.anim.easing.easeOutCirc(2*a,b,c/2,d):tm.anim.easing.easeInCirc(2*a-d,b+c/2,c/2,d)},easeInElastic:function(a,b,c,d,e,f){var g;return 0==a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},easeOutElastic:function(a,b,c,d,e,f){var g;return 0==a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},easeInOutElastic:function(a,b,c,d,e,f){var g;return 0==a?b:2==(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},easeOutInElastic:function(a,b,c,d,e,f){return d/2>a?tm.anim.easing.easeOutElastic(2*a,b,c/2,d,e,f):tm.anim.easing.easeInElastic(2*a-d,b+c/2,c/2,d,e,f)},easeInBack:function(a,b,c,d,e){return void 0==e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},easeOutBack:function(a,b,c,d,e){return void 0==e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeInOutBack:function(a,b,c,d,e){return void 0==e&&(e=1.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},easeOutInBack:function(a,b,c,d,e){return d/2>a?tm.anim.easing.easeOutBack(2*a,b,c/2,d,e):tm.anim.easing.easeInBack(2*a-d,b+c/2,c/2,d,e)},easeInBounce:function(a,b,c,d){return c-tm.anim.easing.easeOutBounce(d-a,0,c,d)+b},easeOutBounce:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},easeInOutBounce:function(a,b,c,d){return d/2>a?.5*tm.anim.easing.easeInBounce(2*a,0,c,d)+b:.5*tm.anim.easing.easeOutBounce(2*a-d,0,c,d)+.5*c+b},easeOutInBounce:function(a,b,c,d){return d/2>a?tm.anim.easing.easeOutBounce(2*a,b,c/2,d):tm.anim.easing.easeInBounce(2*a-d,b+c/2,c/2,d)}}}(),function(){tm.define("tm.app.Timer",{frame:0,fps:30,frameTime:1e3/30,init:function(){this.frame=0,this.fps=tm.app.Timer["default"].fps},reset:function(){return this.frame=0,this},update:function(){return this.frame=this.frame+1,this},getFrame:function(){return this.frame},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},checkIntervalEnd:function(a){var b=a/this.fps|0;return this.frame%b==0?!0:!1},checkBetween:function(a,b){1==arguments.length&&(b=Math.max(a,0),a=b-this.frameTime);var c=this.frame/this.fps*1e3;return b>(c>=a)},_update:function(){var a=this.frame/this.fps;this._seconds=0|a,this._milliseconds=1e3*a|0}}),tm.app.Timer.prototype.accessor("frame",{get:function(){return this._frame},set:function(a){this._frame=a,this._update()}}),tm.app.Timer.prototype.accessor("fps",{get:function(){return this._fps},set:function(a){a!==this._fps&&(this.frameTime=1e3/a),this._fps=a,this._update()}}),tm.app.Timer["default"]={fps:30}}(),function(){tm.define("tm.app.Updater",{app:null,init:function(a){this.app=a},update:function(a){this._updateElement(a)},_updateElement:function(a){var b=this.app;if(0!=a.awake){if(a.update&&a.update(b),a.hasEventListener("enterframe")){var c=tm.event.Event("enterframe");c.app=b,a.fire(c)}a.interactive&&a._checkPointing(b);var d=a.children.length;if(d>0)for(var e=a.children.slice(),f=0;d>f;++f)this._updateElement(e[f])}}})}(),tm.app=tm.app||{},function(){tm.app.BaseApp=tm.createClass({superClass:tm.event.EventDispatcher,element:null,mouse:null,touch:null,pointing:null,keyboard:null,accelerometer:null,updater:null,stats:null,timer:null,awake:null,_scenes:null,_sceneIndex:0,init:function(a){this.superInit(),this.element=a,this.timer=tm.app.Timer(),this.mouse=tm.input.Mouse(this.element),this.touch=tm.input.Touch(this.element,0),this.keyboard=tm.input.Keyboard(),this.pointing=tm.isMobile?this.touch:this.mouse,this.element.addEventListener("touchstart",function(){this.pointing=this.touch}.bind(this)),this.element.addEventListener("mousedown",function(){this.pointing=this.mouse}.bind(this)),this.accelerometer=tm.input.Accelerometer(),this.updater=tm.app.Updater(this),this.awake=!0,this._scenes=[tm.app.Scene()],this._sceneIndex=0,this.element.addEventListener("touchstart",function(a){a.stop()}),this.element.addEventListener("touchmove",function(a){a.stop()}),window.addEventListener("focus",function(){this.fire(tm.event.Event("focus")),this.currentScene.dispatchEvent(tm.event.Event("focus"))}.bind(this)),window.addEventListener("blur",function(){this.fire(tm.event.Event("blur")),this.currentScene.dispatchEvent(tm.event.Event("blur"))}.bind(this)),this.element.addEventListener(tm.isMobile?"touchend":"mouseup",this._onclick.bind(this))},run:function(){var a=this;this.startedTime=new Date,this.prevTime=new Date,this.deltaTime=0;var b=function(){var c=(new Date).getTime();a._loop();var d=(new Date).getTime()-c,e=a.timer.frameTime-d;setTimeout(b,e)};return b(),this},_loop:function(){this.update&&this.update(),this._update(),this.draw&&this.draw(),this._draw();var a=new Date;this.deltaTime=a-this.prevTime,this.prevTime=a,this.stats&&this.stats.update()},replaceScene:function(a){var b=null;return this.currentScene&&(b=tm.event.Event("exit"),b.app=this,this.currentScene.dispatchEvent(b),this.currentScene.app=null),b=tm.event.Event("enter"),b.app=this,this.currentScene=a,this.currentScene.app=this,this.currentScene.dispatchEvent(b),this},pushScene:function(a){this.fire(tm.event.Event("push"));var b=tm.event.Event("pause");b.app=this,this.currentScene.dispatchEvent(b),this._scenes.push(a),++this._sceneIndex,this.fire(tm.event.Event("pushed"));var b=tm.event.Event("enter");return b.app=this,a.app=this,a.dispatchEvent(b),this},popScene:function(){this.fire(tm.event.Event("pop"));var a=this._scenes.pop();--this._sceneIndex;var b=tm.event.Event("exit");b.app=this,a.dispatchEvent(b),a.app=null,this.fire(tm.event.Event("poped"));var b=tm.event.Event("resume");return b.app=this,b.prevScene=a,this.currentScene.dispatchEvent(b),a},enableStats:function(){return window.Stats?(this.stats=new Stats,this.stats.domElement.style.position="fixed",this.stats.domElement.style.left="5px",this.stats.domElement.style.top="20px",document.body.appendChild(this.stats.domElement)):console.warn("not defined stats."),this},enableDatGUI:function(){if(window.dat){var a=new dat.GUI;return a}},start:function(){return this.awake=!0,this},stop:function(){return this.awake=!1,this},_update:function(){this.mouse.update(),this.keyboard._update(),this.touch.update(),this.awake&&(this.updater.update(this.currentScene),this.timer.update())},_draw:function(){},getElement:function(){return this.element},_onclick:function(){var a=function(b){b.children.length>0&&b.children.each(function(b){a(b)}),b._clickFlag&&b.hasEventListener("click")&&b.dispatchEvent(tm.event.Event("click")),b._clickFlag=!1};a(this.currentScene)}}),tm.app.BaseApp.prototype.accessor("currentScene",{get:function(){return this._scenes[this._sceneIndex]},set:function(a){this._scenes[this._sceneIndex]=a}}),tm.app.BaseApp.prototype.accessor("frame",{get:function(){return this.timer.frame},set:function(a){this.timer.frame=a}}),tm.app.BaseApp.prototype.accessor("fps",{get:function(){return this.timer.fps},set:function(a){this.timer.fps=a}})}(),tm.app=tm.app||{},function(){tm.app.Element=tm.createClass({superClass:tm.event.EventDispatcher,parent:null,children:null,init:function(){this.superInit(),this.children=[]},remove:function(){return console.assert(this.parent),this.parent.removeChild(this),this.parent=null,this},addChild:function(a){a.parent&&a.remove(),a.parent=this,this.children.push(a);var b=tm.event.Event("added");return a.dispatchEvent(b),a},addChildTo:function(a){return a.addChild(this),this},addChildren:function(a){for(var b=a.slice(),c=beginIndex,d=b.length;d>c;++c)this.addChild(b[c])},addChildAt:function(a,b){a.parent&&a.remove(),a.parent=this,this.children.splice(b,0,a);var c=tm.event.Event("added");return a.dispatchEvent(c),a},getChildAt:function(a){return this.children.at(a)},getChildIndex:function(a){return this.children.indexOf(a)},removeChild:function(a){var b=this.children.indexOf(a);if(-1!=b){this.children.splice(b,1);var c=tm.event.Event("removed");a.dispatchEvent(c)}},removeChildren:function(a){a=a||0;for(var b=this.children.slice(),c=a,d=b.length;d>c;++c)b[c].remove();this.children=[]},getChildByName:function(a){for(var b=0,c=this.children.length;c>b;++b)if(this.children[b].name==a)return this.children[b];return null},execChildren:function(a,b){b=b&&b.length?b:[b];for(var c=this.children.slice(),d=0,e=c.length;e>d;++d)a.apply(c[d],b)},getParent:function(){return this.parent},getRoot:function(){if(!this.parent)return null;var a=null;for(a=this.parent;null!=a.parent;a=a.parent);return a},fromJSON:function(b){var c=function(b,c){var d=c.init,e=d instanceof Array?d:[d],f=a[c.type]?a[c.type]:c.type,g=tm.using(f);console.assert(0!==Object.keys(g).length,g+" is not defined.");var h=g.apply(null,e).addChildTo(this);h.fromJSON(c),this[b]=h}.bind(this);for(var d in b){var e=b[d];if("children"==d)if(e instanceof Array)for(var f=0,g=e.length;g>f;++f){var h=e[f];c(h.name,h)}else for(var d in e){var h=e[d];c(d,h)}else"type"==d&&(d="__key"),this[d]=e}return this},toJSON:function(){}});var a={Sprite:"tm.display.Sprite",Label:"tm.display.Label",Shape:"tm.display.Shape",CircleShape:"tm.display.CircleShape",TriangleShape:"tm.display.TriangleShape",RectangleShape:"tm.display.RectangleShape",RoundRectangleShape:"tm.display.RoundRectangleShape",TextShape:"tm.display.TextShape",StarShape:"tm.display.StarShape",PolygonShape:"tm.display.PolygonShape",HeartShape:"tm.display.HeartShape",AnimationSprite:"tm.display.AnimationSprite",LabelButton:"tm.ui.LabelButton",IconButton:"tm.ui.IconButton",GlossyButton:"tm.ui.GlossyButton",FlatButton:"tm.ui.FlatButton"}}(),function(){tm.define("tm.app.Object2D",{superClass:"tm.app.Element",position:null,scale:null,rotation:0,awake:!0,_width:64,_height:64,init:function(){this.superInit(),this.position=tm.geom.Vector2(0,0),this.scale=tm.geom.Vector2(1,1),this.pointing=tm.geom.Vector2(0,0),this.origin=tm.geom.Vector2(.5,.5),this._matrix=tm.geom.Matrix33(),this._matrix.identity(),this.boundingType="circle",this.checkHierarchy=!0,this.interactive=!1,this.hitFlags=[],this.downFlags=[],this._clickFlag=!1,this._worldMatrix=tm.geom.Matrix33().identity(),this._worldAlpha=1},getFinalMatrix:function(){var a=tm.geom.Matrix33();return this.parent&&a.multiply(this.parent.getFinalMatrix()),a.translate(this.x,this.y),a.rotateZ(this.rotation*Math.DEG_TO_RAD),a.scale(this.scaleX,this.scaleY),a},isHitPoint:function(a,b){var c=this.globalToLocal(tm.geom.Vector2(a,b));return this.pointing.x=c.x,this.pointing.y=c.y,c.x*c.x+c.y*c.y<this.radius*this.radius?!0:!1},isHitPointCircle:function(a,b){var c=this.x-a,d=this.y-b;return c*c+d*d<this.radius*this.radius?!0:!1},isHitPointRect:function(a,b){var c=this.x-this.width*this.originX,d=this.x+this.width*(1-this.originX),e=this.y-this.height*this.originY,f=this.y+this.height*(1-this.originY);return a>c&&d>a&&b>e&&f>b?!0:!1},isHitPointCircleHierarchy:function(a,b){var c=this.globalToLocal(tm.geom.Vector2(a,b));return this.pointing.x=c.x,this.pointing.y=c.y,c.x*c.x+c.y*c.y<this.radius*this.radius?!0:!1},isHitPointRectHierarchy:function(a,b){var c=this.globalToLocal(tm.geom.Vector2(a,b));this.pointing.x=c.x,this.pointing.y=c.y;var d=-this.width*this.originX,e=+this.width*(1-this.originX),f=-this.height*this.originY,g=+this.height*(1-this.originY);return d<c.x&&c.x<e&&f<c.y&&c.y<g?!0:!1},isHitElement:function(a){this.parent.localToGlobal(this);return(this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)<(this.radius+a.radius)*(this.radius+a.radius)?!0:!1},isHitElementCircle:function(a){return tm.collision.testCircleCircle(this.getBoundingCircle(),a.getBoundingCircle())},isHitElementRect:function(a){return tm.collision.testRectRect(this.getBoundingRect(),a.getBoundingRect())},getBoundingCircle:function(){return tm.geom.Circle(this.centerX,this.centerY,this.radius)},getBoundingRect:function(){return tm.geom.Rect(this.left,this.top,this.width,this.height)},localToGlobal:function(a){return this.getFinalMatrix().multiplyVector2(a)},globalToLocal:function(a){var b=this._worldMatrix.clone();return b.invert(),b.transpose(),b.multiplyVector2(a)},setX:function(a){return this.position.x=a,this},setY:function(a){return this.position.y=a,this},setPosition:function(a,b){return this.position.x=a,this.position.y=b,this},setRotation:function(a){return this.rotation=a,this},setScale:function(a,b){return this.scale.x=a,this.scale.y=arguments.length<=1?a:b,this},setOrigin:function(a,b){return this.origin.x=a,this.origin.y=b,this},setWidth:function(a){return this.width=a,this},setHeight:function(a){return this.height=a,this},setSize:function(a,b){return this.width=a,this.height=b,this},wakeUp:function(){return this.awake=!0,this},sleep:function(){return this.awake=!1,this},setInteractive:function(a,b){return this.interactive=a,b&&(this.boundingType=b),this},setBoundingType:function(a){return this.boundingType=a,this},_checkPointing:function(){console.assert(!1)},_checkMouse:function(a){this.__checkPointing(a,a.pointing,0)},_checkTouch:function(a){this.__checkPointing(a,a.pointing,0)},__checkPointing:function(a,b,c){var d=(this.element,this.hitFlags[c]);this.hitFlags[c]=this.isHitPoint(b.x,b.y),!d&&this.hitFlags[c]&&this._dispatchPointingEvent("mouseover","touchover","pointingover",a,b),d&&!this.hitFlags[c]&&this._dispatchPointingEvent("mouseout","touchout","pointingout",a,b),this.hitFlags[c]&&b.getPointingStart()&&(this._dispatchPointingEvent("mousedown","touchstart","pointingstart",a,b),this.downFlags[c]=!0,this._clickFlag=!0),this.downFlags[c]&&this._dispatchPointingEvent("mousemove","touchmove","pointingmove",a,b),1==this.downFlags[c]&&b.getPointingEnd()&&(this._dispatchPointingEvent("mouseup","touchend","pointingend",a,b),this.downFlags[c]=!1)},_dispatchPointingEvent:function(a,b,c,d,e){this.dispatchEvent(tm.event.MouseEvent(a,d,e)),this.dispatchEvent(tm.event.TouchEvent(b,d,e)),this.dispatchEvent(tm.event.PointingEvent(c,d,e))},_calcWorldMatrix:function(){if(this.parent){if(this.rotation!=this.rotationCache){this.rotationCache=this.rotation;var a=this.rotation*Math.DEG_TO_RAD;this._sr=Math.sin(a),this._cr=Math.cos(a)}var b=this._matrix.m,c=this.parent._worldMatrix.m,d=this._worldMatrix.m;b[0]=this._cr*this.scale.x,b[1]=-this._sr*this.scale.y,b[3]=this._sr*this.scale.x,b[4]=this._cr*this.scale.y,b[2]=this.position.x,b[5]=this.position.y;var e=b[0],f=b[1],g=b[2],h=b[3],i=b[4],j=b[5],k=c[0],l=c[1],m=c[2],n=c[3],o=c[4],p=c[5];d[0]=k*e+l*h,d[1]=k*f+l*i,d[2]=k*g+l*j+m,d[3]=n*e+o*h,d[4]=n*f+o*i,d[5]=n*g+o*j+p}},_dirtyCalc:function(){this._calcWorldMatrix()}}),tm.app.Object2D.prototype.accessor("x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),tm.app.Object2D.prototype.accessor("y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),tm.app.Object2D.prototype.accessor("originX",{get:function(){return this.origin.x},set:function(a){this.origin.x=a}}),tm.app.Object2D.prototype.accessor("originY",{get:function(){return this.origin.y},set:function(a){this.origin.y=a}}),tm.app.Object2D.prototype.accessor("scaleX",{get:function(){return this.scale.x},set:function(a){this.scale.x=a}}),tm.app.Object2D.prototype.accessor("scaleY",{get:function(){return this.scale.y},set:function(a){this.scale.y=a}}),tm.app.Object2D.prototype.accessor("width",{get:function(){return this._width},set:function(a){this._width=a}}),tm.app.Object2D.prototype.accessor("height",{get:function(){return this._height},set:function(a){this._height=a}}),tm.app.Object2D.prototype.accessor("radius",{get:function(){return void 0!==this._radius?this._radius:(this.width+this.height)/4},set:function(a){this._radius=a}}),tm.app.Object2D.prototype.accessor("top",{get:function(){return this.y-this.height*this.originY},set:function(a){this.y=a+this.height*this.originY}}),tm.app.Object2D.prototype.accessor("right",{get:function(){return this.x+this.width*(1-this.originX)},set:function(a){this.x=a-this.width*(1-this.originX)}}),tm.app.Object2D.prototype.accessor("bottom",{get:function(){return this.y+this.height*(1-this.originY)},set:function(a){this.y=a-this.height*(1-this.originY)}}),tm.app.Object2D.prototype.accessor("left",{get:function(){return this.x-this.width*this.originX},set:function(a){this.x=a+this.width*this.originX}}),tm.app.Object2D.prototype.accessor("centerX",{get:function(){return this.x+this.width/2-this.width*this.originX},set:function(){}}),tm.app.Object2D.prototype.accessor("centerY",{get:function(){return this.y+this.height/2-this.height*this.originY},set:function(){}}),tm.app.Object2D.prototype.accessor("boundingType",{get:function(){return this._boundingType},set:function(a){this._boundingType=a,this._setIsHitFunc()}}),tm.app.Object2D.prototype.accessor("checkHierarchy",{get:function(){return this._checkHierarchy},set:function(a){this._checkHierarchy=a,this._setIsHitFunc()}});var a={rect:tm.app.Object2D.prototype.isHitPointRect,circle:tm.app.Object2D.prototype.isHitPointCircle,"true":function(){return!0},"false":function(){return!1}},b={rect:tm.app.Object2D.prototype.isHitPointRectHierarchy,circle:tm.app.Object2D.prototype.isHitPointCircleHierarchy,"true":function(){return!0},"false":function(){return!1}},c={rect:tm.app.Object2D.prototype.isHitElementRect,circle:tm.app.Object2D.prototype.isHitElementCircle,"true":function(){return!0},"false":function(){return!1}};tm.app.Object2D.prototype._setIsHitFunc=function(){{var d=this.checkHierarchy?b:a,e=this.boundingType;d[e]?d[e]:d["true"]}this.isHitPoint=d[e]?d[e]:d["true"],this.isHitElement=c[e]?c[e]:c["true"]},tm.app.Object2D.prototype._checkPointing=tm.isMobile?tm.app.Object2D.prototype._checkTouch:tm.app.Object2D.prototype._checkMouse}(),function(){tm.define("tm.app.Grid",{superClass:"tm.app.Object2D",cellWidth:64,cellHeight:64,maxPerLine:8,arrangement:"horizontal",init:function(){this.superInit()},reposition:function(){var a=this.children;"horizontal"==this.arrangement?a.each(function(a,b){var c=b%this.maxPerLine,d=b/this.maxPerLine|0,e=this.cellWidth*c,f=this.cellHeight*d;a.setPosition(e,f)},this):a.each(function(a,b){var c=b/this.maxPerLine|0,d=b%this.maxPerLine,e=this.cellWidth*c,f=this.cellHeight*d;a.setPosition(e,f)},this)}})}(),tm.app=tm.app||{},function(){tm.app.Scene=tm.createClass({superClass:tm.app.Object2D,app:null,nextLabel:"",nextArguments:null,init:function(){this.superInit(),this.boundingType="none",this.setInteractive(!0)},exit:function(a){if(this.app){if("object"!=typeof a){var b={};b.nextLabel=arguments[0],b.nextArguments=arguments[1],a=b}return a.nextLabel&&(this.nextLabel=a.nextLabel),a.nextArguments&&(this.nextArguments=a.nextArguments),this.app.popScene(),this}}})}(),tm.app=tm.app||{},function(){tm.app.Collision=tm.createClass({element:null,collideList:null,init:function(a){this.element=a,this.collideList=[]},update:function(){for(var a=this.collideList.clone(),b=this.element,c=0,d=a.length;d>c;++c){var e=a[c];if(b.isHitElement(e.element)){if(e.collide===!1){var f=tm.event.Event("collisionenter");f.other=e.element,b.dispatchEvent(f)}var f=tm.event.Event("collisionstay");f.other=e.element,b.dispatchEvent(f),e.collide=!0}else{if(1==e.collide){var f=tm.event.Event("collisionexit");f.other=e.element,b.dispatchEvent(f)}e.collide=!1}}},add:function(a){this.collideList.push({element:a,collide:!1})},remove:function(a){this.collideList.eraseIf(function(b){return b.element==a})}}),tm.app.Element.prototype.getter("collision",function(){return this._collision||(this._collision=tm.app.Collision(this),this.addEventListener("enterframe",function(a){this._collision.update(a.app)})),this._collision})}(),function(){tm.define("tm.app.Tweener",{superClass:"tm.app.Element",init:function(a){this.superInit(),this.setTarget(a||{}),this.loop=!1,this._init()},_init:function(){this._index=0,this._tasks=[],this._func=this._updateTask,this.isPlaying=!0},setTarget:function(a){return this.element=a,this},update:function(a){return void this._func(a)},_updateTask:function(a){if(this.isPlaying){var b=this._tasks[this._index];if(!b)return void(this.loop===!0?this._index=0:this.isPlaying=!1);if(this._index++,"tween"==b.type){var c=(b.data,b.data.type),d=b.data.args;this._tween=tm.anim.Tween(),this._tween[c].apply(this._tween,d),this._func=this._updateTween,this._func(a)}else"wait"==b.type?(this._wait=b.data,this._wait.time=0,this._func=this._updateWait,this._func(a)):"call"==b.type?(b.data.func.apply(b.data.self,b.data.args),this._updateTask(a)):"set"==b.type&&(this.element.$extend(b.data.values),
this._updateTask(a))}},_updateTween:function(a){var b=this._tween,c=b.time+1e3/a.fps;b._setTime(c),b.time>=b.duration?(delete this._tween,this._tween=null,this._func=this._updateTask):b.update()},_updateWait:function(a){var b=this._wait;b.time+=1e3/a.fps,b.time>=b.limit&&(delete this._wait,this._wait=null,this._func=this._updateTask)},add:function(a){if(a.target||(a.target=this.element),this._tasks.push({type:"tween",data:a}),0==this.isAnimation){this.isAnimation=!0;var b=tm.event.Event("animationstart");this.element.dispatchEvent(b)}return this},by:function(a,b,c){return this._addTweenTask({props:a,duration:b,fn:c,type:"by"}),this},to:function(a,b,c){return this._addTweenTask({props:a,duration:b,fn:c,type:"to"}),this},from:function(a,b,c){return this._addTweenTask({props:a,duration:b,fn:c,type:"from"}),this},move:function(a,b,c,d){return this.to({x:a,y:b},c,d)},moveBy:function(a,b,c,d){return this.by({x:a,y:b},c,d)},rotate:function(a,b,c){return this.to({rotation:a},b,c)},scale:function(a,b,c){return this.to({scaleX:a,scaleY:a},b,c)},fade:function(a,b){return this.to({alpha:a},b),this},fadeIn:function(a){return this.fade(1,a),this},fadeOut:function(a){return this.fade(0,a),this},_addTweenTask:function(a){if(a.target=void 0!==a.target?a.target:this.element,a.duration=void 0!==a.duration?a.duration:1e3,this._tasks.push({type:"tween",data:{args:[a.target,a.props,a.duration,a.fn],type:a.type}}),0==this.isAnimation){this.isAnimation=!0;var b=tm.event.Event("animationstart");this.element.dispatchEvent(b)}return this},wait:function(a){return this._tasks.push({type:"wait",data:{limit:a}}),this},call:function(a,b,c){return this._tasks.push({type:"call",data:{func:a,self:b||this,args:c}}),this},set:function(a,b){var c=null;return 2==arguments.length?(c={},c[a]=b):c=a,this._tasks.push({type:"set",data:{values:c}}),this},play:function(){return this.isPlaying=!0,this},pause:function(){return this.isPlaying=!1,this},rewind:function(){return this._func=this._updateTask,this._index=0,this.play(),this},setLoop:function(a){return this.loop=a,this},clear:function(){return this._init(),this}}),tm.app.Element.prototype.getter("tweener",function(){return this._tweener||(this._tweener=tm.app.Tweener(this),this.on("enterframe",function(a){this._tweener.update(a.app)})),this._tweener})}(),tm.namespace("tm.app",function(){tm.define("tm.app.Timeline",{superClass:"tm.app.Element",init:function(a){this.superInit(),this.setTarget(a||{}),this.currentFrame=0,this.currentTime=0,this.prevTime=0,this.duration=0,this.isPlay=!0,this._tweens=[],this._actions=[]},update:function(a){this.isPlay&&(this.prevTime<=this.duration&&(this._updateTween(),this._updateAction()),this.currentFrame++,this.prevTime=this.currentTime,this.currentTime=this.currentFrame/a.fps*1e3|0)},_updateTween:function(){for(var a=this._tweens,b=0,c=a.length;c>b;++b){var d=a[b];if(!(d.delay>this.currentTime)){var e=this.currentTime-d.delay;d._setTime(e),d.time>=d.duration||d.update()}}},_updateAction:function(){for(var a=this._actions,b=0,c=a.length;c>b;++b){var d=a[b];if(this.prevTime<=d.delay&&d.delay<this.currentTime)if("call"==d.type)d.func.call(d.self);else if("set"==d.type){var e=d.props;for(var f in e)this.element[f]=e[f]}}},to:function(a,b,c,d){return console.assert("number"==typeof a,"to の第一引数はdelayに変わりました"),this._addTween({props:b,duration:c,fn:d,delay:a}),this},by:function(a,b,c,d){console.assert("number"==typeof a,"by の第一引数はdelayに変わりました");for(var e in b)b[e]+=this.element[e]||0;return this._addTween({props:b,duration:c,fn:d,delay:a}),this},call:function(a,b,c){return console.assert("number"==typeof a,"call の第一引数はdelayに変わりました"),this._addAction({type:"call",func:b,self:c||this,delay:a}),this},set:function(a,b){return console.assert("number"==typeof a,"set の第一引数はdelayに変わりました"),this._addAction({type:"set",props:b,delay:a}),this},setTarget:function(a){return this.element=a,this},getTarget:function(){return this.element},gotoAndPlay:function(a){this.isPlay=!0,this.currentFrame=a,this._updateTween()},gotoAndStop:function(a){this.currentFrame=a,this.isPlay=!1,this._updateTween()},_addTween:function(a){a.duration=a.duration||1e3,a.duration=this._dirty(a.duration),a.delay=a.delay||0,a.delay=this._dirty(a.delay);var b=tm.anim.Tween();b.to(this.element,a.props,a.duration,a.fn),b.delay=a.delay,this._tweens.push(b),this._updateDuration(b)},_addAction:function(a){a.delay=a.delay||0,a.delay=this._dirty(a.delay),this._actions.push(a),this._updateDuration(a)},_updateDuration:function(a){var b=a.delay+(a.duration?a.duration:0);return this.duration<b&&(this.duration=b),this},_dirty:function(a){return a},load:function(a){for(var b in a.timeline)var c=a.timeline[b];return this},clear:function(){return this.currentFrame=0,this.prevTime=0,this.currentTime=0,this.duration=0,this.isPlay=!0,this._tweens=[],this._actions=[],this}}),tm.app.Element.prototype.getter("timeline",function(){return this._timeline||(this._timeline=tm.app.Timeline(this),this.on("enterframe",function(a){this._timeline.update(a.app)})),this._timeline})}),tm.display=tm.display||{},function(){tm.display.CanvasApp=tm.createClass({superClass:tm.app.BaseApp,init:function(a){this.element=a instanceof HTMLCanvasElement?a:"string"==typeof a?document.querySelector(a):document.createElement("canvas"),this.superInit(this.element),this.canvas=tm.graphics.Canvas(this.element),this.renderer=tm.display.CanvasRenderer(this.canvas),this.background="black",this._scenes=[tm.app.Scene()],this._canvasCache=[],this._canvasCacheCache=[],this.on("push",function(){this._draw();var a=this._canvasCacheCache.pop();if(!a){var b=this.canvas.element.cloneNode();a=tm.graphics.Canvas(b)}a.clear(),a.drawTexture(this.canvas,0,0),this._canvasCache.push(a)}),this.on("poped",function(){var a=this._canvasCache.pop();this._draw(),this._canvasCacheCache.push(a)})},resize:function(a,b){return this.width=a,this.height=b,this},resizeWindow:function(){return this.width=innerWidth,this.height=innerHeight,this},fitWindow:function(a){return this.canvas.fitWindow(a),this.mouse._mousemove=this.mouse._mousemoveScale,this.touch._touchmove=this.touch._touchmoveScale,this},_draw:function(){this.canvas.clear(),this.canvas.fillStyle="white",this.canvas.strokeStyle="white",this.canvas.context.lineJoin="round",this.canvas.context.lineCap="round",this._canvasCache.last&&this.canvas.drawTexture(this._canvasCache.last,0,0),this.canvas.save(),this.renderer.render(this.currentScene),this.canvas.restore()}}),tm.display.CanvasApp.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(a){this.canvas.width=a}}),tm.display.CanvasApp.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(a){this.canvas.height=a}}),tm.display.CanvasApp.prototype.accessor("background",{get:function(){return this.canvas._background},set:function(a){this._background=a,this.element.style.background=a}})}(),tm.display=tm.display||{},function(){tm.display.CanvasElement=tm.createClass({superClass:tm.app.Object2D,visible:!0,clipping:!1,fillStyle:"white",strokeStyle:"white",alpha:1,blendMode:"source-over",shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,init:function(){this.superInit()},setAlpha:function(a){return this.alpha=a,this},setShadowColor:function(a){return this.shadowColor=a,this},setShadowBlur:function(a){return this.shadowBlur=a,this},setShadowOffset:function(a,b){return this.shadowOffsetX=a,this.shadowOffsetY=b,this},drawBoundingCircle:function(a){a.save(),a.lineWidth=2,a.strokeCircle(0,0,this.radius),a.restore()},drawBoundingRect:function(a){a.save(),a.lineWidth=2,a.strokeRect(-this.width*this.originX,-this.height*this.originY,this.width,this.height),a.restore()},drawFillRect:function(a){return a.fillRect(-this.width/2,-this.height/2,this.width,this.height),this},drawStrokeRect:function(a){return a.strokeRect(-this.width/2,-this.height/2,this.width,this.height),this},drawFillArc:function(a){return a.beginPath(),a.arc(0,0,this.radius,0,2*Math.PI,!1),a.fill(),a.closePath(),this},drawStrokeArc:function(a){return a.beginPath(),a.arc(0,0,this.radius,0,2*Math.PI,!1),a.stroke(),a.closePath(),this},setVisible:function(a){return this.visible=a,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},setFillStyle:function(a){return this.fillStyle=a,this},setStrokeStyle:function(a){return this.strokeStyle=a,this},setBlendMode:function(a){return this.blendMode=a,this},load:function(a){var b=this;a.layers.forEach(function(a){if("objectgroup"==a.type){var c=tm.display.CanvasElement().addChildTo(b);c.width=a.width,c.height=a.height,a.objects.forEach(function(a){var b=tm.using(a.type);0===Object.keys(b).length&&(b=tm.display[a.type]);var d=null;a.properties.init&&(d=JSON.parse(a.properties.init));var e=b.apply(null,d).addChildTo(c),f=a.properties;for(var g in f)if("init"!=g){var h=f[g];e[g]=h}e.x=a.x,e.y=a.y,e.width=a.width,e.height=a.height}),b[a.name]=c}})},_calcAlpha:function(){return this.parent?void(this._worldAlpha=this.parent._worldAlpha*this.alpha):void(this._worldAlpha=this.alpha)},_dirtyCalc:function(){this._calcAlpha(),this._calcWorldMatrix()}})}(),tm.display=tm.display||{},function(){tm.display.Sprite=tm.createClass({superClass:tm.display.CanvasElement,init:function(a,b,c){this.superInit(),console.assert("number"!=typeof a,"Sprite の第一引数はテクスチャもしくはテクスチャ名に変わりました"),this._frameIndex=0,this.srcRect=tm.geom.Rect(0,0,64,64),arguments.length>=1&&(this.setImage(a).fitImage(),void 0!==b&&(this.width=b),void 0!==c&&(this.height=c))},setImage:function(a,b,c){if("string"==typeof a){var d=a;a=tm.asset.Manager.get(d),console.assert(null!=a,"don't find '"+d+"' as image.")}return this._image=a,this.srcRect.x=0,this.srcRect.y=0,this.srcRect.width=a.element.width,this.srcRect.height=a.element.height,void 0!==b&&(this.width=b),void 0!==c&&(this.height=c),this},getImage:function(){return this._image},fitImage:function(){return this.width=this.image.width,this.height=this.image.height,this},setFrameIndex:function(a,b,c){var d=b||this.width,e=c||this.height,f=~~(this.image.width/d),g=~~(this.image.height/e),h=f*g;a%=h;var i=a%f,j=~~(a/f);return this.srcRect.x=i*d,this.srcRect.y=j*e,this.srcRect.width=d,this.srcRect.height=e,this._frameIndex=a,this},_refreshSize:function(){}}),tm.display.Sprite.prototype.accessor("image",{get:function(){return this._image},set:function(a){this.setImage(a)}}),tm.display.Sprite.prototype.accessor("frameIndex",{get:function(){return this._frameIndex},set:function(a){this.setFrameIndex(a)}})}(),tm.display=tm.display||{},function(){tm.display.Shape=tm.createClass({superClass:tm.display.CanvasElement,init:function(a){a=this._dirtyCheckParam.apply(this,arguments);var a={}.$safe(a,{width:64,height:64,bgColor:"transparent",fillStyle:"red",strokeStyle:"white",lineWidth:"2",shadowBlur:0,shadowColor:"red"});this.superInit(),this.canvas=tm.graphics.Canvas(),this.$extend(a),this.render(),this.autoRender=!0},_prerender:function(){var a=this.canvas;return a.resize(this.width,this.height),a.clearColor(this.bgColor),a.save(),a.fillStyle=this.fillStyle,a.strokeStyle=this.strokeStyle,a.lineWidth=this.lineWidth,a.shadowBlur=this.shadowBlur,a.shadowColor=this.shadowColor,this},_postrender:function(){var a=this.canvas;return a.restore(),this},render:function(){this._prerender(),this._render(),this._postrender()},_render:function(){},renderText:function(a){var b=this.canvas;a={}.$extend(tm.display.Shape.DEFAULT_SHAPE_PARAM_TEXT,a),b.save(),b.fillStyle=a.fillStyle,b.strokeStyle=a.strokeStyle,b.lineWidth=a.lineWidth,b.font=a.font,b.textAlign=a.textAlign,b.textBaseline=a.textBaseline,b.strokeText(a.text,this.width/2,this.height/2),b.fillText(a.text,this.width/2,this.height/2),b.restore()},_dirtyCheckParam:function(a){var a=a;if(arguments.length>=2){var b=arguments[0],c=arguments[1],a=arguments[2]||{};a.width=b,a.height=c,console.warn("tmlib.js warn: arguments of shape init is only param from version 0.4")}return a}}),["width","height","bgColor","strokeStyle","fillStyle","lineWidth","shadowBlur","shadowColor"].each(function(a){var b="_"+a;tm.display.Shape.prototype.accessor(a,{get:function(){return this[b]},set:function(a){this[b]=a,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.CircleShape",{superClass:tm.display.Shape,init:function(a){a=this._dirtyCheckParam.apply(this,arguments),this.superInit(a),this.render()},_render:function(){var a=this.canvas,b=Math.min(this.width,this.height)/2;a.fillCircle(this.width/2,this.height/2,b),a.strokeCircle(this.width/2,this.height/2,b-Number(a.lineWidth)/2)}})}(),function(){tm.define("tm.display.TriangleShape",{superClass:tm.display.Shape,init:function(a){a=this._dirtyCheckParam.apply(this,arguments),a={}.$safe(a,{fillStyle:"green"}),this.superInit(a),this.render()},_render:function(){var a=this.canvas,b=this.width/2,c=this.height/2,d=Math.min(this.width,this.height)/2,e=1*Number(a.lineWidth);a.fillPolygon(b,c,d,3),a.strokePolygon(b,c,d-e,3)}})}(),function(){tm.define("tm.display.RectangleShape",{superClass:tm.display.Shape,init:function(a){a=this._dirtyCheckParam.apply(this,arguments),a={}.$safe(a,{fillStyle:"blue"}),this.superInit(a),this.render()},_render:function(){var a=this.canvas,b=this.lineWidth,c=b/2;a.fillRect(0,0,this.width,this.height),a.strokeRect(c,c,this.width-b,this.height-b)}})}(),function(){tm.define("tm.display.RoundRectangleShape",{superClass:tm.display.Shape,init:function(a){a=this._dirtyCheckParam.apply(this,arguments),a={}.$safe(a,{fillStyle:"blue",cornerRadius:8}),this.superInit(a),this.render()},_render:function(){var a=this.canvas,b=this.lineWidth,c=b/2;a.fillRoundRect(c,c,this.width-b,this.height-b,this.cornerRadius),a.strokeRoundRect(c,c,this.width-b,this.height-b,this.cornerRadius)}}),["cornerRadius"].each(function(a){var b="_"+a;tm.display.RoundRectangleShape.prototype.accessor(a,{get:function(){return this[b]},set:function(a){this[b]=a,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.StarShape",{superClass:tm.display.Shape,init:function(a){a=this._dirtyCheckParam.apply(this,arguments),a={}.$safe(a,{fillStyle:"yellow",sides:5,sideIndent:.38,offsetAngle:-90}),this.superInit(a),this.render()},_render:function(){var a=this.canvas,b=this.sides,c=this.sideIndent,d=this.offsetAngle,e=this.width/2,f=this.height/2,g=Math.min(this.width,this.height)/2,h=1.5*Number(a.lineWidth);a.fillStar(e,f,g,b,c,d),a.strokeStar(e,f,g-h,b,c,d)}}),["sides","sideIndent","offsetAngle"].each(function(a){var b="_"+a;tm.display.StarShape.prototype.accessor(a,{get:function(){return this[b]},set:function(a){this[b]=a,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.PolygonShape",{superClass:tm.display.Shape,init:function(a){a=this._dirtyCheckParam.apply(this,arguments),a={}.$safe(a,{fillStyle:"cyan",sides:5,sideIndent:.38,offsetAngle:-90}),this.superInit(a),this.render()},_render:function(){var a=this.canvas,b=this.sides,c=this.offsetAngle,d=this.width/2,e=this.height/2,f=Math.min(this.width,this.height)/2,g=.6*Number(a.lineWidth);a.fillPolygon(d,e,f,b,c),a.strokePolygon(d,e,f-g,b,c)}}),["sides","offsetAngle"].each(function(a){var b="_"+a;tm.display.PolygonShape.prototype.accessor(a,{get:function(){return this[b]},set:function(a){this[b]=a,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.HeartShape",{superClass:tm.display.Shape,init:function(a){a=this._dirtyCheckParam.apply(this,arguments),a={}.$safe(a,{fillStyle:"pink",cornerAngle:45}),this.superInit(a),this.render()},_render:function(){var a=this.canvas,b=this.width/2,c=this.height/2,d=Math.min(this.width,this.height)/2;a.fillHeart(b,c,d,this.cornerAngle),a.strokeHeart(b,c,d-Number(a.lineWidth)/2,this.cornerAngle)}}),["cornerAngle"].each(function(a){var b="_"+a;tm.display.HeartShape.prototype.accessor(a,{get:function(){return this[b]},set:function(a){this[b]=a,this.autoRender===!0&&this.render()}})})}(),function(){var a=null;tm.define("tm.display.TextShape",{superClass:"tm.display.Shape",init:function(a,b,c){c=this._dirtyCheckParam.apply(this,arguments),c={}.$safe(c,{fillStyle:"black",lineWidth:4,text:"hello, world!",fontSize:64,fontWeight:"",fontFamily:"'HiraKakuProN-W3'"}),this.superInit(c),this.fit(),this.render()},fit:function(){a||(a=tm.graphics.Canvas()),a.font="{fontWeight} {fontSize}px {fontFamily}".format(this);var b=a.context.measureText(this.text).width+10,c=1.5*a.context.measureText("あ").width;this.width=b,this.height=c},_render:function(){var a=this.canvas;a.fillStyle=this.fillStyle,a.strokeStyle=this.strokeStyle,a.font="{fontWeight} {fontSize}px {fontFamily}".format(this),a.textAlign="center",a.textBaseline="middle";var b=(a.context.measureText(this.text).width,this.width/2),c=this.height/2;a.strokeText(this.text,b,c),a.fillText(this.text,b,c)}}),["text","fontWeight","fontSize","fontFamily"].each(function(a){var b="_"+a;tm.display.TextShape.prototype.accessor(a,{get:function(){return this[b]},set:function(a){this[b]=a,this.autoRender===!0&&this.render()}})})}(),tm.display=tm.display||{},function(){var a=null,b=null;tm.display.Label=tm.createClass({superClass:tm.display.CanvasElement,fill:!0,stroke:!1,debugBox:!1,init:function(a,b){this.superInit(),this.text=a||"",this._fontSize=b||24,this._fontFamily=tm.display.Label["default"].fontFamily,this._fontWeight="",this._lineHeight=1.2,this._updateFont(),this.align=tm.display.Label["default"].align,this.baseline=tm.display.Label["default"].baseline,this.maxWidth=null},setAlign:function(a){return this.align=a,this},setBaseline:function(a){return this.baseline=a,this},setFontSize:function(a){return this.fontSize=a,this},setFontFamily:function(a){return this.fontFamily=a,this},setFontWeight:function(a){return this.fontWeight=a,this},_updateFont:function(){this.fontStyle="{fontWeight} {fontSize}px {fontFamily}".format(this),a||(a=document.createElement("canvas"),b=a.getContext("2d")),b.font=this.fontStyle,this.textSize=b.measureText("あ").width*this.lineHeight},_updateLines:function(){this._lines=(this._text+"").split("\n")}}),tm.display.Label.prototype.accessor("text",{get:function(){return this._text},set:function(a){this._text=null==a||void 0==a?"":a,this._updateLines()}}),tm.display.Label.prototype.accessor("fontSize",{get:function(){return this._fontSize},set:function(a){this._fontSize=a,this._updateFont()}}),tm.display.Label.prototype.accessor("fontFamily",{get:function(){return this._fontFamily},set:function(a){this._fontFamily=a,this._updateFont()}}),tm.display.Label.prototype.accessor("fontWeight",{get:function(){return this._fontWeight},set:function(a){this._fontWeight=a,this._updateFont()}}),tm.display.Label.prototype.accessor("lineHeight",{get:function(){return this._lineHeight},set:function(a){this._lineHeight=a,this._updateFont()}}),tm.display.Label["default"]={align:"center",baseline:"middle",fontFamily:"'HiraKakuProN-W3'"}}(),tm.display=tm.display||{},function(){tm.display.AnimationSprite=tm.createClass({superClass:tm.display.CanvasElement,init:function(a,b,c){if(this.superInit(),"string"==typeof a){var a=tm.asset.Manager.get(a);console.assert(a,"not found "+a)}console.assert("object"==typeof a,"AnimationSprite の第一引数はスプライトシートもしくはスプライトシート名に変わりました"),this.ss=a,this.width=b||a.frame.width,this.height=c||a.frame.height,this.currentFrame=0,this.currentFrameIndex=0,this.paused=!0,this.currentAnimation=null,this.addEventListener("enterframe",function(a){this.paused||a.app.frame%this.currentAnimation.frequency!==0||this._updateFrame()})},draw:function(a){var b=this.ss.getFrame(this.currentFrame),c=this.ss.image.element;a.drawImage(c,b.x,b.y,b.width,b.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)},gotoAndPlay:function(a){return a=void 0!==a?a:"default",this.paused=!1,this.currentAnimation=this.ss.animations[a],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},gotoAndStop:function(a){return a=void 0!==a?a:"default",this.paused=!0,this.currentAnimation=this.ss.animations[a],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},_updateFrame:function(){this.currentFrameIndex+=1,this._normalizeFrame()},_normalizeFrame:function(){var a=this.currentAnimation;if(a)if(this.currentFrameIndex<a.frames.length)this.currentFrame=a.frames[this.currentFrameIndex];else{a.next?this.gotoAndPlay(a.next):(this.currentFrameIndex=a.frames.length-1,this.currentFrame=a.frames[this.currentFrameIndex],this.paused=!0);var b=tm.event.Event("animationend");this.dispatchEvent(b)}}})}(),function(){tm.define("tm.display.MapSprite",{superClass:"tm.display.CanvasElement",init:function(a,b,c){this.superInit(),this.mapSheet="string"==typeof a?tm.asset.Manager.get(a):a,this.chipWidth=b||32,this.chipHeight=c||32,this.originX=this.originY=0,this.width=b*this.mapSheet.width,this.height=b*this.mapSheet.height,this.tileset=[],this.tilesetInfo={},this._build()},_build:function(){var a=this;this.mapSheet.tilesets.each(function(b,c){a._buildTileset(b,c)}),this.mapSheet.layers.each(function(b){"objectgroup"==b.type?a._buildObject(b):"imagelayer"==b.type?a._buildImageLayer(b):a._buildLayer(b)})},_buildTileset:function(a,b){var c=this,d=this.mapSheet,e=tm.asset.Manager.get(a.image),f=e.width/d.tilewidth|0,g=e.height/d.tileheight|0,h={begin:c.tileset.length,end:c.tileset.length+f*g};c.tilesetInfo[b]=h,void 0!==a.name&&(c.tilesetInfo[a.name]=h),g.times(function(b){f.times(function(e){var f=tm.geom.Rect(e*d.tilewidth,b*d.tileheight,d.tilewidth,d.tileheight);c.tileset.push({image:a.image,rect:f})})})},_buildLayer:function(a){var b=this,c=this.mapSheet,d=tm.display.Shape({width:this.width,height:this.height}).addChildTo(this),e=1===a.visible||void 0===a.visible,f=void 0===a.opacity?1:a.opacity,g=[];if(d.origin.set(0,0),void 0!==a.tilesets){var h=null;h=Array.isArray(a.tilesets)?a.tilesets:[a.tilesets],h.each(function(a){var c=b.tilesetInfo[a];g=g.concat(b.tileset.slice(c.begin,c.end))})}else g=b.tileset;e&&a.data.each(function(a,e){var h=a;if(-1!=h&&(h=Math.abs(h),void 0!==g[h])){var i=e%c.width,j=e/c.width|0,k=i*b.chipWidth,l=j*b.chipHeight,m=g[h],n=tm.asset.Manager.get(m.image),o=m.rect;d.canvas.globalAlpha=f,d.canvas.drawTexture(n,o.x,o.y,o.width,o.height,k,l,b.chipWidth,b.chipHeight)}}.bind(this))},_buildObject:function(a){var b=this,c=tm.display.CanvasElement().addChildTo(b);c.width=b.width,c.height=b.height,a.objects.forEach(function(a){var b=tm.using(a.type);0===Object.keys(b).length&&(b=tm.display[a.type]);var d=null;a.properties.init&&(d=JSON.parse(a.properties.init));var e=b.apply(null,d).addChildTo(c),f=a.properties;for(var g in f)if("init"!=g){var h=f[g];e[g]=h}e.x=a.x,e.y=a.y,e.width=a.width,e.height=a.height,c[a.name]=e}),b[a.name]=c},_buildImageLayer:function(a){var b=tm.display.Sprite(a.image.source).setOrigin(0,0).addChildTo(this);b.x=a.x,b.y=a.y,b.alpha=a.alpha,b.visible=a.visible,this[a.name]=b}})}(),function(){tm.define("tm.display.CanvasRenderer",{canvas:null,init:function(a){this.canvas=a,this._context=this.canvas.context},render:function(a){this.canvas.save(),this.renderObject(a),this.canvas.restore()},renderObject:function(a){if(a.visible!==!1){var c=this._context;if(a._dirtyCalc&&a._dirtyCalc(),this._checkRenderable(a)){a.draw||this._setRenderFunction(a),a.fillStyle&&(c.fillStyle=a.fillStyle),a.strokeStyle&&(c.strokeStyle=a.strokeStyle),c.globalAlpha=a._worldAlpha,c.globalCompositeOperation=a.blendMode,a.shadowBlur?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur):(c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowColor="rgba(0, 0, 0, 0)");var d=a._worldMatrix.m;if(c.setTransform(d[0],d[3],d[1],d[4],d[2],d[5]),a.clipping){if(c.save(),a.clip?a.clip():b.call(a,this.canvas),c.clip(),a.draw(this.canvas),a.children.length>0)for(var e=a.children.slice(),f=0,g=e.length;g>f;++f)this.renderObject(e[f]);c.restore()}else if(a.draw(this.canvas),a.children.length>0)for(var e=a.children.slice(),f=0,g=e.length;g>f;++f)this.renderObject(e[f])}else if(a.children.length>0)for(var e=a.children.slice(),f=0,g=e.length;g>f;++f)this.renderObject(e[f])}},_checkRenderable:function(a){return void 0===a._renderable&&(a._renderable=a instanceof tm.display.CanvasElement),a._renderable},_setRenderFunction:function(b){b.draw=b instanceof tm.display.Sprite?a.sprite:b instanceof tm.display.MapSprite?function(){}:b instanceof tm.display.Label?a.label:b instanceof tm.display.Shape?a.shape:function(){}}});var a={sprite:function(a){var b=this.srcRect,c=this._image.element;a.context.drawImage(c,b.x,b.y,b.width,b.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},shape:function(a){this.srcRect;a.drawImage(this.canvas.canvas,0,0,this.canvas.width,this.canvas.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},label:function(a){a.setText(this.fontStyle,this.align,this.baseline),this.lineWidth&&(a.lineWidth=this.lineWidth),this.stroke&&this._lines.each(this.maxWidth?function(b,c){a.strokeText(b,0,this.textSize*c,this.maxWidth)}.bind(this):function(b,c){a.strokeText(b,0,this.textSize*c)}.bind(this)),this.fill&&this._lines.each(this.maxWidth?function(b,c){a.fillText(b,0,this.textSize*c,this.maxWidth)}.bind(this):function(b,c){a.fillText(b,0,this.textSize*c)}.bind(this)),this.debugBox&&a.strokeRect(0,0,this.width,-this.size)}},b=function(a){a.beginPath(),a.rect(-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)}}(),function(){tm.define("tm.display.BoundingRectRenderer",{superClass:"tm.display.CanvasRenderer",init:function(a){this.superInit(a)},_setRenderFunction:function(b){b.draw=a}});var a=function(a){a.save(),a.lineWidth=2,a.strokeRect(-this.width*this.originX,-this.height*this.originY,this.width,this.height),a.restore()}}(),tm.ui=tm.ui||{},function(){tm.ui.Pad=tm.createClass({superClass:tm.display.Shape,isTouching:!1,circle:null,init:function(){this.superInit(120,120);var a=this.canvas;a.fillStyle="#fff",a.fillCircle(60,60,60),a.fillStyle="#eee",this._createCircle(),this.setInteractive(!0),this.alpha=.75},_createCircle:function(){var a=this.circle=tm.display.Shape(80,80);this.addChild(a);var b=a.canvas;b.fillStyle="#222",b.setShadow("black",2,2,2),b.fillCircle(40,40,35)},onpointingstart:function(){this.isTouching=!0},onpointingend:function(){this.isTouching=!1,this.circle.position.set(0,0)},onpointingmove:function(a){if(0!=this.isTouching){var b=a.pointing,c=tm.geom.Vector2(b.x-this.x,b.y-this.y),d=c.length();c.div(d),d>40&&(d=40),this.angle=Math.radToDeg(c.toAngle()),this.circle.position.set(c.x*d,c.y*d),this.distance=d/40,this.direction=c.mul(this.distance)}}})}(),tm.ui=tm.ui||{},function(){tm.define("tm.ui.BaseButton",{superClass:"tm.display.CanvasElement",init:function(a){this.superInit(),a=a||{},this.width=a.width||64,this.height=a.height||64,this.setInteractive(!0),this.boundingType="rect",this.on("pointingend",function(){this.flare("push")})}})}(),function(){tm.define("tm.ui.SpriteButton",{superClass:"tm.ui.BaseButton",init:function(a){this.superInit(),this.sprite=tm.display.Sprite(a).addChildTo(this),this.width=this.sprite.width,this.height=this.sprite.height}})}(),function(){tm.ui.LabelButton=tm.createClass({superClass:tm.display.Label,init:function(a){this.superInit(a),this.alpha=tm.ui.LabelButton.DEFAULT_ALPHA,this.setAlign("center").setBaseline("middle"),this.setInteractive(!0),this.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fadeIn(250)}.bind(this)),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.ui.LabelButton.DEFAULT_ALPHA,250)}.bind(this))}}),tm.ui.LabelButton.DEFAULT_ALPHA=.5}(),function(){tm.ui.IconButton=tm.createClass({superClass:tm.display.Sprite,init:function(){this.superInit.call(this,arguments),this.setInteractive(!0),this.boundingType="rect",this.on("pointingend",function(){this.flare("push")})}}),tm.ui.IconButton.DEFAULT_ALPHA=.5}(),function(){tm.ui.GlossyButton=tm.createClass({superClass:tm.display.Shape,init:function(a,b,c,d){this.superInit(a,b),d=d||"Button",this.backgroundColor=c||"black",this.alpha=tm.ui.GlossyButton.DEFAULT_ALPHA,this.setInteractive(!0),this.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fade(1,250)}),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.ui.GlossyButton.DEFAULT_ALPHA,250)}),this.label=tm.display.Label(d||"").addChildTo(this),this.label.setAlign("center").setBaseline("middle"),this._refresh()},setBackgroundColor:function(a){return this.backgroundColor=a,this._refresh(),this},_refresh:function(){var a=this.canvas;a.resize(this.width,this.height),a.fillStyle=this.backgroundColor,a.fillRoundRect(2,2,this.width-4,this.height-4,10),a.strokeStyle="rgba(100,100,100,0.75)",a.lineWidth=2,a.strokeRoundRect(2,2,this.width-4,this.height-4,10),a.roundRect(2,2,this.width-4,this.height-4,10),a.clip();var b=tm.graphics.LinearGradient(0,0,0,this.height);b.addColorStop(0,"rgba(255,255,255,0.9)"),b.addColorStop(.5,"rgba(255,255,255,0.5)"),b.addColorStop(.51,"rgba(255,255,255,0.2)"),b.addColorStop(1,"rgba(255,255,255,0.0)"),a.setGradient(b),a.fillRect(2,2,this.width-4,this.height-4,10),this.label.setSize(this.width,this.height)}}),tm.ui.GlossyButton.DEFAULT_ALPHA=.5}(),function(){tm.define("tm.ui.FlatButton",{superClass:"tm.ui.BaseButton",init:function(a){a=(a||{}).$safe(tm.ui.FlatButton.defaults),this.superInit(a),this.shape=tm.display.RoundRectangleShape(a).addChildTo(this),this.label=tm.display.Label(a.text).addChildTo(this),this.label.setFontSize(a.fontSize).setFontFamily(a.fontFamily).setAlign("center").setBaseline("middle")}}),tm.ui.FlatButton.defaults={width:300,height:100,fillStyle:"hsl(180, 60%, 50%)",strokeStyle:"transparent",text:"START",fontSize:50,cornerRadius:8,fontFamily:"'ヒラギノ角ゴ Pro W3', 'Hiragino Kaku Gothic Pro', 'メイリオ', 'Meiryo', 'ＭＳ Ｐゴシック', 'MS PGothic', sans-serif"}}(),function(){tm.define("tm.ui.MenuDialog",{superClass:tm.app.Scene,titleText:null,menu:null,descriptions:null,showExit:!1,title:null,selections:[],description:null,box:null,cursor:null,_selected:0,_opened:!1,_finished:!1,_screenWidth:0,_screenHeight:0,init:function(a){this.superInit(),this._screenWidth=a.screenWidth,this._screenHeight=a.screenHeight,this.titleText=a.title,this.menu=[].concat(a.menu),this._selected=~~a.defaultSelected,this.showExit=!!a.showExit,this.descriptions=a.menuDesctiptions?a.menuDesctiptions:[].concat(a.menu),this.showExit&&(this.menu.push("exit"),this.descriptions.push("前の画面へ戻ります"));var b=Math.max(50*(1+this.menu.length),50)+40;this.box=tm.display.RectangleShape(.8*this._screenWidth,b,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(43,156,255, 0.8)"}).setPosition(.5*this._screenWidth,.5*this._screenHeight),this.box.width=1,this.box.height=1,this.box.setBoundingType("rect"),this.box.tweener.to({width:.8*this._screenWidth,height:b},200,"easeOutExpo").call(this._onOpen.bind(this)),this.box.addChildTo(this),this.description=tm.display.Label("",14).setAlign("center").setBaseline("middle").setPosition(.5*this._screenWidth,this._screenHeight-10).addChildTo(this)},_onOpen:function(){var a=this,b=.5*this._screenHeight-25*this.menu.length;this.title=tm.display.Label(this.titleText,30).setAlign("center").setBaseline("middle").setPosition(.5*this._screenWidth,b).addChildTo(this),this.cursor=this._createCursor(),this.selections=this.menu.map(function(a,c){var d=this;b+=50;var e=tm.ui.LabelButton(a).setPosition(.5*this._screenWidth,b).addChildTo(this);return e.interactive=!0,e.addEventListener("click",function(){if(d._selected===c)d.closeDialog(d._selected);else{d._selected=c;var a=tm.event.Event("menuselect");a.selectValue=d.menu[d._selected],a.selectIndex=c,d.dispatchEvent(a)}}),e.width=.7*this._screenWidth,e}.bind(this)),this.cursor.y=this.selections[this._selected].y,this._opened=!0,this.addEventListener("pointingend",function(b){var c=b.app.pointing;a.box.isHitPoint(c.x,c.y)||a.closeDialog(a._selected)});var c=tm.event.Event("menuopened");this.dispatchEvent(c);

},_createCursor:function(){var a=tm.display.RectangleShape(.7*this._screenWidth,30,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(12,79,138,1)"}).addChildTo(this);return a.x=.5*this._screenWidth,a.target=this._selected,a.update=function(){this.target!==this.parent._selected&&(this.target=this.parent._selected,this.tweener.clear(),this.tweener.to({y:this.parent.selections[this.parent._selected].y},200,"easeOutExpo"))},a},update:function(){this.description.text=this.descriptions[this._selected]},closeDialog:function(a){this._finished=!0;var b=tm.event.Event("menuselected");b.selectIndex=a,this.dispatchEvent(b),this.tweener.clear().wait(200).call(function(){this.cursor.remove(),this.title.remove(),this.selections.each(function(a){a.remove()}),this.box.tweener.clear(),this.box.tweener.to({width:1,height:1},200,"easeInExpo").call(function(){this.app.popScene();var b=tm.event.Event("menuclosed");b.selectIndex=a,this.dispatchEvent(b)}.bind(this))}.bind(this)),this.cursor.tweener.clear().call(function(){this.visible=!this.visible}.bind(this.cursor)).setLoop(!0)},draw:function(a){a.fillStyle="rgba(0,0,0,0.8)",a.fillRect(0,0,this._screenWidth,this._screenHeight)}})}(),function(){var a={bgColor:"rgba(255, 255, 255, 1.0)",penColor:"rgba(0, 0, 0, 1.0)",lineWidth:16};tm.define("tm.ui.Sketch",{superClass:"tm.display.Shape",init:function(b){b=this._dirtyCheckParam.apply(this,arguments),b.$safe(a),this.superInit(b),this.autoRender=!1,this._setup(b)},_setup:function(a){var b=this;this.boundingType="rect",this.setInteractive(!0);var c=this.canvas.context;c.lineCap="round",c.lineJoin="round",c.miterLimit=10,this.bgColor=a.bgColor,this.penColor=a.penColor,this.lineWidth=a.lineWidth,this.on("pointingstart",function(a){var c=a.app.pointing;b._drawPoint(c.position)}),this.on("pointingmove",function(a){var c=a.app.pointing;b._drawLine(c.prevPosition,c.position),b.points.push({x:c.x-this.left,y:c.y-this.top})}),this.on("pointingend",function(){b.pointsList.push(b.points),b.points=[]}),this.pointsList=[],this.points=[]},clear:function(){return this.canvas.clear(),this.canvas.clearColor(this.bgColor),this.pointsList=[],this.points=[],this},_drawPoint:function(a){this.canvas.drawPoint(a.x-this.left,a.y-this.top)},_drawLine:function(a,b){this.canvas.drawLine(a.x-this.left,a.y-this.top,b.x-this.left,b.y-this.top)}}),tm.ui.Sketch.prototype.accessor("penColor",{get:function(){return this._penColor},set:function(a){this._penColor=a,this.canvas.strokeStyle=a}}),tm.ui.Sketch.prototype.accessor("bgColor",{get:function(){return this._bgColor},set:function(a){this._bgColor=a,this.clear()}}),tm.ui.Sketch.prototype.accessor("lineWidth",{get:function(){return this._lineWidth},set:function(a){this._lineWidth=a,this.canvas.lineWidth=a}})}(),function(){tm.ui.Gauge=tm.createClass({superClass:tm.display.CanvasElement,animationFlag:!0,animationTime:1e4,init:function(a){this.superInit(),a=a||{},a.$safe({width:300,height:25,color:"hsl(220, 100%, 50%)",bgColor:"#444",borderColor:"white",borderWidth:4}),this.$extend(a),this._reset()},isFull:function(){return this._value===this._maxValue},isEmpty:function(){return 0==this._value},_reset:function(){this.originX=0,this._value=100,this._value=this._maxValue=100},setValue:function(a){if(a=Math.clamp(a,0,this._maxValue),this._realValue=a,this._value!==a){if(this.fire(tm.event.Event("change")),this.isAnimation()){this.tweener.clear();var b=Math.abs(this._value-a)/100*this.animationTime;this.tweener.clear().to({_value:a},b).call(function(){this.fire(tm.event.Event("changed")),this.isEmpty()?this.fire(tm.event.Event("empty")):this.isFull()&&this.fire(tm.event.Event("full"))}.bind(this))}else this._value=a,this.fire(tm.event.Event("changed")),this.isEmpty()?this.fire(tm.event.Event("empty")):this.isFull()&&this.fire(tm.event.Event("full"));return this}},getValue:function(){return this.value},setPercent:function(a){return this.setValue(this._maxValue*a*.01)},getPercent:function(){return this._value/this._maxValue*100},setRatio:function(a){return this.setValue(this._maxValue*a)},getRatio:function(){return this._value/this._maxValue},isAnimation:function(){return this.animationFlag},draw:function(a){a.save(),a.fillStyle=this.bgColor,a.fillRect(0,0,this.width,this.height),a.fillStyle=this.color,a.fillRect(0,0,this.width*this.getRatio(),this.height),a.strokeStyle=this.borderColor,a.lineWidth=this.borderWidth,a.strokeRect(0,0,this.width,this.height),a.restore()}}),tm.ui.Gauge.prototype.accessor("value",{get:function(){return this._value},set:function(a){this.setValue(a)}}),tm.ui.Gauge.prototype.accessor("percent",{get:function(){return this.getPercent()},set:function(a){this.setPercent(a)}}),tm.ui.Gauge.prototype.accessor("ratio",{get:function(){return this.getRatio()},set:function(a){this.setRatio(a)}})}(),function(){tm.define("tm.ui.FlatGauge",{superClass:"tm.ui.Gauge",init:function(a){this.superInit(a)},draw:function(a){a.save(),a.save(),a.roundRect(0,0,this.width,this.height,this.height/2),a.clip(),a.fillStyle=this.bgColor,a.fillRect(0,0,this.width,this.height),a.fillStyle=this.color,a.fillRect(0,0,this.width*this.getRatio(),this.height),a.restore(),a.strokeStyle=this.borderColor,a.lineWidth=this.borderWidth,a.strokeRoundRect(0,0,this.width,this.height,this.height/2),a.restore()}})}(),function(){tm.define("tm.ui.GlossyGauge",{superClass:"tm.ui.Gauge",init:function(a){a=a||{},a.borderWidth=a.borderWidth||2,this.superInit(a)},draw:function(a){a.save(),a.roundRect(0,0,this.width,this.height,this.height/2),a.clip(),a.fillStyle=this.bgColor,a.fillRect(0,0,this.width,this.height),a.fillStyle=this.color,a.fillRect(0,0,this.width*this.getRatio(),this.height);var b=tm.graphics.LinearGradient(0,0,0,this.height);b.addColorStop(0,"rgba(255,255,255,0.9)"),b.addColorStop(.5,"rgba(255,255,255,0.5)"),b.addColorStop(.51,"rgba(255,255,255,0.2)"),b.addColorStop(1,"rgba(255,255,255,0.0)"),a.setGradient(b),a.fillRect(0,0,this.width*this.getRatio(),this.height),a.restore(),a.lineWidth=this.borderWidth,a.strokeStyle=this.borderColor,a.strokeRoundRect(0,0,this.width,this.height,this.height/2)}})}(),function(){tm.define("tm.ui.LabelArea",{superClass:"tm.display.Shape",init:function(a){a=a||{},this.superInit(a.width||150,a.height||60),this.canvas.clearColor("red"),this.$extend({mode:a.mode||"horizon",_fillStyle:a.fillStyle||"#aaa",_bgColor:a.bgColor||"transparent",_fontSize:a.fontSize||24,_fontFamily:a.fontFamily||"'Consolas', 'Monaco', 'ＭＳ ゴシック'",_fontWeight:a.fontWeight||"",lineSpace:a.lineSpace||1}),this._updateFont(),this.setText(a.text||"こんにちは,世界!")},setText:function(a){this._text!==a&&(this._text=a,this._renderText())},_renderText:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.clearColor(this.bgColor),this.canvas.font=this.fontStyle,this.canvas.fillStyle=this.fillStyle,this.canvas.fillLabelArea({text:this._text,x:0,y:0,width:this.width,height:this.height,mode:this.mode,lineSpace:this.lineSpace})},_updateFont:function(){this.fontStyle="{fontWeight} {fontSize}px {fontFamily}".format(this),this.text&&this._renderText()}}),tm.ui.LabelArea.prototype.accessor("text",{get:function(){return this._text},set:function(a){this.setText(a)}}),tm.ui.LabelArea.prototype.accessor("fontSize",{get:function(){return this._fontSize},set:function(a){this._fontSize=a,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fontFamily",{get:function(){return this._fontFamily},set:function(a){this._fontFamily=a,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fontWeight",{get:function(){return this._fontWeight},set:function(a){this._fontWeight=a,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fillStyle",{get:function(){return this._fillStyle},set:function(a){this._fillStyle=a,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("bgColor",{get:function(){return this._bgColor},set:function(a){this._bgColor=a,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("width",{get:function(){return this._width},set:function(a){this._width=a,this.text&&this._renderText()}}),tm.ui.LabelArea.prototype.accessor("height",{get:function(){return this._height},set:function(a){this._height=a,this.text&&this._renderText()}})}(),function(){tm.game=tm.game||{},tm.game.setup=function(a){a.$safe({query:"#world",title:"Title",background:"rgba(250, 250, 250, 1.0)",width:640,height:960,startLabel:"title",fitting:!0,fps:30,assets:window.ASSETS||null}),tm.globalize(),this.expand(a);var b=[{className:"SplashScene",arguments:{width:a.width,height:a.height},label:"splash",nextLabel:"title"},{className:"TitleScene",arguments:{title:a.title},label:"title"},{className:"GameScene",label:"game",nextLabel:"result"},{className:"ResultScene",arguments:{message:a.title},label:"result",nextLabel:"title"},{className:"PauseScene",label:"pause"}];tm.main(function(){var c=tm.app.CanvasApp(a.query);if(c.resize(SCREEN_WIDTH,SCREEN_HEIGHT),a.fitting&&c.fitWindow(),c.background=a.background,c.fps=a.fps,a.assets){var d=tm.game.LoadingScene({assets:a.assets,width:SCREEN_WIDTH,height:SCREEN_HEIGHT});d.onload=function(){c.replaceScene(tm.game.ManagerScene({startLabel:a.startLabel,scenes:b}))},c.replaceScene(d)}else c.replaceScene(tm.game.ManagerScene({startLabel:a.startLabel,scenes:b}));c.run(),tm.game.app=c})},tm.game.expand=function(a){tm.global.$extend({SCREEN_WIDTH:a.width,SCREEN_HEIGHT:a.height,SCREEN_CENTER_X:a.width/2,SCREEN_CENTER_Y:a.height/2,SCREEN_GRID_X:GridSystem(a.width,16),SCREEN_GRID_Y:GridSystem(a.height,16),QUERY:tm.util.QueryString.parse(location.search.substr(1))})}}(),function(){tm.define("tm.game.TitleScene",{superClass:"tm.app.Scene",init:function(a){this.superInit(),a={}.$extend(tm.game.TitleScene["default"],a),this.param=a,this.fromJSON({children:{bg:{type:"tm.display.RectangleShape",init:{width:a.width,height:a.height,fillStyle:a.bgColor,strokeStyle:"transparent"},originX:0,originY:0}}}),a.bgImage&&this.fromJSON({children:{bgImage:{type:"tm.display.Sprite",init:[a.bgImage],originX:0,originY:0}}}),this.fromJSON({children:{titleLabel:{type:"Label",name:"titleLabel",text:a.title,x:this._toGridX(6),y:this._toGridY(3),fillStyle:a.fontColor,fontSize:a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"},messageLabel:{type:"Label",name:"nextLabel",text:a.message||"",x:this._toGridX(6),y:this._toGridY(6),fillStyle:a.fontColor,fontSize:.36*a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"},touchLabel:{type:"Label",name:"nextLabel",text:"TOUCH START",x:this._toGridX(6),y:this._toGridY(9),fillStyle:a.fontColor,fontSize:.4*a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"}}}),this.touchLabel.tweener.fadeOut(500).fadeIn(1e3).setLoop(!0),this.autopop=a.autopop},_toGridX:function(a){return this.param.width/12*a},_toGridY:function(a){return this.param.height/12*a},onpointingstart:function(){this.flare("finish"),this.autopop&&this.app.popScene()}}),tm.game.TitleScene["default"]={title:"Time is money",message:"",fontSize:72,fontColor:"#444",width:640,height:960,bgColor:"rgb(240,240,240)",bgImage:null,autopop:!0}}(),function(){tm.define("tm.game.ResultScene",{superClass:"tm.app.Scene",init:function(a){this.superInit(),a={}.$extend(tm.game.ResultScene["default"],a),this.param=a;var b=this._getUserData(),c=b.bestScore?b.bestScore:0,d=a.score>c;a.record&&d&&(b.bestScore=a.score,this._record(b)),this.fromJSON({children:{bg:{type:"tm.display.RectangleShape",init:{width:a.width,height:a.height,fillStyle:a.bgColor,strokeStyle:"transparent"},originX:0,originY:0}}}),a.bgImage&&this.fromJSON({children:{bgImage:{type:"tm.display.Sprite",init:[a.bgImage],originX:0,originY:0}}});var e={type:"Label",fillStyle:a.fontColor,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"};this.fromJSON({children:{scoreText:e.$extend({text:"score",x:this._toGridX(4),y:this._toGridY(3),fontSize:.5*a.fontSize}),scoreLabel:{type:"Label",text:a.score,x:this._toGridX(4),y:this._toGridY(4),fillStyle:a.fontColor,fontSize:a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},bestText:{type:"Label",text:"best",x:this._toGridX(8),y:this._toGridY(3),fillStyle:a.fontColor,fontSize:.5*a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},bestLabel:{type:"Label",text:c,x:this._toGridX(8),y:this._toGridY(4),fillStyle:a.fontColor,fontSize:a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},newRecordText:{type:"Label",text:"new record!",x:this._toGridX(6),y:this._toGridY(6),fillStyle:a.fontColor,fontSize:.5*a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",visible:!1},messageText:{type:"Label",text:a.message,x:this._toGridX(6),y:this._toGridY(7),fillStyle:a.fontColor,fontSize:.5*a.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},shareButton:{type:"FlatButton",init:{text:"Share",width:200,fillStyle:"hsl(240, 100%, 64%)"},x:this._toGridX(4),y:this._toGridY(9)},backButton:{type:"FlatButton",init:{text:"Back",width:200,fillStyle:"hsl(240, 80%, 0%)"},x:this._toGridX(8),y:this._toGridY(9)}}});var f="SCORE: {score}, {message}".format(a),g=tm.social.Twitter.createURL({type:"tweet",text:f,hashtags:a.hashtags,url:a.url});this.shareButton.onclick=function(){window.open(g,"share window","width=400, height=300")},this.backButton.onpointingstart=this._back.bind(this),this.autopop=a.autopop,d&&(this.newRecordText.show(),this.newRecordText.tweener.set({alpha:0}).fadeIn(2e3).setLoop(!0))},_getUserData:function(){var a=location.pathname.toCRC32(),b=localStorage.getItem(a);return b?JSON.parse(b):{}},_record:function(a){var b=location.pathname.toCRC32(),c=JSON.stringify(a);return localStorage.setItem(b,c),this},_toGridX:function(a){return this.param.width/12*a},_toGridY:function(a){return this.param.height/12*a},_back:function(){this.flare("finish"),this.autopop&&this.app.popScene()}}),tm.game.ResultScene["default"]={score:0,message:"this is tmlib.js project.",hashtags:"tmlibjs,game",related:"tmlib.js tmlife javascript",url:"http://phi-jp.github.io/tmlib.js/",width:640,height:960,fontColor:"#444",fontSize:90,bgColor:"rgba(255,255,255, 0.9)",bgImage:null,record:!0,autopop:!0}}(),function(){var a={width:465,height:465,bgColor:"transparent"};tm.define("tm.game.LoadingScene",{superClass:"tm.app.Scene",init:function(b){this.superInit(),this.param=b={}.$extend(a,b),this.fromJSON({children:{stage:{type:"tm.display.CanvasElement"}}}),this.stage.fromJSON({children:{bg:{type:"tm.display.Shape",init:{width:b.width,height:b.height},originX:0,originY:0},piyoLayer:{type:"tm.display.CanvasElement"},label:{type:"tm.display.Label",text:"LOADING",x:b.width/2,y:b.height/2-20,align:"center",baseline:"middle",fontSize:46,shadowBlur:4,shadowColor:"hsl(190, 100%, 50%)"},bar:{type:"tm.ui.Gauge",init:[{width:b.width,height:10,color:"hsl(200, 100%, 80%)",bgColor:"transparent",borderColor:"transparent",borderWidth:0}],x:0,y:0}}});var c=this.stage.bg;c.canvas.clearColor(b.bgColor);var d=this.stage.label;d.tweener.to({alpha:1},1e3).to({alpha:.5},1e3).setLoop(!0);var e=this.stage.bar;e.animationFlag=!1,e.value=0,e.animationFlag=!0,e.animationTime=100,this._createHiyoko(b).addChildTo(this.stage.piyoLayer);var f=this.stage;f.alpha=0,f.tweener.clear().fadeIn(100).call(function(){if(b.assets){var a=tm.asset.Loader();a.onload=function(){f.tweener.clear().wait(200).fadeOut(200).call(function(){b.nextScene&&this.app.replaceScene(b.nextScene());var a=tm.event.Event("load");this.fire(a),1==b.autopop&&this.app.popScene()}.bind(this))}.bind(this),a.onprogress=function(a){e.value=100*a.progress;var b=tm.event.Event("progress");b.progress=a.progress,this.fire(b)}.bind(this),a.load(b.assets)}}.bind(this))},onpointingstart:function(a){var b=a.pointing,c=this._createHiyoko(this.param).addChildTo(this.stage.piyoLayer);c.x=b.x,c.y=b.y},_createHiyoko:function(a){var b=tm.display.Shape({width:84,height:84});b.x=tm.util.Random.randint(0,a.width),b.y=tm.util.Random.randint(0,a.height),b.canvas.setColorStyle("white","yellow").fillCircle(42,42,32),b.canvas.setColorStyle("white","black").fillCircle(27,27,2),b.canvas.setColorStyle("white","brown").fillRect(40,70,4,15).fillTriangle(0,40,11,35,11,45),b.dir=tm.geom.Vector2.random(0,360,4);var c=tm.geom.Rect(0,0,a.width,a.height);return c.padding(42),b.update=function(){this.position.add(this.dir),this.x<c.left?(this.x=c.left,this.dir.x*=-1):this.x>c.right&&(this.x=c.right,this.dir.x*=-1),this.y<c.top?(this.y=c.top,this.dir.y*=-1):this.y>c.bottom&&(this.y=c.bottom,this.dir.y*=-1),this.dir.x<0?(this.rotation-=7,this.scaleX=1):(this.rotation+=7,this.scaleX=-1)},b}})}(),function(){var a="https://files.gitter.im/phi-jp/tmlib.js/t5F7/splash.png";tm.define("SplashScene",{superClass:"tm.app.Scene",init:function(b){this.superInit(),this.param=b,this.splashImage=tm.asset.Texture(b.path||a),this.splashImage.onload=this._init.bind(this)},_init:function(){var a=this.param.width,b=this.param.height;tm.display.Shape({width:a,height:b,bgColor:"white"}).setOrigin(0,0).addChildTo(this),tm.display.Sprite(this.splashImage,a,b).setOrigin(0,0).setAlpha(0).addChildTo(this).tweener.clear().wait(250).fadeIn(500).wait(1e3).fadeOut(500).wait(250).call(function(){this.app.popScene()}.bind(this))}})}(),function(){tm.define("tm.game.ManagerScene",{superClass:"tm.app.Scene",init:function(a){this.superInit(),this.setScenes(a.scenes),this.on("enter",function(){this.gotoScene(a.startLabel||0)}.bind(this)),this.on("resume",this.onnext.bind(this)),this.commonArguments={}},setScenes:function(a){return this.scenes=a,this.sceneIndex=0,this},gotoScene:function(a,b){a="string"==typeof a?this.labelToIndex(a):a||0;var c=tm.event.Event("prepare");this.fire(c);var d=this.scenes[a],e=tm.using(d.className),f=d.arguments,f={}.$extend(f,b),g=e.call(null,f);g.nextLabel||(g.nextLabel=d.nextLabel),g.nextArguments||(g.nextArguments=d.nextArguments),this.app.pushScene(g),this.sceneIndex=a,this.currentScene=g;var c=tm.event.Event("goto");return c.scene=g,this.fire(c),this},gotoNext:function(a){var b=this.scenes[this.sceneIndex],c=null;return b.nextLabel?c=this.labelToIndex(b.nextLabel):this.sceneIndex+1<this.scenes.length&&(c=this.sceneIndex+1),null!==c?this.gotoScene(c,a):this.fire(tm.event.Event("finish")),this},getCurrentIndex:function(){return this.sceneIndex},getCurrentLabel:function(){return this.scenes[this.sceneIndex].label},labelToIndex:function(a){var b=this.scenes.filter(function(b){return b.label==a})[0];return this.scenes.indexOf(b)},indexToLabel:function(a){return this.scenes[a].label},onnext:function(a){var b=a.prevScene.nextLabel,c=a.prevScene.nextArguments;b?this.gotoScene(b,c):this.gotoNext(c)}})}(),function(){tm.define("tm.game.NumericalInputScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.fromJSON({children:{inputLabel:{type:"tm.display.Label",fillStyle:"white",text:"",fontSize:64,x:320,y:120},buttonGroup:{type:"tm.display.CanvasElement"}}}),[1,2,3,4,5,6,7,8,9,"C",0,"OK"].each(function(a,b){var c=this._createButton(a.toString()).addChildTo(this.buttonGroup),d=b%3,e=b/3|0;c.x=190*d+130,c.y=177*e+280},this);var a=this,b=this.buttonGroup.children;b.each(function(b){b.setInteractive(!0).setBoundingType("circle"),b.radius=72.5,b.onpointingstart=function(){if("OK"==this.label.text){var b=tm.event.Event("decided");b.value=Number(a.inputLabel.text),a.fire(b)}else if("C"==this.label.text){var b=tm.event.Event("push");a.inputLabel.text="",a.flare("clear")}else a.inputLabel.text+=this.label.text,a.flare("push",{select:this.label.text})}})},_createButton:function(a){var b=tm.display.CanvasElement();return b.fromJSON({children:{bg:{type:"tm.display.CircleShape",init:[145,145,{fillStyle:"transparent",strokeStyle:"white"}]},label:{type:"tm.display.Label",text:a,fontSize:64,fillStyle:"white"}}}),b}})}(),function(){tm.define("tm.game.CountScene",{superClass:"tm.app.Scene",init:function(a){this.superInit(),a=a.$safe({width:640,height:960,bgColor:"#444",count:3,autopop:!0,fontSize:180}),a=a||{},this.fromJSON({children:{bg:{type:"tm.display.Shape",width:a.width,height:a.height,bgColor:a.bgColor,originX:0,originY:0},label:{type:"tm.display.Label",fillStyle:"white",fontSize:a.fontSize,x:SCREEN_CENTER_X,y:SCREEN_CENTER_Y}}}),this.countList=a.count instanceof Array?a.count.reverse():Array.range(1,a.count+1),this.counter=this.countList.length,this.autopop=a.autopop,this._updateCount()},_updateCount:function(){var a=(this.counter<=0,--this.counter);this.label.text=this.countList[a],this.label.scale.set(1,1),this.label.tweener.clear().to({scaleX:1,scaleY:1,alpha:1},250).wait(500).to({scaleX:1.5,scaleY:1.5,alpha:0},250).call(function(){this.counter<=0?(this.flare("finish"),this.autopop&&this.app.popScene()):this._updateCount()},this)}})}(),tm.three=tm.three||{},function(){tm.global.THREE&&(tm.three.ThreeApp=tm.createClass({superClass:tm.app.BaseApp,canvas:null,background:null,_scenes:null,_sceneIndex:0,init:function(a){a instanceof HTMLCanvasElement?this.element=a:"string"==typeof a?this.element=document.querySelector(a):(this.element=document.createElement("canvas"),document.body.appendChild(this.element)),this.superInit(this.element),this.renderer=new THREE.WebGLRenderer({canvas:this.element,clearColor:2236962,clearAlpha:1}),this.renderer.setSize(this.element.width,this.element.height),this._scenes=[tm.three.Scene()]},resize:function(a,b){return this.width=a,this.height=b,this.renderer.setSize(this.width,this.height),this},resizeWindow:function(){return this.width=innerWidth,this.height=innerHeight,this.renderer.setSize(this.width,this.height),this},fitWindow:function(a){var b=function(){a=void 0===a?!0:a;var b=this.element,c=b.style;c.position="absolute",c.left="0px",c.top="0px";var d=b.width/window.innerWidth,e=b.height/window.innerHeight,f=b.height/b.width;d>e?(c.width=innerWidth+"px",c.height=innerWidth*f+"px"):(c.width=innerHeight/f+"px",c.height=innerHeight+"px")}.bind(this);b(),a&&window.addEventListener("resize",b,!1),this.mouse._mousemove=this.mouse._mousemoveScale,this.touch._touchmove=this.touch._touchmoveScale},_draw:function(){for(var a=0,b=this._scenes.length;b>a;++a)this.renderer.render(this.currentScene,this.currentScene.camera)}}),tm.three.ThreeApp.prototype.accessor("width",{get:function(){return this.element.width},set:function(a){this.element.width=a}}),tm.three.ThreeApp.prototype.accessor("height",{get:function(){return this.element.height},set:function(a){this.element.height=a}}))}(),function(){tm.global.THREE&&(tm.three.Element=tm.createClass({superClass:THREE.Object3D,init:function(){THREE.Object3D.call(this),tm.event.EventDispatcher.prototype.init.call(this)},update:function(){},_update:function(a){if(0!=this.awake){this.update(a);var b=tm.event.Event("enterframe");if(b.app=a,this.dispatchEvent(b),this.children.length>0)for(var c=this.children.slice(),d=0,e=c.length;e>d;++d){var f=c[d];f._update&&f._update(a)}}}}),tm.three.Element.prototype.$safe(tm.event.EventDispatcher.prototype))}(),function(){tm.global.THREE&&(tm.three.MeshElement=tm.createClass({superClass:THREE.Mesh,init:function(a,b){b=b||new THREE.MeshNormalMaterial,THREE.Mesh.call(this,a,b),tm.three.Element.prototype.init.call(this)}}),tm.three.MeshElement.prototype.$safe(tm.three.Element.prototype),tm.three.CubeElement=tm.createClass({superClass:tm.three.MeshElement,init:function(a,b,c){a=a||100,b=b||100,c=c||100;var d=new THREE.CubeGeometry(a,b,c),e=new THREE.MeshNormalMaterial;this.superInit(d,e)}}),tm.three.SphereElement=tm.createClass({superClass:tm.three.MeshElement,init:function(a,b,c){a=a||45,b=b||16,c=c||12;var d=new THREE.SphereGeometry(a,b,c),e=new THREE.MeshNormalMaterial;this.superInit(d,e)}}),tm.three.PlaneElement=tm.createClass({superClass:tm.three.MeshElement,init:function(a,b){var c=new THREE.PlaneGeometry(a,b),d=new THREE.MeshNormalMaterial;this.superInit(c,d)}}),tm.three.FloorElement=tm.createClass({superClass:tm.three.MeshElement,init:function(a,b){a=a||1e3,b=b||1e3;var c=new THREE.PlaneGeometry(a,b),d=new THREE.MeshBasicMaterial;this.superInit(c,d),this.rotation.x=-Math.PI/2,this._render()},_render:function(){var a=tm.graphics.Canvas();a.resize(128,128),a.clearColor("#444"),a.setFillStyle("white"),a.fillRect(0,0,64,64),a.fillRect(64,64,64,64);var b=new THREE.Texture(a.element);b.wrapS=b.wrapT=THREE.RepeatWrapping,b.repeat.set(10,10),b.needsUpdate=!0,this.material.map=b}}),tm.three.TextElement=tm.createClass({superClass:tm.three.MeshElement,init:function(a,b){var c=new THREE.TextGeometry(a,b),d=new THREE.MeshNormalMaterial;this.superInit(c,d)}}),tm.three.CanvasTexture=tm.createClass({superClass:THREE.Texture,canvas:null,init:function(){this.canvas=tm.graphics.Canvas(),THREE.Texture.call(this,this.canvas.element),this.needsUpdate=!0}}))}(),function(){tm.global.THREE&&(tm.three.Scene=tm.createClass({superClass:THREE.Scene,init:function(a,b){a=a||60,b=b||640/480,THREE.Scene.call(this),tm.three.Element.prototype.init.call(this),this.camera=new THREE.PerspectiveCamera(a,b,1,1e4),this.camera.position.y=100,this.camera.position.z=500,this.projector=new THREE.Projector},intersect:function(a){a=a||this.children;var b=this.app.pointing.x,c=this.app.pointing.y;b=b/this.app.width*2-1,c=2*-(c/this.app.height)+1;var d=new THREE.Vector3(b,c,.5);this.projector.unprojectVector(d,this.camera);var e=new THREE.Raycaster(this.camera.position,d.sub(this.camera.position).normalize());return e.intersectObjects(a)}}),tm.three.Scene.prototype.$safe(tm.three.Element.prototype))}(),tm.sound=tm.sound||{},function(){tm.sound.globalVolume=1}(),function(){if(tm.sound.Sound=tm.createClass({superClass:tm.event.EventDispatcher,element:null,loaded:!1,isPlay:!1,init:function(a){this.superInit(),this.element=new Audio,this.element.src=a,this.element.load(),this.element.setAttribute("preload","auto");var b=this;this.element.addEventListener("canplaythrough",function(){b.loaded=!0,b.fire(tm.event.Event("load"))}),this.element.addEventListener("ended",function(){b.isPlay=!1}),this.element.addEventListener("error",function(){console.warn(this.src+"の読み込みに失敗しました")}),this.element.volume=1,tm.isMobile&&(this.loaded=!0)},play:function(){return this.element.play(),this.isPlay=!0,this},stop:function(){return this.element.pause(),tm.isMobile||(this.element.currentTime=0),this.isPlay=!1,this},pause:function(){return this.element.pause(),this},clone:function(){return tm.sound.Sound(this.element.src)}}),tm.sound.Sound.prototype.accessor("volume",{get:function(){return this.element.volume},set:function(a){this.element.volume=a}}),void 0!==(new Audio).loop)tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(a){this.element.loop=a}});else{var a=function(){this.play()};tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(b){1!=this.element.loop&&1==b?this.element.addEventListener("ended",a,!1):1==this.element.loop&&0==b&&this.element.removeEventListener("ended",a,!1),this.element.loop=b}})}tm.sound.Sound.SUPPORT_EXT=function(){var a="",b=new Audio;return"maybe"==b.canPlayType("audio/wav")?a="wav":"maybe"==b.canPlayType("audio/mp3")?a="mp3":"maybe"==b.canPlayType("audio/ogg")&&(a="ogg"),a}()}(),tm.sound=tm.sound||{},function(){var a=null;tm.sound.WebAudio=tm.createClass({superClass:tm.event.EventDispatcher,loaded:!1,context:null,panner:null,volume:.8,playing:!1,_pannerEnabled:!0,init:function(b){this.superInit(),this.context=a;var c=typeof b;"string"===c?(this.loaded=!1,this._load(b)):"object"===c?(this._setup(),this.buffer=b,this.loaded=!0,this.dispatchEvent(tm.event.Event("load"))):(this._setup(),this.loaded=!1)},play:function(a){if(1!=this.playing){this.playing=!0,void 0===a&&(a=0),this.source.start(this.context.currentTime+a);var b=this,a=this.source.buffer.duration/this.source.playbackRate.value*1e3;return window.setTimeout(function(){var a=tm.event.Event("ended");b.fire(a)},a),this}},stop:function(a){if(0!=this.playing&&(this.playing=!1,void 0===a&&(a=0),0!=this.source.playbackState)){this.source.stop(this.context.currentTime+a);var b=this.buffer,c=this.volume,d=this.loop;return this.source=this.context.createBufferSource(),this.source.connect(this.gainNode),this.buffer=b,this.volume=c,this.loop=d,this}},pause:function(){return this.source.disconnect(),this},resume:function(){return this.source.connect(this.gainNode),this},clone:function(){var a=tm.sound.WebAudio(this.buffer);return a.volume=this.volume,a},setPosition:function(a,b,c){return this.panner.setPosition(a,b||0,c||0),this},setVelocity:function(a,b,c){return this.panner.setVelocity(a,b||0,c||0),this},setOrientation:function(a,b,c){return this.panner.setOrientation(a,b||0,c||0),this},setBuffer:function(a){return this.buffer=a,this},setLoop:function(a){return this.loop=a,this},setVolume:function(a){return this.volume=a,this},setPlaybackRate:function(a){return this.playbackRate=a,this},_load:function(b){if(!this.context)return void console.warn("本環境はWebAudio未対応です。("+b+")");var c=this;tm.util.Ajax.load({type:"GET",url:b,responseType:"arraybuffer",success:function(d){c.context.decodeAudioData(d,function(a){c._setup(),c.buffer=a,c.loaded=!0,c.dispatchEvent(tm.event.Event("load"))},function(){console.warn("音声ファイルのデコードに失敗しました。("+b+")"),c._setup(),c.buffer=a.createBuffer(1,1,22050),c.loaded=!0,c.dispatchEvent(tm.event.Event("load"))})}})},_setup:function(){this.source=this.context.createBufferSource(),this.gainNode=this.context.createGain(),this.analyser=this.context.createAnalyser(),this.source.connect(this.gainNode),this.gainNode.connect(this.analyser),this.analyser.connect(this.context.destination),"Firefox"===tm.BROWSER&&(this.pannerEnabled=!1)},tone:function(a,b){a=void 0!==a?a:200,b=void 0!==b?b:1;for(var c=1,d=44100,e=2,f=this.context.createBuffer(c,b*d,d),g=f.getChannelData(0),h=0;h<g.length;h++){var i=h/f.sampleRate,j=a*i*Math.PI;g[h]=Math.sin(j)*e}return this.buffer=f,this}}),tm.sound.WebAudio.prototype.accessor("buffer",{get:function(){return this.source.buffer},set:function(a){this.source.buffer=a}}),tm.sound.WebAudio.prototype.accessor("loop",{get:function(){return this.source.loop},set:function(a){this.source.loop=a}}),tm.sound.WebAudio.prototype.accessor("volume",{get:function(){return this.gainNode.gain.value},set:function(a){this.gainNode.gain.value=a}}),tm.sound.WebAudio.prototype.accessor("playbackRate",{get:function(){return this.source.playbackRate.value},set:function(a){this.source.playbackRate.value=a}}),tm.sound.WebAudio.prototype.accessor("pannerEnabled",{get:function(){return this._pannerEnabled},set:function(a){this.gainNode.disconnect(),this.panner.disconnect(),a?(this.gainNode.connect(this.panner),this.panner.connect(this.analyser)):this.gainNode.connect(this.analyser),this._pannerEnabled=a}}),tm.sound.WebAudio.prototype.accessor("loopStart",{get:function(){return this.source.loopStart},set:function(a){this.source.loopStart=a}}),tm.sound.WebAudio.prototype.accessor("loopEnd",{get:function(){return this.source.loopEnd},set:function(a){this.source.loopEnd=a}}),tm.sound.WebAudio.isAvailable=tm.global.AudioContext||tm.global.webkitAudioContext||tm.global.mozAudioContext?!0:!1,tm.sound.WebAudio.createContext=function(){tm.global.AudioContext?a=new AudioContext:tm.global.webkitAudioContext?a=new webkitAudioContext:tm.global.mozAudioContext&&(a=new mozAudioContext),tm.sound.WebAudio.context=a},tm.sound.WebAudio.unlock=function(){var b=a.createBuffer(1,1,22050),c=a.createBufferSource();c.buffer=b,c.connect(a.destination),c.start(0)},tm.sound.WebAudio.createContext()}(),function(){tm.sound.SoundManager={volume:.8,musicVolume:.8,muteFlag:!1,currentMusic:null,play:function(a){var b=tm.asset.Manager.get(a).clone();return b.volume=this.getVolume(),b.play(),b},stop:function(){},pause:function(){},fade:function(){},setVolume:function(a){this.volume=a},getVolume:function(){return this.isMute()?0:this.volume},mute:function(){return this.muteFlag=this.muteFlag===!0?!1:!0,this.currentMusic&&(this.currentMusic.volume=this.getVolumeMusic()),this},isMute:function(){return this.muteFlag},playMusic:function(a,b){this.currentMusic&&this.stopMusic(b);var c=tm.asset.Manager.get(a).clone();

if(c.setLoop(!0),c.volume=this.getVolumeMusic(),c.play(),b>0){var d=32,e=0,f=b/d,g=this.getVolumeMusic();c.volume=0;var h=setInterval(function(){e+=1;var a=e/d;return c.volume=a*g,a>=1?(clearInterval(h),!1):!0},f)}else c.volume=this.getVolumeMusic();return this.currentMusic=c,this.currentMusic},stopMusic:function(a){if(this.currentMusic){var b=this.currentMusic;if(a>0){var c=32,d=0,e=a/c,f=this.getVolumeMusic();b.volume=0;var g=setInterval(function(){d+=1;var a=d/c;return b.volume=f*(1-a),a>=1?(b.stop(),clearInterval(g),!1):!0},e)}else this.currentMusic.stop()}},pauseMusic:function(){this.currentMusic&&this.currentMusic.pause()},resumeMusic:function(){this.currentMusic&&this.currentMusic.resume()},setVolumeMusic:function(a){return this.musicVolume=a,this.currentMusic&&(this.currentMusic.volume=a),this},getVolumeMusic:function(){return this.isMute()?0:this.musicVolume}}}(),tm.social=tm.social||{},function(){tm.social.Twitter=tm.social.Twitter||{},tm.social.Twitter.API_URL="http://api.twitter.com/1";var a="http://twitter.com/intent";tm.social.Twitter.createURL=function(b){var c=[];for(var d in b)if("type"!=d){var e=encodeURIComponent(b[d]),f=d+"="+e;c.push(f)}var g="{baseURL}/{type}?{param}".format({baseURL:a,type:b.type,param:c.join("&")});return g}}(),function(){var a="http://api.twitter.com/1/{type}/{kind}.json";tm.social.Twitter.api=function(b,c,d,e){var f=a.format({type:b,kind:c}),g=tm.util.QueryString.stringify(d);tm.util.Ajax.loadJSONP(f+"?"+g,e)}}(),function(){var a="http://search.twitter.com/search.json";tm.social.Twitter.search=function(b,c){var d=a,e=tm.util.QueryString.stringify(b);tm.util.Ajax.loadJSONP(d+"?"+e,c)}}(),function(){tm.social.Twitter.getFollowers=function(a,b){tm.social.Twitter.api("statuses","followers",a,b)}}(),tm.social=tm.social||{},function(){tm.social.Nineleap=tm.social.Nineleap||{};var a="http://9leap.net/games/{id}/result?score={score}&result={result}";tm.social.Nineleap.DEBUG_GAME_ID="0",tm.social.Nineleap.createURL=function(b,c,d){return a.format({id:b,score:c,result:d})},tm.social.Nineleap.postRanking=function(a,b){if("r.jsgames.jp"==location.hostname){var c=location.pathname.match(/^\/games\/(\d+)/)[1];location.replace(this.createURL(c,a,b))}else console.warn("9leap に投稿されていません!")},tm.social.Nineleap.gotoLogin=function(){window.location.replace("http://9leap.net/api/login")},tm.social.Nineleap.isOn9leap=function(){return"r.jsgames.jp"===window.location.hostname},tm.social.Nineleap.getGameId=function(){return tm.social.Nineleap.isOn9leap()?window.location.pathname.match(/^\/games\/(\d+)/)[1]:tm.social.Nineleap.DEBUG_GAME_ID},tm.social.Nineleap.getMyData=function(a){tm.util.Ajax.loadJSONP(tm.social.Nineleap.createMyDataURL(),a)},tm.social.Nineleap.postMyData=function(a,b){tm.util.Ajax.load({type:"POST",url:tm.social.Nineleap.createMemoryURL("user_memory.json"),dataType:"json",data:"json="+JSON.stringify(a),contentType:"application/x-www-form-urlencoded;charset=UTF-8",async:!1,beforeSend:function(a){a.withCredentials=!0},success:b,error:function(a){console.error(a)}})},tm.social.Nineleap.createMemoryURL=function(){for(var a=["http://9leap.net/api/memory/",tm.social.Nineleap.getGameId()+"/"],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return a.join("")},tm.social.Nineleap.createMyDataURL=function(){return tm.social.Nineleap.createMemoryURL("user_memory.json")},tm.social.Nineleap.createUserDataURL=function(a){return tm.social.Nineleap.createMemoryURL("u/",a+".json")},tm.social.Nineleap.createRecentDataURL=function(a){return a=a||30,tm.social.Nineleap.createMemoryURL("recent_memories.json","?max="+a)},tm.social.Nineleap.createFriendDataURL=function(a){return a=a||30,tm.social.Nineleap.createMemoryURL("friends_memories.json","?max="+a)},tm.social.Nineleap.createRankingDataURL=function(a){return a=a||30,tm.social.Nineleap.createMemoryURL("ranking_memories.json","?max="+a)}}(),tm.google=tm.google||{},function(){tm.google.Chart=tm.google.Chart||{};var a="https://chart.googleapis.com/chart?chst={type}&chld={data}",b="https://chart.googleapis.com/chart?chs={size}&cht={type}&chl={text}&chco={color}";tm.google.Chart.createDynamicIcons=function(b,c){return a.format({type:b,data:c})},tm.google.Chart.createQRCode=function(a,c){return c=encodeURIComponent(c),b.format({type:"qr",size:a,text:c})},tm.google.Chart.createTeX=function(){}}(),function(){tm.app.Element.prototype.getter("interaction",function(){console.assert(!1,"interaction は Object2d に統合されました. obj.setInteractive(true); とすればタッチ判定が有効になります.")});var a={display:["Sprite","Shape","CircleShape","TriangleShape","RectangleShape","RoundRectangleShape","StarShape","PolygonShape","HeartShape","TextShape","CanvasRenderer","BoundingRectRenderer","Label","MapSprite","CanvasElement","CanvasApp","AnimationSprite","SpriteSheet"],ui:["LabelButton","IconButton","GlossyButton","FlatButton","LoadingScene"]};for(var b in a){var c=a[b];c.each(function(a){tm.app[a]=tm[b][a]})}tm.asset.AssetManager=tm.asset.Manager,tm.util.getter("Script",function(){console.warn("`tm.util.Script` は `tm.asset.Script` になりました!")}),tm.ui.LoadingScene=function(a){return console.warn("`tm.ui.LoadingScene` は `tm.game.LoadingScene` になりました!"),tm.game.LoadingScene(a)},tm.scene=tm.scene||{},tm.scene.ManagerScene=tm.game.ManagerScene,tm.scene.LoadingScene=tm.game.LoadingScene,tm.scene.TitleScene=tm.game.TitleScene,tm.scene.ResultScene=tm.game.ResultScene,tm.scene.NumericalInputScene=tm.game.NumericalInputScene,tm.getter("scene",function(){return console.warn("tm.scene は tm.game に変更されました"),tm.game})}();var bulletml={};bulletml.GLOBAL=this,function(){function a(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c].label==b)return a[c]}bulletml.Node=function(){},bulletml.Node.prototype.scan=function(a){a(this);for(var b in this)if(this.hasOwnProperty(b)){var c=this[b];c instanceof bulletml.Node&&c.scan(a)}},bulletml.Root=function(a){if(bulletml.Node.call(this),this.type="none",this.root=this,this.actions=[],this.bullets=[],this.fires=[],void 0!==a){for(var b in a)a.hasOwnProperty(b)&&(a[b].label=b,a[b]instanceof bulletml.Action?this.actions.push(a[b]):a[b]instanceof bulletml.Bullet?this.bullets.push(a[b]):a[b]instanceof bulletml.Fire&&this.fires.push(a[b]));for(var c=0,d=this.actions.length;d>c;c++)this.actions[c].setRoot(this);for(var c=0,d=this.bullets.length;d>c;c++)this.bullets[c].setRoot(this);for(var c=0,d=this.fires.length;d>c;c++)this.fires[c].setRoot(this)}},bulletml.Root.prototype=Object.create(bulletml.Node.prototype),bulletml.Root.prototype.findAction=function(b){return a(this.actions,b)},bulletml.Root.prototype.getTopActionLabels=function(){for(var a=[],b=0,c=this.actions.length;c>b;b++){var d=this.actions[b];d.label&&0===d.label.indexOf("top")&&(a[a.length]=d.label)}return a},bulletml.Root.prototype.findActionOrThrow=function(a){var b;if(b=this.findAction(a))return b;throw new Error("action labeled '"+a+"' is undefined.")},bulletml.Root.prototype.findBullet=function(b){return a(this.bullets,b)},bulletml.Root.prototype.findBulletOrThrow=function(a){var b;if(b=this.findBullet(a))return b;throw new Error("bullet labeled '"+a+"' is undefined.")},bulletml.Root.prototype.findFire=function(b){return a(this.fires,b)},bulletml.Root.prototype.findFireOrThrow=function(a){var b;if(b=this.findFire(a))return b;throw new Error("fire labeled '"+a+"' is undefined.")},bulletml.Bullet=function(){bulletml.Node.call(this),this.label=null,this.root=null,this.direction=new bulletml.Direction(0),this.speed=new bulletml.Speed(1),this.actions=[],this.option={},this._localScope={}},bulletml.Bullet.prototype=Object.create(bulletml.Node.prototype),bulletml.Bullet.prototype.clone=function(a){var b=new bulletml.Bullet;return b.label=this.label,b.root=this.root,b.actions=this.actions,b.direction=new bulletml.Direction(a._evalParam(this.direction.value)),b.direction.type=this.direction.type,b.speed=new bulletml.Speed(a._evalParam(this.speed.value)),b.speed.type=this.speed.type,b.option=this.option,b._localScope=a._localScope,b},bulletml.Bullet.prototype.setRoot=function(a){this.root=a;for(var b=0,c=this.actions.length;c>b;b++)this.actions[b].setRoot(a)},bulletml.BulletRef=function(a){bulletml.Node.call(this),this.root=null,this.label=a,this.params=[]},bulletml.BulletRef.prototype=Object.create(bulletml.Node.prototype),bulletml.BulletRef.prototype.clone=function(a){var b=a._localScope;a._localScope=a._newScope(this.params);var c=this.root.findBulletOrThrow(this.label).clone(a);return a._localScope=b,c},bulletml.BulletRef.prototype.setRoot=function(a){this.root=a},bulletml.Command=function(){bulletml.Node.call(this),this.commandName=""},bulletml.Command.prototype=Object.create(bulletml.Node.prototype),bulletml.Command.prototype.setRoot=function(a){this.root=a},bulletml.Action=function(){bulletml.Command.call(this),this.commandName="action",this.label=null,this.root=null,this.commands=[],this.params=[]},bulletml.Action.prototype=Object.create(bulletml.Command.prototype),bulletml.Action.prototype.setRoot=function(a){this.root=a;for(var b=0,c=this.commands.length;c>b;b++)this.commands[b].setRoot(a)},bulletml.Action.prototype.clone=function(){var a=new bulletml.Action;return a.label=this.label,a.root=this.root,a.commands=this.commands,a},bulletml.ActionRef=function(a){bulletml.Command.call(this),this.commandName="actionRef",this.label=a,this.root=null,this.params=[]},bulletml.ActionRef.prototype=Object.create(bulletml.Command.prototype),bulletml.ActionRef.prototype.clone=function(){var a=new bulletml.Action;return a.root=this.root,a.commands.push(this),a},bulletml.Fire=function(){bulletml.Command.call(this),this.commandName="fire",this.label=null,this.root=null,this.direction=null,this.speed=null,this.bullet=null,this.option=new bulletml.FireOption},bulletml.Fire.prototype=Object.create(bulletml.Command.prototype),bulletml.Fire.prototype.setRoot=function(a){this.root=a,this.bullet&&this.bullet.setRoot(a)},bulletml.FireRef=function(a){bulletml.Command.call(this),this.commandName="fireRef",this.label=a,this.params=[]},bulletml.FireRef.prototype=Object.create(bulletml.Command.prototype),bulletml.ChangeDirection=function(){bulletml.Command.call(this),this.commandName="changeDirection",this.direction=new bulletml.Direction,this.term=0},bulletml.ChangeDirection.prototype=Object.create(bulletml.Command.prototype),bulletml.ChangeSpeed=function(){bulletml.Command.call(this),this.commandName="changeSpeed",this.speed=new bulletml.Speed,this.term=0},bulletml.ChangeSpeed.prototype=Object.create(bulletml.Command.prototype),bulletml.Accel=function(){bulletml.Command.call(this),this.commandName="accel",this.horizontal=new bulletml.Horizontal,this.vertical=new bulletml.Vertical,this.term=0},bulletml.Accel.prototype=Object.create(bulletml.Command.prototype),bulletml.Wait=function(a){bulletml.Command.call(this),this.commandName="wait",this.value=a||0},bulletml.Wait.prototype=Object.create(bulletml.Command.prototype),bulletml.Vanish=function(){bulletml.Command.call(this),this.commandName="vanish"},bulletml.Vanish.prototype=Object.create(bulletml.Command.prototype),bulletml.Repeat=function(){bulletml.Command.call(this),this.commandName="repeat",this.times=0,this.action=null,this.params=[]},bulletml.Repeat.prototype=Object.create(bulletml.Command.prototype),bulletml.Repeat.prototype.setRoot=function(a){this.root=a,this.action&&this.action.setRoot(a)},bulletml.Bind=function(a,b){bulletml.Command.call(this),this.commandName="bind",this.variable=a,this.expression=b},bulletml.Bind.prototype=Object.create(bulletml.Command.prototype),bulletml.Notify=function(a,b){bulletml.Command.call(this),this.commandName="notify",this.eventName=a,this.params=b||null},bulletml.Notify.prototype=Object.create(bulletml.Command.prototype),bulletml.DummyCommand=new bulletml.Command,bulletml.Direction=function(a){bulletml.Node.call(this),this.type="aim",this.value=a||0},bulletml.Direction.prototype=Object.create(bulletml.Node.prototype),bulletml.Speed=function(a){bulletml.Node.call(this),this.type="absolute",this.value=void 0===a?1:a},bulletml.Speed.prototype=Object.create(bulletml.Node.prototype),bulletml.Horizontal=function(a){bulletml.Node.call(this),this.type="absolute",this.value=a||0},bulletml.Horizontal.prototype=Object.create(bulletml.Node.prototype),bulletml.Vertical=function(a){bulletml.Node.call(this),this.type="absolute",this.value=a||0},bulletml.Vertical.prototype=Object.create(bulletml.Node.prototype),bulletml.FireOption=function(a){bulletml.Node.call(this),a=a||{},this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.autonomy=!0,void 0!==a.autonomy&&(this.autonomy=!!a.autonomy)},bulletml.FireOption.prototype=Object.create(bulletml.Node.prototype),bulletml.OffsetX=function(a){bulletml.Node.call(this),this.value=a||0},bulletml.OffsetX.prototype=Object.create(bulletml.Node.prototype),bulletml.OffsetY=function(a){bulletml.Node.call(this),this.value=a||0},bulletml.OffsetY.prototype=Object.create(bulletml.Node.prototype),bulletml.Autonomy=function(a){bulletml.Node.call(this),this.value=!!a},bulletml.Autonomy.prototype=Object.create(bulletml.Node.prototype)}(),function(){bulletml.Walker=function(a){this._root=a,this._stack=[],this._cursor=-1,this._action=null,this._localScope={}},bulletml.Walker.prototype.next=function(){if(this._cursor+=1,null!==this._action){var a=this._action.commands[this._cursor];if(void 0!==a){if(a instanceof bulletml.Action)return this._pushStack(),this._action=a,this._localScope=this._cloneScope(),this.next();if(a instanceof bulletml.ActionRef)return this._pushStack(),this._action=this._root.findActionOrThrow(a.label),this._localScope=this._newScope(a.params),this.next();if(a instanceof bulletml.Repeat)return this._localScope.loopCounter=0,this._localScope.loopEnd=this._evalParam(a.times),this._pushStack(),this._action=a.action.clone(),this._localScope=this._cloneScope(),this.next();if(a instanceof bulletml.Fire){var b=new bulletml.Fire;return b.bullet=a.bullet.clone(this),null!==a.direction&&(b.direction=new bulletml.Direction(this._evalParam(a.direction.value)),b.direction.type=a.direction.type),null!==a.speed&&(b.speed=new bulletml.Speed(this._evalParam(a.speed.value)),b.speed.type=a.speed.type),b.option=new bulletml.FireOption,b.option.offsetX=this._evalParam(a.option.offsetX),b.option.offsetY=this._evalParam(a.option.offsetY),b.option.autonomy=a.option.autonomy,b}if(a instanceof bulletml.FireRef)return this._pushStack(),this._action=new bulletml.Action,this._action.commands=[this._root.findFireOrThrow(a.label)],this._localScope=this._newScope(a.params),this.next();if(a instanceof bulletml.ChangeDirection){var c=new bulletml.ChangeDirection;return c.direction.type=a.direction.type,c.direction.value=this._evalParam(a.direction.value),c.term=this._evalParam(a.term),c}if(a instanceof bulletml.ChangeSpeed){var d=new bulletml.ChangeSpeed;return d.speed.type=a.speed.type,d.speed.value=this._evalParam(a.speed.value),d.term=this._evalParam(a.term),d}if(a instanceof bulletml.Accel){var e=new bulletml.Accel;return e.horizontal.type=a.horizontal.type,e.horizontal.value=this._evalParam(a.horizontal.value),e.vertical.type=a.vertical.type,e.vertical.value=this._evalParam(a.vertical.value),e.term=this._evalParam(a.term),e}return a instanceof bulletml.Wait?new bulletml.Wait(this._evalParam(a.value)):a instanceof bulletml.Vanish?a:a instanceof bulletml.Bind?(this._localScope["$"+a.variable]=this._evalParam(a.expression),bulletml.DummyCommand):a instanceof bulletml.Notify?a:null}return this._popStack(),null===this._action?null:(a=this._action.commands[this._cursor],a&&"repeat"==a.commandName?(this._localScope.loopCounter++,this._localScope.loopCounter<this._localScope.loopEnd?(this._pushStack(),this._action=a.action.clone(),this._localScope=this._cloneScope(),this.next()):this.next()):this.next())}return null},bulletml.Walker.prototype._pushStack=function(){this._stack.push({action:this._action,cursor:this._cursor,scope:this._localScope}),this._cursor=-1},bulletml.Walker.prototype._popStack=function(){var a=this._stack.pop();a?(this._cursor=a.cursor,this._action=a.action,this._localScope=a.scope):(this._cursor=-1,this._action=null,this._localScope={})},bulletml.Walker.prototype._evalParam=function(a){var b;if("boolean"==typeof a)return a?1:0;if("number"==typeof a)return a;if(!isNaN(b=Number(a)))return b;if(b=this._localScope[a])return b;if(b=bulletml.Walker.globalScope[a])return b;if("$rand"===a)return Math.random();var c={};for(var d in bulletml.Walker.globalScope)bulletml.Walker.globalScope.hasOwnProperty(d)&&(c[d]=bulletml.Walker.globalScope[d]);for(var d in this._localScope)this._localScope.hasOwnProperty(d)&&(c[d]=this._localScope[d]);c.$rand=Math.random();var e=this._stack[this._stack.length-1];e&&(c.$loop={index:e.scope.loopCounter,count:e.scope.loopCounter+1,first:0===e.scope.loopCounter,last:e.scope.loopCounter+1>=e.scope.loopEnd});var f=new Function("return "+a.split("$").join("this.$")),g=f.apply(c);return g},bulletml.Walker.prototype._newScope=function(a){var b={};if(a)for(var c=0,d=a.length;d>c;c++)b["$"+(c+1)]=this._evalParam(a[c]);else for(var e in this._localScope)this._localScope.hasOwnProperty(e)&&(b[e]=this._localScope[e]);return b},bulletml.Walker.prototype._cloneScope=function(){var a={};for(var b in this._localScope)this._localScope.hasOwnProperty(b)&&(a[b]=this._localScope[b]);return a},bulletml.Root.prototype.getWalker=function(a){var b=new bulletml.Walker(this),c=this.findAction(a);return c&&(b._action=c),b},bulletml.Bullet.prototype.getWalker=function(){var a=new bulletml.Walker(this.root),b=new bulletml.Action;return b.root=this.root,b.commands=this.actions,a._action=b,a._localScope=this._localScope,a},bulletml.Walker.globalScope={}}(),function(){function a(a){var c=new bulletml.Root,e=a.getElementsByTagName("bulletml")[0];if(e){u(e,"type",function(a){c.type=a});var g=e.getElementsByTagName("action");if(g)for(var h=0,i=g.length;i>h;h++)if(g[h].parentNode===e){var j=b(c,g[h]);j&&(c.actions[c.actions.length]=j)}var k=e.getElementsByTagName("bullet");if(k)for(var h=0,i=k.length;i>h;h++)if(k[h].parentNode===e){var l=d(c,k[h]);l&&(c.bullets[c.bullets.length]=l)}var m=e.getElementsByTagName("fire");if(m)for(var h=0,i=m.length;i>h;h++)if(m[h].parentNode===e){var n=f(c,m[h]);n&&(c.fires[c.fires.length]=n)}return c}}function b(a,d){var e=new bulletml.Action;return u(d,"label",function(a){e.label=a}),t(d,".",function(d){switch(d.tagName.toLowerCase()){case"action":e.commands[e.commands.length]=b(a,d);break;case"actionref":e.commands[e.commands.length]=c(a,d);break;case"fire":e.commands[e.commands.length]=f(a,d);break;case"fireref":e.commands[e.commands.length]=g(a,d);break;case"changedirection":e.commands[e.commands.length]=h(a,d);break;case"changespeed":e.commands[e.commands.length]=i(a,d);break;case"accel":e.commands[e.commands.length]=j(a,d);break;case"wait":e.commands[e.commands.length]=k(a,d);break;case"vanish":e.commands[e.commands.length]=l(a,d);break;case"repeat":e.commands[e.commands.length]=m(a,d)}}),e.root=a,e}function c(a,b){var c=new bulletml.ActionRef(u(b,"label"));return t(b,/param$/,function(a){c.params[c.params.length]=v(a)}),c.root=a,c}function d(a,d){var e=new bulletml.Bullet;return u(d,"label",function(a){e.label=a}),s(d,"direction",function(a){e.direction=n(a)}),s(d,"speed",function(a){e.speed=o(a)}),t(d,/(action)|(actionRef)$/,function(d){"action"==d.tagName.toLowerCase()?e.actions[e.actions.length]=b(a,d):"actionref"==d.tagName.toLowerCase()&&(e.actions[e.actions.length]=c(a,d))}),e.root=a,e}function e(a,b){var c=new bulletml.BulletRef(u(b,"label"));return t(b,/param$/,function(a){c.params[c.params.length]=v(a)}),c.root=a,c}function f(a,b){var c=new bulletml.Fire;if(u(b,"label",function(a){c.label=a}),s(b,"direction",function(a){c.direction=n(a)}),s(b,"speed",function(a){c.speed=o(a)}),s(b,"bullet",function(b){c.bullet=d(a,b)}),s(b,"bulletref",function(b){c.bullet=e(a,b)}),!c.bullet)throw new Error("fire has no bullet or bulletRef.");return c.root=a,c}function g(a,b){var c=new bulletml.FireRef(u(b,"label"));return t(b,/param$/,function(a){c.params[c.params.length]=v(a)}),c.root=a,c}function h(a,b){var c=new bulletml.ChangeDirection;return c.root=a,s(b,"direction",function(a){c.direction=n(a)}),s(b,"term",function(a){c.term=v(a)}),c}function i(a,b){var c=new bulletml.ChangeSpeed;return c.root=a,s(b,"speed",function(a){c.speed=o(a)}),s(b,"term",function(a){c.term=v(a)}),c}function j(a,b){var c=new bulletml.Accel;return c.root=a,s(b,"horizontal",function(a){c.horizontal=p(a)}),s(b,"vertical",function(a){c.vertical=q(a)}),s(b,"term",function(a){c.term=v(a)}),c}function k(a,b){var c=new bulletml.Wait;return c.root=a,c.value=v(b),c}function l(a){var b=new bulletml.Vanish;return b.root=a,b}function m(a,d){var e=new bulletml.Repeat;return s(d,"action",function(c){e.action=b(a,c)}),s(d,"actionRef",function(b){e.action=c(a,b)}),s(d,"times",function(a){e.times=v(a)}),e.root=a,e}function n(a){return r(new bulletml.Direction,a)}function o(a){return r(new bulletml.Speed,a)}function p(a){return r(new bulletml.Horizontal,a)}function q(a){return r(new bulletml.Vertical,a)}function r(a,b){return u(b,"type",function(b){a.type=b}),v(b,function(b){a.value=b}),a}function s(a,b,c,d){b=b.toLowerCase();for(var e=a.childNodes,f=0,g=e.length;g>f;f++)if(e[f].tagName&&e[f].tagName.toLowerCase()==b)return c&&c(e[f]),e[f];return d&&d(),null}function t(a,b,c){for(var d=a.childNodes,e=0,f=d.length;f>e;e++)d[e].tagName&&d[e].tagName.toLowerCase().match(b)&&c(d[e])}function u(a,b,c,d){var e=a.attributes,f=e[b];return f?(c&&c(f.value),f.value):(d&&d(),"")}function v(a,b){var c=a.textContent.trim();return void 0!==c?(b&&b(c),c):""}bulletml.buildXML=function(b){var c;if("string"==typeof b){var d=new DOMParser;c=a(d.parseFromString(b,"application/xml"))}else{if(!b.getElementsByTagName("bulletml"))throw new Error("cannot build "+b);c=a(b)}return c}}(),function(){bulletml.dsl=function(a){a=a||"";for(var b in bulletml.dsl)bulletml.dsl.hasOwnProperty(b)&&(bulletml.GLOBAL[a+b]=bulletml.dsl[b])},bulletml.dsl.action=function(a){if(arguments.length>0)for(var b=0,c=arguments.length;c>b;b++)arguments[b]instanceof Function&&(arguments[b]=arguments[b]());if(a instanceof Array)for(var b=0,c=a.length;c>b;b++)a[b]instanceof Function&&(a[b]=a[b]());var d=new bulletml.Action;if(a instanceof Array){if(a.some(function(a){return!(a instanceof bulletml.Command)}))throw new Error("argument type error.");d.commands=a}else for(var b=0,c=arguments.length;c>b;b++){if(!(arguments[b]instanceof bulletml.Command))throw new Error("argument type error.");d.commands[b]=arguments[b]}return d},bulletml.dsl.actionRef=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("label is required.");var e=new bulletml.ActionRef(a);if(b instanceof Array)e.params=b;else for(var c=1;c<arguments.length;c++)e.params.push(arguments[c]);return e},bulletml.dsl.bullet=function(){for(var a=0,b=arguments.length;b>a;a++)arguments[a]instanceof Function&&(arguments[a]=arguments[a]());for(var c=new bulletml.Bullet,a=0;a<arguments.length;a++)arguments[a]instanceof bulletml.Direction?c.direction=arguments[a]:arguments[a]instanceof bulletml.Speed?c.speed=arguments[a]:arguments[a]instanceof bulletml.Action?c.actions.push(arguments[a]):arguments[a]instanceof bulletml.ActionRef?c.actions.push(arguments[a]):arguments[a]instanceof Array?c.actions.push(bulletml.dsl.action(arguments[a])):arguments[a]instanceof Object?c.option=arguments[a]:"string"==typeof arguments[a]&&(c.label=arguments[a]);return c},bulletml.dsl.bulletRef=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("label is required.");var e=new bulletml.BulletRef(a);if(b instanceof Array)e.params=b;else for(var c=1;c<arguments.length;c++)e.params.push(arguments[c]);return e},bulletml.dsl.fire=function(){for(var a=0,b=arguments.length;b>a;a++)arguments[a]instanceof Function&&(arguments[a]=arguments[a]());for(var c=new bulletml.Fire,a=0;a<arguments.length;a++)arguments[a]instanceof bulletml.Direction?c.direction=arguments[a]:arguments[a]instanceof bulletml.Speed?c.speed=arguments[a]:arguments[a]instanceof bulletml.Bullet?c.bullet=arguments[a]:arguments[a]instanceof bulletml.BulletRef?c.bullet=arguments[a]:arguments[a]instanceof bulletml.FireOption?c.option=arguments[a]:arguments[a]instanceof bulletml.OffsetX?c.option.offsetX=arguments[a].value:arguments[a]instanceof bulletml.OffsetY?c.option.offsetY=arguments[a].value:arguments[a]instanceof bulletml.Autonomy&&(c.option.autonomy=arguments[a].value);if(void 0===c.bullet)throw new Error("bullet (or bulletRef) is required.");return c},bulletml.dsl.fireRef=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("label is required.");var e=new bulletml.FireRef(a);if(b instanceof Array)e.params=b;else for(var c=1;c<arguments.length;c++)e.params.push(arguments[c]);return e},bulletml.dsl.changeDirection=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("direction is required.");if(void 0===b)throw new Error("term is required.");var e=new bulletml.ChangeDirection;return e.direction=a instanceof bulletml.Direction?a:new bulletml.Direction(a),e.term=b,e},bulletml.dsl.changeSpeed=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("speed is required.");if(void 0===b)throw new Error("term is required.");var e=new bulletml.ChangeSpeed;return e.speed=a instanceof bulletml.Speed?a:new bulletml.Speed(a),e.term=b,e},bulletml.dsl.accel=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());for(var e=new bulletml.Accel,c=0;c<arguments.length;c++)arguments[c]instanceof bulletml.Horizontal?e.horizontal=a:arguments[c]instanceof bulletml.Vertical?e.vertical=b:e.term=arguments[c];if(void 0===e.horizontal&&void 0===e.vertical)throw new Error("horizontal or vertical is required.");if(void 0===e.term)throw new Error("term is required.");return e},bulletml.dsl.wait=function(a){for(var b=0,c=arguments.length;c>b;b++)arguments[b]instanceof Function&&(arguments[b]=arguments[b]());if(void 0===a)throw new Error("value is required.");return new bulletml.Wait(a)},bulletml.dsl.vanish=function(){return new bulletml.Vanish},bulletml.dsl.repeat=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("times is required.");if(void 0===b)throw new Error("action is required.");var e=new bulletml.Repeat;if(e.times=a,b instanceof bulletml.Action||b instanceof bulletml.ActionRef)e.action=b;else if(b instanceof Array)e.action=bulletml.dsl.action(b);else{for(var f=[],c=1;c<arguments.length;c++)f.push(arguments[c]);e.action=bulletml.dsl.action(f)}return e},bulletml.dsl.bindVar=function(a,b){return new bulletml.Bind(a,b)},bulletml.dsl.notify=function(a,b){return new bulletml.Notify(a,b)},bulletml.dsl.direction=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("value is required.");var e=new bulletml.Direction(a);return void 0!==b&&(e.type=b),e},bulletml.dsl.speed=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("value is required.");var e=new bulletml.Speed(a);return b&&(e.type=b),e},bulletml.dsl.horizontal=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("value is required.");var e=new bulletml.Horizontal(a);return b&&(e.type=b),e},bulletml.dsl.vertical=function(a,b){for(var c=0,d=arguments.length;d>c;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());if(void 0===a)throw new Error("value is required.");var e=new bulletml.Vertical(a);return b&&(e.type=b),e},bulletml.dsl.fireOption=function(a){return new bulletml.FireOption(a)},bulletml.dsl.offsetX=function(a){return new bulletml.OffsetX(a)},bulletml.dsl.offsetY=function(a){return new bulletml.OffsetY(a)},bulletml.dsl.autonomy=function(a){return new bulletml.Autonomy(a)}}(),function(){bulletml.json=bulletml.json||{}}(),function(){bulletml.runner=bulletml.runner||{},bulletml.runner.RunnerFactory=function(a){this.root=a},bulletml.runner.RunnerFactory.prototype.create=function(a){for(var b in bulletml.runner.DEFAULT_CONFIG)bulletml.runner.DEFAULT_CONFIG.hasOwnProperty(b)&&void 0===a[b]&&(a[b]=bulletml.runner.DEFAULT_CONFIG[b]);var c=this.root.getTopActionLabels();if(1===c.length)return new bulletml.runner.SubRunner(a,this.root.getWalker(c[0]));for(var d=new bulletml.runner.ParentRunner,e=0,f=c.length;f>e;e++)d.addSubRunner(new bulletml.runner.SubRunner(a,this.root.getWalker(c[e])));return d},bulletml.Root.prototype.createRunner=function(a,b){var c=new bulletml.runner.RunnerFactory(this).create(a);return b&&b(c),c},bulletml.runner.DEFAULT_CONFIG={rank:0,target:null,createNewBullet:function(){},speedRate:1},bulletml.runner.Runner=function(){this.x=0,this.y=0},bulletml.runner.Runner.prototype={constructor:bulletml.runner.Runner,update:function(){},onVanish:function(){},onNotify:function(){}},bulletml.runner.ParentRunner=function(){bulletml.runner.Runner.call(this),this.completed=!1,this.completedChildCount=0,this.subRunners=[]},bulletml.runner.ParentRunner.prototype=Object.create(bulletml.runner.Runner.prototype),bulletml.runner.ParentRunner.prototype.addSubRunner=function(a){a.parentRunner=this,this.subRunners.push(a)},bulletml.runner.ParentRunner.prototype.update=function(){for(var a=this.subRunners.length;a--;)this.subRunners[a].x=this.x,this.subRunners[a].y=this.y,this.subRunners[a].update();this.completedChildCount===this.subRunners.length&&(this.completed=!0)},bulletml.runner.SimpleSubRunner=function(a){bulletml.runner.Runner.call(this),this.config=a,this.direction=0,this.speed=0,this.deltaX=null,this.deltaY=null},bulletml.runner.SimpleSubRunner.prototype=Object.create(bulletml.runner.Runner.prototype),bulletml.runner.SimpleSubRunner.prototype.update=function(){null===this.deltaX&&(this.deltaX=Math.cos(this.direction)*this.speed),null===this.deltaY&&(this.deltaY=Math.sin(this.direction)*this.speed),this.x+=this.deltaX*this.config.speedRate,this.y+=this.deltaY*this.config.speedRate},bulletml.runner.SubRunner=function(a,b){bulletml.runner.SimpleSubRunner.call(this,a),this.walker=b,this.waitTo=-1,this.lastDirection=0,this.lastSpeed=0,this.speedH=0,this.speedV=0,this.dirIncr=0,this.dirFin=0,this.chDirEnd=-1,this.spdIncr=0,this.spdFin=0,this.chSpdEnd=-1,this.aclIncrH=0,this.aclFinH=0,this.aclIncrV=0,this.aclFinV=0,this.aclEnd=-1,this.age=-1,this.stop=!1,this.parentRunner=null},bulletml.runner.SubRunner.prototype=Object.create(bulletml.runner.SimpleSubRunner.prototype),bulletml.runner.SubRunner.prototype.update=function(){if(!this.stop){this.age+=1;var a=this.config;if(this.age<this.chDirEnd?this.direction+=this.dirIncr:this.age===this.chDirEnd&&(this.direction=this.dirFin),this.age<this.chSpdEnd?this.speed+=this.spdIncr:this.age===this.chSpdEnd&&(this.speed=this.spdFin),this.age<this.aclEnd?(this.speedH+=this.aclIncrH,this.speedV+=this.aclIncrV):this.age===this.aclEnd&&(this.speedH=this.aclFinH,this.speedV=this.aclFinV),this.x+=Math.cos(this.direction)*this.speed*a.speedRate,this.y+=Math.sin(this.direction)*this.speed*a.speedRate,this.x+=this.speedH*a.speedRate,this.y+=this.speedV*a.speedRate,!(this.age<this.waitTo||this.completed)){for(var b;b=this.walker.next();)switch(b.commandName){case"fire":this.fire(b);break;case"wait":return void(this.waitTo=this.age+b.value);case"changeDirection":this.changeDirection(b);break;case"changeSpeed":this.changeSpeed(b);break;case"accel":
this.accel(b);break;case"vanish":this.onVanish();break;case"notify":this.notify(b)}this.completed=!0,null!==this.parentRunner&&(this.parentRunner.completedChildCount+=1)}}},bulletml.runner.SubRunner.prototype.fire=function(a){var c;c=0===a.bullet.actions.length?new bulletml.runner.SimpleSubRunner(this.config):new bulletml.runner.SubRunner(this.config,a.bullet.getWalker());var d={x:this.x+a.option.offsetX,y:this.y+a.option.offsetY},e=a.direction||a.bullet.direction,f=e.value*Math.PI/180;switch(e.type){case"aim":var g=this.config.target;g?(g instanceof Function&&(g=g()),c.direction=a.option.autonomy?b(d,g)+f:b(this,g)+f):c.direction=f-Math.PI/2;break;case"absolute":c.direction=f-Math.PI/2;break;case"relative":c.direction=this.direction+f;break;case"sequence":default:c.direction=this.lastDirection+f}this.lastDirection=c.direction;var h=a.speed||a.bullet.speed,i=h.value;switch(h.type){case"relative":c.speed=this.speed+i;break;case"sequence":c.speed=this.lastSpeed+i;break;case"absolute":default:c.speed=i}this.lastSpeed=c.speed,c.x=d.x,c.y=d.y;var j={};for(var k in a.bullet.option)j[k]=a.bullet.option[k];j.label=a.bullet.label,this.config.createNewBullet(c,j)},bulletml.runner.SubRunner.prototype.changeDirection=function(c){var d=c.direction.value*Math.PI/180,e=c.term;switch(c.direction.type){case"aim":var f=this.config.target;f instanceof Function&&(f=f()),this.dirFin=b(this,f)+d,this.dirIncr=a(this.dirFin-this.direction)/e;break;case"absolute":this.dirFin=d-Math.PI/2,this.dirIncr=a(this.dirFin-this.direction)/e;break;case"relative":this.dirFin=this.direction+d,this.dirIncr=a(this.dirFin-this.direction)/e;break;case"sequence":this.dirIncr=d,this.dirFin=this.direction+this.dirIncr*(e-1)}this.chDirEnd=this.age+e},bulletml.runner.SubRunner.prototype.changeSpeed=function(a){var b=a.speed.value,c=a.term;switch(a.speed.type){case"absolute":this.spdFin=b,this.spdIncr=(this.spdFin-this.speed)/c;break;case"relative":this.spdFin=b+this.speed,this.spdIncr=(this.spdFin-this.speed)/c;break;case"sequence":this.spdIncr=b,this.spdFin=this.speed+this.spdIncr*c}this.chSpdEnd=this.age+c},bulletml.runner.SubRunner.prototype.accel=function(a){var b=a.term;if(this.aclEnd=this.age+b,a.horizontal){var c=a.horizontal.value;switch(a.horizontal.type){case"absolute":case"sequence":this.aclIncrH=(c-this.speedH)/b,this.aclFinH=c;break;case"relative":this.aclIncrH=c,this.aclFinH=(c-this.speedH)*b}}else this.aclIncrH=0,this.aclFinH=this.speedH;if(a.vertical){var d=a.vertical.value;switch(a.vertical.type){case"absolute":case"sequence":this.aclIncrV=(d-this.speedV)/b,this.aclFinV=d;break;case"relative":this.aclIncrV=d,this.aclFinV=(d-this.speedV)*b}}else this.aclIncrV=0,this.aclFinV=this.speedV},bulletml.runner.SubRunner.prototype.notify=function(a){this.onNotify(a.eventName,a.params)};var a=function(a){for(;a<=-Math.PI;)a+=2*Math.PI;for(;Math.PI<a;)a-=2*Math.PI;return a},b=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}}(),function(){bulletml.output=bulletml.output||{},bulletml.output.json=bulletml.output.json||{},bulletml.Root.prototype.toJSON=function(){return{className:"Root",actions:this.actions,bullets:this.bullets,fires:this.fires}},bulletml.Bullet.prototype.toJSON=function(){return{className:"Bullet",label:this.label,direction:this.direction,speed:this.speed,actions:this.actions,option:this.options}},bulletml.BulletRef.prototype.toJSON=function(){return{className:"BulletRef",label:this.label,params:this.params}},bulletml.Action.prototype.toJSON=function(){return{className:"Action",label:this.label,commands:this.commands}},bulletml.ActionRef.prototype.toJSON=function(){return{className:"ActionRef",label:this.label,params:this.params}},bulletml.Fire.prototype.toJSON=function(){return{className:"Fire",label:this.label,direction:this.direction,speed:this.speed,bullet:this.bullet,option:this.option}},bulletml.FireRef.prototype.toJSON=function(){return{className:"FireRef",label:this.label,params:this.params}},bulletml.ChangeDirection.prototype.toJSON=function(){return{className:"ChangeDirection",direction:this.direction,term:this.term}},bulletml.ChangeSpeed.prototype.toJSON=function(){return{className:"ChangeSpeed",speed:this.speed,term:this.term}},bulletml.Accel.prototype.toJSON=function(){return{className:"Accel",horizontal:this.horizontal,vertical:this.vertical,term:this.term}},bulletml.Wait.prototype.toJSON=function(){return{className:"Wait",value:this.value}},bulletml.Vanish.prototype.toJSON=function(){return{className:"Vanish"}},bulletml.Repeat.prototype.toJSON=function(){return{className:"Repeat",times:this.times,action:this.action}},bulletml.Bind.prototype.toJSON=function(){return{className:"Bind",variable:this.variable,expression:this.expression}},bulletml.Notify.prototype.toJSON=function(){return{className:"Notify",eventName:this.eventName,params:this.params}},bulletml.Direction.prototype.toJSON=function(){return{className:"Direction",type:this.type,value:this.value}},bulletml.Speed.prototype.toJSON=function(){return{className:"Speed",type:this.type,value:this.value}},bulletml.Horizontal.prototype.toJSON=function(){return{className:"Horizontal",type:this.type,value:this.value}},bulletml.Vertical.prototype.toJSON=function(){return{className:"Vertical",type:this.type,value:this.value}},bulletml.FireOption.prototype.toJSON=function(){return{className:"FireOption",offsetX:this.offsetX,offsetY:this.offsetY,autonomy:this.autonomy}},bulletml.OffsetX.prototype.toJSON=function(){return{className:"OffsetX",value:this.value}},bulletml.OffsetY.prototype.toJSON=function(){return{className:"OffsetY",value:this.value}},bulletml.Autonomy.prototype.toJSON=function(){return{className:"Autonomy",value:this.value}}}(),tm.define("Application",{superClass:"tm.display.CanvasApp",init:function(){this.superInit("#main"),this.renderer=LayeredCanvasRenderer(this.canvas);var a=document.querySelector("#hmd");this.touch=tm.input.Touch(a,0),this.mouse=tm.input.Mouse(a),this.pointing=tm.isMobile?this.touch:this.mouse,a.addEventListener("touchstart",function(){this.pointing=this.touch}.bind(this)),a.addEventListener("mousedown",function(){this.pointing=this.mouse}.bind(this)),this.fps=60,this.background="transparent",this.resize(SCREEN_WIDTH,SCREEN_HEIGHT).fitWindow()}}),tm.define("LayeredCanvasRenderer",{superClass:"tm.display.CanvasRenderer",init:function(a){this.superInit(a)},renderObject:function(a){a instanceof CanvasLayer?a.render():tm.display.CanvasRenderer.prototype.renderObject.call(this,a)}}),tm.define("CanvasLayer",{superClass:"tm.display.CanvasElement",init:function(a){this.superInit(),this.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),this.setOrigin(0,0),this.canvas=tm.graphics.Canvas(a),this.domElement=tm.dom.Element(a),this.renderer=tm.display.CanvasRenderer(this.canvas),this.canvas.resize(SCREEN_WIDTH,SCREEN_HEIGHT).fitWindow(),this.renderInterval=2,this.isRenderFrame=!0},clear:function(){return this.canvas.clear(),this},update:function(a){this.isRenderFrame=a.frame%this.renderInterval===0},render:function(){this.isRenderFrame&&(this.canvas.clear(),this.renderer.render(this))}}),CanvasLayer.prototype.accessor.visible={get:function(){return this.domElement.visible},set:function(a){this.domElement.visible=a}};var BOARD_ID=null,APP_URL="https://itunes.apple.com/",TITLE_TWEET="『よけろ！弾幕さん』お手軽弾幕シューティングゲーム",RESULT_URL=TITLE_TWEET+" スコア: {score}",TARGET="release",FONT_CODE={play:"0xf04b",home:"0xf015",comment:"0xf075",apple:"0xf179",android:"0xf17b",trophy:"0xf091",gamepad:"0xf11b",shareAlt:"0xf1e0",buysellads:"0xf20d",pause:"0xf04c",arrowRight:"0xf061",longArrowRight:"0xf178",handORight:"0xf0a4",angleRight:"0xf106"},ASSETS={unifont:"assets/unip.ttf",bullet:"assets/bullets.png",bullet_erase:"assets/bullets_erase.png","sound/bgm":"assets/nc91440.mp3","sound/miss":"assets/sei_ge_garasu_kudake02.mp3","sound/exp1":"assets/sei_ge_wareru01.mp3","sound/exp2":"assets/sei_ge_wareru02.mp3","sound/exp3":"assets/sei_ge_wareru03.mp3","sound/extend":"assets/extend.mp3","sound/score":"assets/sei_ge_coin_otosu02.mp3","sound/hit":"assets/sei_ge_garasu_hibi02.mp3","sound/ok":"assets/se_maoudamashii_system18.mp3","sound/cancel":"assets/se_maoudamashii_system45.mp3"},SCREEN_WIDTH=640,SCREEN_HEIGHT=960,W=SCREEN_WIDTH,H=1.2*W,PLAYER_SPEED=2,BIT_COUNT=4,BIT_DISTANCE=6,BIT_FIRST_DISTANCE=4,SHOT_SPEED=40,BULLET_POOL_SIZE=256,BULLET_BOUNDING_RADIUS=4,MT_SEED=5,ENEMY_SMALL_HP=2,ENEMY_MIDDLE_HP=10,ENEMY_LARGE_HP=100,EXTEND_SCORE=2e5,ENEMY_INTERVAL_DECR=.5,isNative=function(){return window.cordovaFlag===!0},showAd=function(){window.cordovaFlag&&window.AdMob&&AdMob.prepareInterstitial({adId:admobid.interstitial,autoShow:!0})},clickAdCallback=function(){alert("onInterstitialLeaveApp")};document.addEventListener("onInterstitialLeaveApp",function(){clickAdCallback&&clickAdCallback()}),document.addEventListener("onInterstitialDismiss",function(){});var UserData={init:function(a){var b={life:5,bestScore:0},c=this.get();a?c.$extend(b):c.$safe(b),this.set(c)},get:function(){var a=location.pathname.toCRC32(),b=localStorage.getItem(a);return b?JSON.parse(b):{}},set:function(a){var b=location.pathname.toCRC32(),c=JSON.stringify(a);return localStorage.setItem(b,c),this},hasLife:function(){var a=this.get();return a.life>=1}};!function(){UserData.init()}();var Danmaku={};Danmaku.param={speedRate:1},Danmaku.small=[],Danmaku.middle=[],Danmaku.large=[],function(){var a=bulletml.dsl.action,b=bulletml.dsl.actionRef,c=bulletml.dsl.bullet,d=(bulletml.dsl.bulletRef,bulletml.dsl.fire),e=(bulletml.dsl.fireRef,bulletml.dsl.changeDirection,bulletml.dsl.changeSpeed,bulletml.dsl.accel,bulletml.dsl.wait),f=bulletml.dsl.vanish,g=bulletml.dsl.repeat,h=(bulletml.dsl.bindVar,bulletml.dsl.notify,bulletml.dsl.direction),i=bulletml.dsl.speed,j=(bulletml.dsl.horizontal,bulletml.dsl.vertical,bulletml.dsl.fireOption,bulletml.dsl.offsetX,bulletml.dsl.offsetY,bulletml.dsl.autonomy,function(a){return c(a,{type:0})}),k=function(a){return c(a,{type:5})},l=function(a){return c(a,{type:6})},m=function(a){return c(a,{type:8})};Danmaku.small.push(new bulletml.Root({top:a([e(20),d(i(7),j)])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),g(5,[d(i(7),j),e(20)])])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),d(h(-30),i(7),j),d(h(0),i(7),j),d(h(30),i(7),j)])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),g(10,[d(h(-30),i(7),j),d(h(0),i(7),j),d(h(30),i(7),j),e(20)])])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),d(i(4),m),g(5,[d(h(-30),i(.4,"sequence"),j),d(h(0),i(0,"sequence"),j),d(h(30),i(0,"sequence"),j)])])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),d(i(4),m),g(5,[d(h(-45),i(10),m(b("bit",45,"$loop.index"))),d(h(45),i(10),m(b("bit",-45,"$loop.index"))),d(h(0),i(10),m(b("bit",0,"$loop.index")))])]),bit:a([e(1),d(h("$1","relative"),i("6.5 + $2 * 0.2"),k),f()])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),d(h(-4),i(6),k),g(4,[d(h(2,"sequence"),i(6),k)])])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),g(5,[d(i(3),l),e(50)])])})),Danmaku.small.push(new bulletml.Root({top:a([e(20),d(i(6),m),g(5,[d(h(180,"absolute"),i(.2,"sequence"),k)])])}))}(),function(){var a=bulletml.dsl.action,b=bulletml.dsl.actionRef,c=bulletml.dsl.bullet,d=(bulletml.dsl.bulletRef,bulletml.dsl.fire),e=(bulletml.dsl.fireRef,bulletml.dsl.changeDirection,bulletml.dsl.changeSpeed),f=(bulletml.dsl.accel,bulletml.dsl.wait),g=bulletml.dsl.vanish,h=bulletml.dsl.repeat,i=(bulletml.dsl.bindVar,bulletml.dsl.notify,bulletml.dsl.direction),j=bulletml.dsl.speed,k=(bulletml.dsl.horizontal,bulletml.dsl.vertical,bulletml.dsl.fireOption,bulletml.dsl.offsetX,bulletml.dsl.offsetY,bulletml.dsl.autonomy,function(a){return c(a,{type:0})}),l=function(a){return c(a,{type:1})},m=function(a){return c(a,{type:2})},n=function(a){return c(a,{type:3})},o=function(a){return c(a,{type:4})},p=function(a){return c(a,{type:5})},q=function(a){return c(a,{type:6})},r=function(a){return c(a,{type:7})},s=function(a){return c(a,{type:8})};Danmaku.middle.push(new bulletml.Root({top1:a([h(1/0,[f(50),h(4,[d(i(270,"absolute"),j(30),s(b("bit"))),d(i(90,"absolute"),j(30),s(b("bit"))),f(5)])])]),bit:a([f(1),d(i(176,"absolute"),j(4),o),d(i(184,"absolute"),j(4),o),g()]),top2:a([h(1/0,[f(90),d(j(3),s),h(6,[d(i(0,"sequence"),j(.4,"sequence"),l)])])])})),Danmaku.middle.push(new bulletml.Root({top:a([f(100),h(1/0,[d(s),h(10,[d(i(0,"sequence"),j(12),n),f(3)]),f(100)])])})),Danmaku.middle.push(new bulletml.Root({top:a([h(1/0,[f(100),d(j(8),s),h(10,[d(i(-40),j(.6,"sequence"),s),h(3,[d(i(20,"sequence"),j(0,"sequence"),k)]),f(3)])])])})),Danmaku.middle.push(new bulletml.Root({top:a([h(1/0,[f(60),h(20,[d(i(10,"sequence"),s),h(4,[d(i(90,"sequence"),j(20),s(b("bit")))]),f(20)])])]),bit:a([f(1),d(j(4),s),h(3,[d(i(90,"relative"),j(.8,"sequence"),q)]),g()])})),Danmaku.middle.push(new bulletml.Root({top:a([h(1/0,[f(60),h(20,[d(i(-10,"sequence"),s),h(4,[d(i(90,"sequence"),j(20),s(b("bit")))]),f(20)])])]),bit:a([f(1),d(j(4),s),h(3,[d(i(90,"relative"),j(.8,"sequence"),r)]),g()])})),Danmaku.middle.push(new bulletml.Root({top:a([h(1/0,[f(60),h(18,[d(i(20,"sequence"),j(2),p(b("seed")))])])]),seed:a([f(20),e(j(0),20),f(20),d(j(7),o),g()])})),Danmaku.middle.push(new bulletml.Root({top:a([h(1/0,[f(120),h(10,[d(i(6,"sequence"),s),h(8,[d(i(45,"sequence"),j(20),s(b("bit")))]),f(7)])])]),bit:a([f(1),d(i(-90,"relative"),j(5),r),g()])})),Danmaku.middle.push(new bulletml.Root({top0:a([h(1/0,[f(80),d(i(-45),j(5),m),h(8,[d(i(90/8,"sequence"),j(5),m)])])]),top1:a([h(1/0,[f(100),d(i(-25),j(6),m),h(8,[d(i(6.25,"sequence"),j(6),m)])])])})),Danmaku.middle.push(new bulletml.Root({top0:a([h(1/0,[h(3,[f(80),d(i(-90,"absolute"),j(40),s(b("bit"))),d(i(90,"absolute"),j(40),s(b("bit"))),f(20),d(i(-90,"absolute"),j(40),s(b("bit2"))),d(i(90,"absolute"),j(40),s(b("bit2"))),f(20)]),f(150)])]),bit:a([f(1),d(i(-45),j(5),n),h(4,[d(i(22.5,"sequence"),j(5),n)]),g()]),bit2:a([f(1),d(i(-45),j(6),n),h(3,[d(i(30,"sequence"),j(6),n)]),g()])}))}(),function(){var a=bulletml.dsl.action,b=bulletml.dsl.actionRef,c=bulletml.dsl.bullet,d=(bulletml.dsl.bulletRef,bulletml.dsl.fire),e=(bulletml.dsl.fireRef,bulletml.dsl.changeDirection,bulletml.dsl.changeSpeed,bulletml.dsl.accel,bulletml.dsl.wait),f=bulletml.dsl.vanish,g=bulletml.dsl.repeat,h=bulletml.dsl.bindVar,i=(bulletml.dsl.notify,bulletml.dsl.direction),j=bulletml.dsl.speed,k=(bulletml.dsl.horizontal,bulletml.dsl.vertical,bulletml.dsl.fireOption,bulletml.dsl.offsetX,bulletml.dsl.offsetY,bulletml.dsl.autonomy,function(a){return c(a,{type:0})}),l=function(a){return c(a,{type:2})},m=function(a){return c(a,{type:3})},n=function(a){return c(a,{type:4})},o=function(a){return c(a,{type:5})},p=function(a){return c(a,{type:6})},q=function(a){return c(a,{type:7})},r=function(a){return c(a,{type:8})};Danmaku.large.push(new bulletml.Root({top:a([g(1/0,[e(80),d(i(0),r),g(10,[h("way","$loop.index + 2"),h("angle","$way * 13"),d(i("$angle * -0.5","sequence"),j(6),p),g("$way - 1",[d(i("$angle / ($way - 1)","sequence"),j(6),p)]),d(i("$angle * -0.5","sequence"),r),e(7)])])])})),Danmaku.large.push(new bulletml.Root({top0:a([g(1/0,[e(100),g(60,[d(i(9,"sequence"),r),d(i(90,"sequence"),r(b("bit"))),d(i(90,"sequence"),r(b("bit"))),d(i(90,"sequence"),r(b("bit"))),d(i(90,"sequence"),r(b("bit"))),e(10)])])]),bit:a([e(1),d(i(-17,"relative"),j(6),p),g(2,[d(i(17,"sequence"),j(6),p)]),f()]),top1:a([g(1/0,[e(180),d(j(8),m),g(39,[d(i(9,"sequence"),j(8),m)])])])})),Danmaku.large.push(new bulletml.Root({top0:a([g(1/0,[e(80),g(4,[e(20),d(j(5),l),g(9,[d(i(36,"sequence"),j(5),l)]),e(5),g(3,[d(i(5,"sequence"),j(5),l),g(9,[d(i(36,"sequence"),j(5),l)]),e(5)]),e(20),d(j(5),l),g(9,[d(i(36,"sequence"),j(5),l)]),e(5),g(3,[d(i(-5,"sequence"),j(5),l),g(9,[d(i(36,"sequence"),j(5),l)]),e(5)])])])])})),Danmaku.large.push(new bulletml.Root({top0:a([g(1/0,[e(80),g("5 + $loop.index",[d(i(90,"absolute"),j(30),r(b("bit"))),d(i(135,"absolute"),j(15),r(b("bit"))),d(i(180,"absolute"),j(0),r(b("bit"))),d(i(225,"absolute"),j(15),r(b("bit"))),d(i(270,"absolute"),j(30),r(b("bit"))),e(8)])])]),bit:a([e(1),d(i(-55),j(5),p),g(4,[d(i(27.5,"sequence"),j(5),p)]),f()])})),Danmaku.large.push(new bulletml.Root({top0:a([e(100),g(1/0,[d(i(96,"sequence"),j(5),o),d(i(90,"sequence"),j(5),o),d(i(90,"sequence"),j(5),o),d(i(90,"sequence"),j(5),o),e(5)])]),top1:a([e(130),g(1/0,[d(i(85,"sequence"),j(5),n),d(i(90,"sequence"),j(5),n),d(i(90,"sequence"),j(5),n),d(i(90,"sequence"),j(5),n),e(5)])]),top2:a([e(160),g(1/0,[d(j(4),l),g(30,[d(i(360/29,"sequence"),j(4),l)]),e(40)])])})),Danmaku.large.push(new bulletml.Root({top0:a([e(100),g(1/0,[g(200,[d(i("Math.sin($loop.index * 0.2) * 60"),j(6.5),m),e(3)]),e(50)])]),top1:a([e(100),g(1/0,[g(200,[d(i("Math.sin($loop.index * 0.3) * -40"),j(6.5),l),e(3)]),e(50)])]),top2:a([e(100),g(1/0,[g(200,[d(i("Math.sin($loop.index * 0.1) * 80"),j(6.5),k),e(3)]),e(50)])])})),Danmaku.large.push(new bulletml.Root({top0:a([e(100),d(i(-22.5),j(4),q),g(1/0,[g(7,[d(i(90+45/7,"sequence"),j(4),q),d(i(90,"sequence"),j(4),q),d(i(90,"sequence"),j(4),q),d(i(90,"sequence"),j(4),q)]),e(40)])]),top1:a([e(100),g(1/0,[d(j(6),r),g(7,[d(i(-25,"sequence"),j(.3,"sequence"),l),d(i(25,"sequence"),j(0,"sequence"),l),d(i(25,"sequence"),j(0,"sequence"),l),d(i(-25,"sequence"),j(0,"sequence"),r)]),e(70)])])}))}(),MersenneTwister._mulUint32=function(a,b){var c=a>>>16,d=65535&a,e=b>>>16,f=65535&b;return(c*f+d*e<<16)+d*f>>>0},MersenneTwister._toNumber=function(a){return"number"!=typeof a||isNaN(a)?0:Math.ceil(a)},MersenneTwister.prototype.setSeed=function(a){var b=this._mt;if("number"==typeof a){b[0]=a>>>0;for(var c=1;c<b.length;c++){var d=b[c-1]^b[c-1]>>>30;b[c]=MersenneTwister._mulUint32(1812433253,d)+c}this._index=b.length}else{if(!(a instanceof Array))throw new TypeError("MersenneTwister: illegal seed.");var c=1,e=0;this.setSeed(19650218);for(var f=Math.max(b.length,a.length);f>0;f--){var d=b[c-1]^b[c-1]>>>30;d=MersenneTwister._mulUint32(d,1664525),b[c]=(b[c]^d)+(a[e]>>>0)+e,++c>=b.length&&(b[0]=b[b.length-1],c=1),++e>=a.length&&(e=0)}for(var f=b.length-1;f>0;f--){var d=b[c-1]^b[c-1]>>>30;d=MersenneTwister._mulUint32(d,1566083941),b[c]=(b[c]^d)-c,++c>=b.length&&(b[0]=b[b.length-1],c=1)}b[0]=2147483648}},MersenneTwister.prototype._nextInt=function(){var a,b=this._mt;if(this._index>=b.length){var c=0,d=b.length,e=397;do a=2147483648&b[c]|2147483647&b[c+1],b[c]=b[c+e]^a>>>1^(1&a?2567483615:0);while(++c<d-e);do a=2147483648&b[c]|2147483647&b[c+1],b[c]=b[c+e-d]^a>>>1^(1&a?2567483615:0);while(++c<d-1);a=2147483648&b[d-1]|2147483647&b[0],b[d-1]=b[e-1]^a>>>1^(1&a?2567483615:0),this._index=0}return a=b[this._index++],a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^=a>>>18,a>>>0},MersenneTwister.prototype.nextInt=function(){var a,b;switch(arguments.length){case 0:return this._nextInt();case 1:a=0,b=MersenneTwister._toNumber(arguments[0]);break;default:a=MersenneTwister._toNumber(arguments[0]),b=MersenneTwister._toNumber(arguments[1])-a}if(!(b>0&&4294967296>b))return this._nextInt()+a;if((b&~b+1)==b)return(b-1&this._nextInt())+a;var c;do c=this._nextInt();while(b>4294967296-(c-(c%=b)));return c+a},MersenneTwister.prototype.next=function(){var a=this._nextInt()>>>5,b=this._nextInt()>>>6;return(67108864*a+b)/9007199254740992},tm.define("Background",{superClass:"tm.display.CanvasElement",init:function(){this.superInit(),this.fromJSON({children:{bg:{type:"tm.display.CanvasElement"},fg:{type:"tm.display.CanvasElement"}}}),this.clipping=!0,this.setSize(W,H),this.setOrigin(0,0),this.age=0,this.stars=Array.range(20).map(function(){var a=Math.rand(50,150),b=Math.rand(0,360),c=Math.rand(5,20),d=Math.randf(-5,5);return tm.display.PolygonShape({sides:Math.rand(5,9),width:a,height:a,fillStyle:"hsla({0}, 90%,  5%, 0.2)".format(b),strokeStyle:"hsla({0}, 90%, 80%, 0.2)".format(b)}).setBlendMode("lighter").setPosition(Math.rand(0,W),Math.rand(H*-.5,1.5*H)).on("enterframe",function(){this.rotation+=d,this.y+=c,this.y>1.5*H&&(this.x=Math.rand(0,W),this.y=H*-.5)}).addChildTo(this.bg)}.bind(this))},update:function(){this.color=Math.floor(this.age/30%360),this.age+=1},draw:function(a){a.setFillStyle(tm.graphics.RadialGradient(.5*W,.05*H,0,.5*W,.05*H,H).addColorStopList([{offset:0,color:"hsla({0}, 30%, 10%, 1.0)".format(this.color||0)},{offset:1,color:"hsla({0}, 30%, 10%, 1.0)".format((this.color||0)-50)}]).toStyle()).fillRect(0,0,W,H)}}),tm.define("CircleButton",{superClass:"tm.display.CanvasElement",init:function(a){this.superInit(),a=a||{},a.$safe({size:150,text:"A",fontFamily:"FontAwesome",fontColor:"white",bgColor:"hsl(180, 60%, 50%)",strokeColor:"transparent",lineWidth:4}),this.fromJSON({children:{bg:{type:"tm.display.Shape",init:{width:a.size,height:a.size}},label:{type:"tm.display.Label",init:a.text,fillStyle:a.fontColor,fontFamily:a.fontFamily,fontSize:a.size/2}}}),this.setInteractive(!0,"circle"),this.on("pointingend",function(){this.flare("push")}),this.fillFlag=a.fillFlag,this.lineWidth=a.lineWidth,this.strokeColor=a.strokeColor,this.bgColor=a.bgColor,this.radius=a.size/2,this._render()},_render:function(){var a=this.bg.canvas;a.setTransformCenter(),a.fillStyle=this.bgColor,a.fillCircle(0,0,this.radius),a.lineWidth=this.lineWidth,a.strokeStyle=this.strokeColor,a.strokeCircle(0,0,this.radius-this.lineWidth/2-1)},fill:function(){this.parent.children.each(function(a){a.tweener.clear().fadeOut(200)});this.bg.canvas;this.bg.width=SCREEN_WIDTH,this.bg.height=SCREEN_HEIGHT,this._render(),this.setInteractive(!1),this.label.tweener.clear().fadeOut(200),this.tweener.clear().wait(300).to({x:SCREEN_CENTER_X,y:SCREEN_CENTER_Y},300,"easeOutQuint").call(function(){tm.asset.Manager.get("sounds/warp").clone().play()}).to({radius:600},500,"easeOutQuint").call(function(){this.flare("filled")},this),this.update=function(){this._render()}},blink:function(){return this.tweener.clear().set({alpha:0}).wait(100).set({alpha:1}).wait(100).set({alpha:0}).wait(100).set({alpha:1}).wait(100).set({alpha:0}).wait(100).set({alpha:1}).wait(100).set({alpha:0}).wait(100).set({alpha:1}).wait(100),this}}),tm.define("RankingButton",{superClass:"CircleButton",init:function(a){this.superInit({text:String.fromCharCode(FONT_CODE.trophy),bgColor:"hsl(200, 100%, 50%)"}.$extend(a)),this.on("push",function(){if(window.gamecenter){var a={leaderboardId:BOARD_ID};gamecenter.showLeaderboard(null,null,a)}else console.log("show gamecenter")})}}),tm.define("AdButton",{superClass:"CircleButton",init:function(a){this.superInit({text:String.fromCharCode(FONT_CODE.buysellads),bgColor:"hsl(0, 100%, 64%)"}.$extend(a)),this.on("push",this._showAd)},_showAd:function(){clickAdCallback=function(){this.flare("aded")}.bind(this),showAd()}}),tm.define("ShareButton",{superClass:"CircleButton",init:function(a){this.superInit({text:String.fromCharCode(FONT_CODE.comment),bgColor:"hsl(240, 100%, 64%)"}.$extend(a)),this.message=a.message,this.url=a.url||"http://twitter.com/daishi_hmr",this.on("push",this._share)},_share:function(){var a=this.message;if(isNative()){var b={text:a+" #弾幕さん #tmlib",activityTypes:["PostToFacebook"],activityTypes:["Message","Mail","PostToFacebook","PostToTwitter"],url:this.url};window.socialmessage.send(b),this.flare("shared")}else var c=tm.social.Twitter.createURL({type:"tweet",text:a,hashtags:"弾幕さん,tmlib",url:this.url}),d=window.open(c,"share window","width=400, height=300"),e=setInterval(function(){d.closed&&(this.flare("shared"),clearInterval(e))}.bind(this),100)}}),tm.define("PauseButton",{superClass:"CircleButton",init:function(a){this.superInit({text:String.fromCharCode(FONT_CODE.pause),bgColor:"hsl(0, 0%, 50%)"}.$extend(a))}}),tm.define("PlayButton",{superClass:"CircleButton",init:function(a){this.superInit({text:String.fromCharCode(FONT_CODE.play)}.$extend(a))}}),tm.define("HomeButton",{superClass:"CircleButton",init:function(a){this.superInit({text:String.fromCharCode(FONT_CODE.home),bgColor:"hsl(60, 90%, 40%)"}.$extend(a))}}),tm.define("Life",{superClass:"tm.display.CanvasElement",init:function(){this.superInit();var a=UserData.get();this.backGroup=tm.display.CanvasElement().addChildTo(this),this.frontGroup=tm.display.CanvasElement().addChildTo(this),5..times(function(a){var b=tm.display.StarShape({width:40,height:40,fillStyle:"gray"}).addChildTo(this.backGroup);b.x=70*a,b.y=0},this),5..times(function(b){var c=tm.display.StarShape({width:40,height:40}).addChildTo(this.frontGroup);c.x=70*b,c.y=0,c.hide(),a.life>b&&c.show()},this)},decriment:function(){var a=UserData.get();a.life--,UserData.set(a);var b=this.frontGroup.children;b[a.life].tweener.clear().by({y:-100,alpha:-1},200).call(function(){this.flare("decrimented")},this)},recovery:function(){var a=UserData.get(),b=this.frontGroup.children;(5-a.life).times(function(c){var d=b[a.life+c];d.show(),d.alpha=0,d.scale.set(2,2),d.tweener.clear().wait(250*c).to({alpha:1,scaleX:1,scaleY:1},500)},this),a.life=5,UserData.set(a)}}),tm.define("WaveEffect",{superClass:"tm.display.CircleShape",init:function(){this.superInit({fillStyle:"white",strokeStyle:"transparent"}),this.tweener.to({scaleX:2,scaleY:2,alpha:0},250).call(function(){this.remove()},this),tm.asset.Manager.get("sounds/touch").clone().play()}}),tm.define("Enemy",{superClass:"tm.display.RoundRectangleShape",init:function(a,b){this.superInit({width:a,height:a,strokeStyle:"hsl({0}, 45%, 40%)".format(b),fillStyle:"hsl({0}, 45%, 20%)".format(b),lineWidth:8}),this.boundingType="rect",this.checkHierarchy=!1,this.size=a,this.runner=null,this.hp=ENEMY_SMALL_HP,this.erasing=!1,this.starCount=0,this.fireToBack=!0,this.entered=!1,this.on("enterframe",function(){!this.entered&&this.isInScreen()?this.entered=!0:this.entered&&!this.isInScreen()&&this.remove()})},damage:function(){this.hp-=1,this.hp<=0&&this.remove()},isInScreen:function(){return.5*-this.size<=this.x&&this.x<=W+.5*this.size&&.5*-this.size<=this.y&&this.y<=H+.5*this.size},update:function(){this.entered&&(this.fireToBack||this.y<Danmaku.param.target.y)&&(this.runner.x=this.x,this.runner.y=this.y,this.runner.update())}}),Enemy.types={},Enemy.types.small=["SmallEnemy0","SmallEnemy1","SmallEnemy2"],Enemy.types.middle=["MiddleEnemy0","MiddleEnemy1"],Enemy.types.large=["LargeEnemy0","LargeEnemy1","LargeEnemy2"],tm.define("SmallEnemy0",{superClass:"Enemy",init:function(a){this.superInit(50,240),this.runner=Danmaku.small[a].createRunner(Danmaku.param),this.hp=ENEMY_SMALL_HP,this.starCount=1,this.fireToBack=!1,this.tweener.by({y:H},1200,"easeOutQuad").wait(500).by({y:-H},1200,"easeInQuad")}}),tm.define("SmallEnemy1",{superClass:"Enemy",init:function(a){this.superInit(50,240),this.runner=Danmaku.small[a].createRunner(Danmaku.param),this.hp=ENEMY_SMALL_HP,this.starCount=1,this.fireToBack=!1;var b=tm.geom.Vector2(0,4),c=Danmaku.param.target;this.on("enterframe",function(){if(this.y<c.y){var a=tm.geom.Vector2.sub(c.position,this.position).normalize().mul(.2);b.add(a).normalize().mul(4)}this.position.add(b)})}}),tm.define("SmallEnemy2",{superClass:"Enemy",init:function(a){this.superInit(50,240),this.runner=Danmaku.small[a].createRunner(Danmaku.param),this.hp=ENEMY_SMALL_HP,this.starCount=1,this.fireToBack=!1;var b=tm.geom.Vector2(0,4),c=Danmaku.param.target;this.on("enterframe",function(){if(this.y<c.y){var a=tm.geom.Vector2.sub(c.position,this.position).normalize().mul(.2);b.add(a).normalize().mul(8)}this.position.add(b)})}}),tm.define("MiddleEnemy0",{superClass:"Enemy",init:function(a){this.superInit(100,10),this.runner=Danmaku.middle[a].createRunner(Danmaku.param),this.hp=ENEMY_MIDDLE_HP,this.erasing=!0,this.starCount=5,this.tweener.by({y:H},1200,"easeOutQuad").wait(3e3).call(function(){this.on("enterframe",function(){this.y+=1})}.bind(this))}}),tm.define("MiddleEnemy1",{superClass:"Enemy",init:function(a){this.superInit(100,130),this.runner=Danmaku.middle[a].createRunner(Danmaku.param),this.hp=ENEMY_MIDDLE_HP,this.erasing=!1,this.starCount=5,this.tweener.by({y:H},1200,"easeOutQuad").wait(3e3).call(function(){this.on("enterframe",function(){this.y+=1})}.bind(this))}}),tm.define("LargeEnemy0",{superClass:"Enemy",init:function(a){this.superInit(200,0),this.runner=Danmaku.large[a].createRunner(Danmaku.param),this.hp=ENEMY_LARGE_HP,this.erasing=!0,this.starCount=20,this.tweener.to({y:180},2400,"easeOutQuad"),this.on("enterframe",function(){this.y+=.25})}}),tm.define("LargeEnemy1",{superClass:"Enemy",init:function(a){this.superInit(200,0),this.runner=Danmaku.large[a].createRunner(Danmaku.param),this.hp=ENEMY_LARGE_HP,this.erasing=!0,this.starCount=20,this.one("enterframe",function(){this.tweener.by({x:W},2400,"easeOutQuad")}),this.on("enterframe",function(){this.y+=.05})}}),tm.define("LargeEnemy2",{superClass:"Enemy",init:function(a){this.superInit(200,0),this.runner=Danmaku.large[a].createRunner(Danmaku.param),this.hp=ENEMY_LARGE_HP,this.erasing=!0,this.starCount=20,this.one("enterframe",function(){this.tweener.by({x:-W},2400,"easeOutQuad")}),this.on("enterframe",function(){this.y+=.05})}}),tm.define("Bullet",{superClass:"tm.display.Sprite",init:function(a,b,c){this.superInit("bullet",64,64),this.baseFrameIndex=this.frameIndex=b,this.eraseFrameIndex=c,this.boundingType="circle",this.checkHierarchy=!1,this.radius=BULLET_BOUNDING_RADIUS,this.size=a,this.age=0,this.itemize=!1,this.erasing=!1,this.runner=null,this.pool=null,this.on("removed",function(){this.pool.push(this)})},reset:function(a){this.clearEventListener("enterframe"),this.image=tm.asset.Manager.get("bullet"),this.frameIndex=this.baseFrameIndex,this.erasing=!1,this.runner=a,this.position.setObject(a),this.itemize=!1,this.age=0},update:function(a){if(null!==this.runner){if(this.runner.update(),this.rotation=Math.atan2(this.runner.y-this.y,this.runner.x-this.x)*Math.RAD_TO_DEG,this.position.setObject(this.runner),this.age+=1,!this.erasing){var b=a.frame%8;b>4&&(b=8-b),this.frameIndex=this.baseFrameIndex+2+b}this.isInScreen()||this.parent&&this.remove()}},erase:function(a){!this.erasing&&this.visible?(this.itemize=a,this.image=tm.asset.Manager.get("bullet_erase"),this.frameIndex=this.eraseFrameIndex,this.erasing=!0,this.on("enterframe",function(){this.age%4===0&&(this.frameIndex+=1),this.frameIndex>=this.eraseFrameIndex+8&&this.parent&&this.remove()}),this.flare("erased")):!this.visible},isInScreen:function(){return.5*-this.size<=this.x&&this.x<=W+.5*this.size&&.5*-this.size<=this.y&&this.y<=H+.5*this.size}}),tm.define("BulletPool",{init:function(){this.redSmall=[],this.blueSmall=[],this.redLarge=[],this.blueLarge=[],this.redSmallCircle=[],this.blueSmallCircle=[],this.redLargeCircle=[],this.blueLargeCircle=[],this.invisible=[],BULLET_POOL_SIZE.times(function(){var a;a=Bullet(20,16,0),a.pool=this.redSmall,this.redSmall.push(a),a=Bullet(20,24,8),a.pool=this.blueSmall,this.blueSmall.push(a),a=Bullet(30,0,0),a.pool=this.redLarge,this.redLarge.push(a),a=Bullet(30,8,8),a.pool=this.blueLarge,this.blueLarge.push(a),a=Bullet(20,48,0),a.pool=this.redSmallCircle,this.redSmallCircle.push(a),a=Bullet(20,56,8),a.pool=this.blueSmallCircle,this.blueSmallCircle.push(a),a=Bullet(30,32,0),a.pool=this.redLargeCircle,this.redLargeCircle.push(a),a=Bullet(30,40,8),a.pool=this.blueLargeCircle,this.blueLargeCircle.push(a),a=Bullet(30,0,0),a.pool=this.invisible,a.visible=!1,this.invisible.push(a)}.bind(this)),this.pools=[this.redSmall,this.blueSmall,this.redLarge,this.blueLarge,this.redSmallCircle,this.blueSmallCircle,this.redLargeCircle,this.blueLargeCircle,this.invisible]},get:function(a,b){var c=this.pools[a].shift();return void 0!==c?(c.reset(b),b.onVanish=function(){c.parent&&c.remove()},c):(console.warn("弾が足りないニャ"),null)}}),tm.define("Player",{superClass:"tm.display.Shape",init:function(){this.superInit({width:80,height:80}),this.marker=null,this.blendMode="lighter",this.canvas.setLineStyle(3).setFillStyle("hsl(220, 30%, 30%)").setStrokeStyle("hsl(220, 90%, 90%)").fillTriangle(40,3,50,58,30,58).strokeTriangle(40,3,50,58,30,58).fillTriangle(30,25,25,58,5,68).strokeTriangle(30,25,25,58,5,68).fillTriangle(50,25,55,58,75,68).strokeTriangle(50,25,55,58,75,68),this.setPosition(.5*W,.8*H),this.roll=0,this.muteki=!1,this.positionHistory=[],this.shot=Shot(),this.bits=Array.range(4).map(function(a){return Bit(this,a)}.bind(this)),
this.alive=!0},damage:function(){this.muteki||(this.muteki=!0,this.flare("missed"))},onadded:function(){this.bits.forEach(function(a){this.parent.addChildAt(a,0)}.bind(this)),this.positionHistory=Array.range((BIT_COUNT+1)*BIT_DISTANCE+BIT_FIRST_DISTANCE).map(function(){return{x:this.x,y:this.y}}.bind(this))},update:function(a){var b=this.x,c=this.y;this.alive&&!a.pointing.getPointingStart()&&a.pointing.getPointing()&&this.position.add(a.pointing.deltaPosition.mul(PLAYER_SPEED)),this.x=Math.clamp(this.x,6,W-6),this.y=Math.clamp(this.y,6,H-6),b<this.x?this.roll-=1:this.x<b?this.roll+=1:0!==this.roll&&(this.roll+=-Math.abs(this.roll)/this.roll),this.roll=Math.clamp(this.roll,-5,5),this.scaleX=1-.15*Math.abs(this.roll),this.marker.position.setObject(this),(this.x!==b||this.y!==c)&&(this.positionHistory.push({x:this.x,y:this.y}),this.positionHistory.length>(BIT_COUNT+1)*BIT_DISTANCE+BIT_FIRST_DISTANCE&&this.positionHistory.shift()),null==this.shot.parent&&this.shot.setPosition(this.x,this.y).addChildTo(this.parent),this.alpha=this.muteki?Math.floor(a.frame/2)%2*.75+.25:1}}),tm.define("Bit",{superClass:"tm.display.RectangleShape",init:function(a,b){this.superInit({width:30,height:30,strokeStyle:"hsl(100, 90%, 90%)",fillStyle:"hsl(100, 30%, 30%)"}),this.player=a,this.index=b,this.shot=Shot()},update:function(){this.rotation+=20;var a=this.player.positionHistory[6*(1+this.index)];void 0===a&&(a={x:this.player.x,y:this.player.y}),this.position.setObject(a),null==this.shot.parent&&this.shot.setPosition(this.x,this.y).addChildTo(this.parent)}}),tm.define("PlayerCollisionCircle",{superClass:"tm.display.CircleShape",init:function(){this.superInit({width:18,height:18,strokeStyle:"hsl(150, 90%, 90%)",fillStyle:"hsl(150, 30%, 30%)",lineWidth:4})},update:function(a){this.setScale(1+.2*Math.sin(.4*a.frame))}}),tm.define("Shot",{superClass:"tm.display.RectangleShape",init:function(){this.superInit({width:10,height:30,strokeStyle:"hsl(220, 90%, 90%)",fillStyle:"hsl(220, 30%, 30%)"}),this.blendMode="lighter",this.checkHierarchy=!1},update:function(){this.y-=SHOT_SPEED,this.y<-25&&this.remove()}});var Explosion=function(a,b,c){6..times(function(){var d=Math.rand(0,360),e=Math.randf(.8,1.5);8..times(function(f){var g=tm.geom.Vector2().setAngle(d,(1+3*f)*e),h=Explosion.pool.shift();h&&h.emit(b,c,g).setScale(2-.2*f).addChildTo(a)})})};Explosion.Particle=tm.createClass({superClass:tm.display.RectangleShape,init:function(){this.superInit({width:40,height:40,strokeStyle:"hsl(30, 65%, 60%)",fillStyle:"hsl(30, 65%, 30%)"}),this.setBlendMode("lighter"),this.v=null},emit:function(a,b,c){return this.setPosition(a,b),this.setAlpha(.4),this.v=c,this},update:function(){this.position.add(this.v),this.v.mul(.9),this.alpha*=.9,this.alpha<.001&&(this.remove(),Explosion.pool.push(this))}}),Explosion.pool=Array.range(256).map(function(){return Explosion.Particle()});var PlayerExplosion=function(a,b,c){var d=["sound/exp1","sound/exp2","sound/exp3"].pickup();tm.sound.SoundManager.play(d),6..times(function(){var d=Math.rand(0,360),e=Math.randf(.8,1.5);8..times(function(f){var g=tm.geom.Vector2().setAngle(d,(1+4*f)*e),h=PlayerExplosion.pool.shift();h&&h.emit(b,c,g).setScale(2-.2*f).addChildTo(a)})})};PlayerExplosion.Particle=tm.createClass({superClass:tm.display.RectangleShape,init:function(){this.superInit({width:60,height:60,strokeStyle:"hsl(230, 65%, 60%)",fillStyle:"hsl(230, 65%, 30%)"}),this.setBlendMode("lighter"),this.v=null},emit:function(a,b,c){return this.setPosition(a,b),this.setAlpha(.4),this.v=c,this},update:function(){this.position.add(this.v),this.v.mul(.95),this.alpha*=.95,this.alpha<.001&&(this.remove(),PlayerExplosion.pool.push(this))}}),PlayerExplosion.pool=Array.range(256).map(function(){return PlayerExplosion.Particle()}),tm.define("StarItem",{superClass:"tm.display.StarShape",init:function(a){this.superInit({width:30,height:30}),this.pool=a,this.target=null,this.flying=!1,this.boundingType="circle",this.radius=30,this.checkHierarchy=!1,this.fv=tm.geom.Vector2(0,0)},onremoved:function(){this.pool.stars.push(this)},update:function(){if(this.flying)this.position.add(this.fv),this.fv.mul(.7),this.fv.lengthSquared()<.1*.1&&(this.flying=!1);else if(this.target){var a=tm.geom.Vector2.sub(this.target,this);a.normalize().mul(10),this.position.add(a)}else this.y+=3;H+200<this.y&&this.remove()},setTarget:function(a){this.target=a}}),tm.define("StarItemPool",{init:function(){this.stars=Array.range(1024).map(function(){return StarItem(this)}.bind(this))},get:function(){var a=this.stars.shift();return void 0!==a?(a.target=null,a):null}}),tm.define("TitleScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.fromJSON({children:{backgroundLayer:{type:"CanvasLayer",init:"#back",renderInterval:60},bg:{type:"tm.display.RectangleShape",init:{width:SCREEN_WIDTH,height:SCREEN_HEIGHT,strokeStyle:"transparent",fillStyle:"black"},originX:0,originY:0},title1:{type:"tm.display.Label",init:["よけろ！",60],x:.25*SCREEN_WIDTH,y:.2*SCREEN_HEIGHT,rotation:-15,fillStyle:"hsl(40, 40%, 50%)"},title2:{type:"tm.display.Label",init:["弾幕さん",80],x:.4*SCREEN_WIDTH,y:.3*SCREEN_HEIGHT,fillStyle:"hsl(10, 40%, 50%)"},title3:{type:"tm.display.Label",init:["Ａｐｐ",80],x:.75*SCREEN_WIDTH,y:.3*SCREEN_HEIGHT,fillStyle:"hsl(60, 40%, 80%)"},life:{type:"Life",x:180,y:.45*SCREEN_HEIGHT},playButton:{type:"PlayButton",init:{size:120},x:.5*SCREEN_WIDTH,y:.6*SCREEN_HEIGHT,update:function(a){this.setScale(1+.05*Math.sin(.15*a.frame))}},shareButton:{type:"ShareButton",init:{size:80,message:TITLE_TWEET,url:APP_URL},x:.25*SCREEN_WIDTH,y:.8*SCREEN_HEIGHT,onpointingend:function(){this.blink(),tm.sound.SoundManager.play("sound/ok")}},rankButton:{type:"RankingButton",init:{size:80},x:.5*SCREEN_WIDTH,y:.85*SCREEN_HEIGHT,onpointingend:function(){this.blink(),tm.sound.SoundManager.play("sound/ok")}},adButton:{type:"AdButton",init:{size:80},x:.75*SCREEN_WIDTH,y:.8*SCREEN_HEIGHT,onpointingend:function(){this.blink(),tm.sound.SoundManager.play("sound/ok")}},hmdLayer:{type:"CanvasLayer",init:"#hmd",renderInterval:60,visible:!1}}});var a=this;[this.playButton,this.shareButton,this.adButton,this.rankButton].forEach(function(a){a.y-=SCREEN_HEIGHT,a.tweener.clear().by({y:SCREEN_HEIGHT},1200+tm.util.Random.randint(0,400),"easeOutBounce")}),this.playButton.onpush=function(){UserData.hasLife()?(tm.sound.SoundManager.play("sound/ok"),this.setInteractive(!1).blink(),"release"===TARGET?(a.life.ondecrimented=function(){a.startGame()},a.life.decriment()):a.startGame()):(tm.sound.SoundManager.play("sound/cancel"),a.shareButton.blink(),a.adButton.blink())},this.adButton.onaded=function(){this.life.recovery()}.bind(this),this.shareButton.onshared=function(){this.life.recovery()}.bind(this)},startGame:function(){var a=this;tm.display.RectangleShape({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,fillStyle:"black",strokeStyle:"transparent"}).setOrigin(0,0).setAlpha(0).addChildTo(a).tweener.fadeIn(1e3).call(function(){a.app.popScene()})}}),tm.define("GameScene",{superClass:"tm.app.Scene",init:function(){var a=this;this.superInit(),this.fromJSON({children:{erasingTimer:{type:"tm.app.Element"},backgroundLayer:{type:"CanvasLayer",init:"#back",renderInterval:4,children:{background:{type:"Background"},space:{type:"tm.display.RectangleShape",init:{width:SCREEN_WIDTH,height:SCREEN_HEIGHT-H,strokeStyle:"transparent",fillStyle:"hsl(220, 30%, 50%)"},originX:0,originY:0,y:H}}},enemyLayer:{type:"GameSceneLayer",counter:0,update:function(){this.counter+=a.weight,this.counter>=1?(this.counter-=1,this.children.forEach(function(a){a.wakeUp()})):this.children.forEach(function(a){a.sleep()})}},playerLayer:{type:"GameSceneLayer",children:{player:{type:"Player"}}},bulletLayer:{type:"GameSceneLayer",counter:0,update:function(){this.counter+=a.weight,this.counter>=1?(this.counter-=1,this.children.forEach(function(a){a.wakeUp()})):this.children.forEach(function(a){a.sleep()})}},topLayer:{type:"GameSceneLayer",children:{playerMarker:{type:"PlayerCollisionCircle"}}},hmdLayer:{type:"CanvasLayer",init:"#hmd",renderInterval:3,children:{scoreLabel:{type:"tm.display.Label",init:["0 点",30],align:"right",baseline:"top",x:SCREEN_WIDTH-20,y:20,displayScore:0,bs:0,unit:0,update:function(){this.bs!==a.score&&(this.unit=Math.floor((a.score-this.displayScore)/9)),this.unit<a.score-this.displayScore?this.displayScore+=this.unit:this.displayScore<a.score&&(this.displayScore=a.score),this.text=this.displayScore+" 点",this.bs=a.score}},stepLabel:{type:"tm.display.Label",init:["ステップ 0",30],align:"right",baseline:"top",x:SCREEN_WIDTH-20,y:60,update:function(){this.text="ステップ "+a.step}},zankiLabel:{type:"tm.display.Label",init:["残機 2",30],align:"left",baseline:"top",x:20,y:20,update:function(){this.text="残機 "+Math.max(a.zanki-1,0)}}}}}}),this.score=0,this.zanki=3,this.weight=1,this.bulletPool=BulletPool(),this.starPool=StarItemPool(),this.player=this.playerLayer.player,this.player.marker=this.topLayer.playerMarker,this.player.on("missed",function(){tm.sound.SoundManager.play("sound/miss"),PlayerExplosion(a.backgroundLayer.background.fg,this.x,this.y),a.zanki-=1,a.zanki>0?this.tweener.clear().wait(3e3).call(function(){this.muteki=!1}.bind(this)):(this.muteki=!1,this.alive=!1,a.playerLayer.hide(),a.topLayer.playerMarker.hide(),a.tweener.wait(3e3).call(function(){a.gameover()}))}),Danmaku.param.target=this.player,Danmaku.param.createNewBullet=function(b,c){var d=a.bulletPool.get(c.type,b);null!=d&&(a.bullets.push(d),d.onerased=function(){if(this.itemize){var b=a.starPool.get();null!==b&&(b.setPosition(this.x,this.y).addChildTo(a.backgroundLayer.background.fg),b.flying=!1,a.stars.push(b))}},d.onremoved=function(){a.bullets.erase(this)},d.addChildTo(a.bulletLayer))},this.mt=new MersenneTwister(Math.rand(1,MT_SEED)),this.mt.range=function(a,b){return a+this.nextInt(b-a)},this.mt.rangef=function(a,b){return a+this.next()*(b-a)},this.mt.pickup=function(a){return a[this.nextInt(a.length)]},this.countDown=200,this.enemyInterval=200,this.step=0,this.erasingBullets=!1,this.enemies=[],this.shots=[this.player.shot,this.player.bits[0].shot,this.player.bits[1].shot,this.player.bits[2].shot,this.player.bits[3].shot],this.bullets=[],this.stars=[],tm.sound.SoundManager.playMusic("sound/bgm"),this.on("exit",function(){tm.sound.SoundManager.stopMusic()})},eraseAllBullets:function(a){this.bullets.forEach(function(b){b.erase(a)})},update:function(){if(this.player.alive&&this.testHit(),this.countDown-=1,this.countDown<=0){this.enemyInterval=Math.max(this.enemyInterval-ENEMY_INTERVAL_DECR,40),this.step+=1,Danmaku.param.speedRate=1+.1*Math.sqrt(.05*this.step);var a=this.mt.nextInt(100);50>a?(this._launchSmall(),this.countDown=1*this.enemyInterval):80>a?(this._launchMiddle(),this.countDown=1.5*this.enemyInterval):(this._launchLarge(),this.countDown=2.5*this.enemyInterval)}this.weight=this.bullets.length>200?Math.max(1-(this.bullets.length-200)/800,.1):1,(this.player.muteki||this.erasingBullets)&&this.eraseAllBullets(!1)},gameover:function(){var a=this;tm.display.RectangleShape({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,fillStyle:"black",strokeStyle:"transparent"}).setOrigin(0,0).setAlpha(0).addChildTo(this.hmdLayer).tweener.fadeIn(3e3).call(function(){a.nextArguments={score:a.score},a.app.popScene()})},addScore:function(a){Math.floor(this.score/EXTEND_SCORE)<Math.floor((this.score+a)/EXTEND_SCORE)&&(this.zanki+=1,tm.sound.SoundManager.play("sound/extend")),this.score+=a},testHit:function(){this.testPlayerVsStarItem(),this.testShotVsEnemy(),this.testPlayerVsBullet()},testPlayerVsStarItem:function(){for(var a,b=this.player,c=this.stars.slice(),d=0,e=c.length;e>d;d++)a=c[d],a.isHitPoint(b.x,b.y)?(a.parent&&a.remove(),this.stars.erase(a),this.addScore(100),tm.sound.SoundManager.play("sound/score")):(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)<4e4&&a.setTarget(b)},testShotVsEnemy:function(){for(var a,b,c=this.shots.slice(),d=this.enemies.slice(),e=0,f=d.length;f>e;e++){b=d[e];for(var g=0,h=c.length;h>g;g++)if(a=c[g],null!=a.parent&&b.isHitPoint(a.x,a.y)&&(b.damage(),a.remove(),tm.sound.SoundManager.play("sound/hit"),null==b.parent)){Explosion(this.backgroundLayer.background.fg,b.x,b.y);var i=["sound/exp1","sound/exp2","sound/exp3"].pickup();tm.sound.SoundManager.play(i),b.erasing&&(this.erasingBullets=!0,this.erasingTimer.tweener.clear().wait(500).call(function(){this.erasingBullets=!1}.bind(this)),this.eraseAllBullets(!0));for(var j=0;j<b.starCount;j++){var k=this.starPool.get();null!==k&&(k.setPosition(b.x,b.y).addChildTo(this.backgroundLayer.background.fg),k.flying=!0,k.fv=tm.geom.Vector2().setRandom(-135,-45,50),this.stars.push(k))}break}}},testPlayerVsEnemy:function(){for(var a,b=this.player,c=0,d=this.enemies.length;d>c;c++)a=this.enemies[c],a.isHitPoint(b.x,b.y)&&(b.damage(),this.eraseAllBullets(!1))},testPlayerVsBullet:function(){for(var a,b=this.player,c=this.bullets.slice(),d=0,e=c.length;e>d;d++)a=c[d],a.visible&&!a.erasing&&a.isHitPoint(b.x,b.y)&&(b.damage(),a.remove(),this.eraseAllBullets(!1))},_launchSmall:function(){var a=this,b=this.mt.nextInt(Danmaku.small.length),c=5*(1+this.mt.nextInt(3)),d=this.mt.pickup(Enemy.types.small);c.times(function(){var c=tm.using(d)(b).setPosition(this.mt.range(60,W-60),-H*this.mt.rangef(.4,.8));c.onadded=function(){a.enemies.push(this)},c.onremoved=function(){a.enemies.erase(this)},EnemySpawner(c,this.mt.range(1,1e3)).addChildTo(this.enemyLayer)}.bind(this))},_launchMiddle:function(){var a=this,b=this.mt.nextInt(Danmaku.middle.length),c=2+this.mt.nextInt(2),d=this.mt.pickup(Enemy.types.middle);c.times(function(){var c=tm.using(d)(b).setPosition(this.mt.range(120,W-120),-H*this.mt.rangef(.6,.9));c.onadded=function(){a.enemies.push(this)},c.onremoved=function(){a.enemies.erase(this)},EnemySpawner(c,this.mt.range(1,1e3)).addChildTo(this.enemyLayer)}.bind(this))},_launchLarge:function(){var a=this,b=this.mt.nextInt(Danmaku.large.length),c=this.mt.pickup(Enemy.types.large),d=tm.using(c)(b);"LargeEnemy0"===c?d.setPosition(this.mt.range(180,W-180),-H*Math.randf(.5,.8)):"LargeEnemy1"===c?d.setPosition(-this.mt.range(.2*W,.8*W),180):d.setPosition(W+this.mt.range(.2*W,.8*W),180),d.onadded=function(){a.enemies.push(this)},d.onremoved=function(){a.enemies.erase(this)},d.addChildTo(this.enemyLayer)},onpoped:function(){this.backgroundLayer.clear().setVisible(!1),this.hmdLayer.clear().setVisible(!1)}}),tm.define("EnemySpawner",{superClass:"tm.display.CanvasElement",init:function(a,b){this.superInit(),this.enemy=a,this.tweener.wait(b).call(function(){this.spawn()}.bind(this))},spawn:function(){this.parent.addChild(this.enemy),this.remove()}}),tm.define("GameSceneLayer",{superClass:"tm.display.CanvasElement",init:function(){this.superInit(),this.fromJSON({originX:0,originY:0,width:W,height:H,clipping:!0})}}),tm.define("ResultScene",{superClass:"tm.app.Scene",init:function(a){this.superInit(a);var b=this,c=UserData.get(),d=c.bestScore?c.bestScore:0,e=a.score>d;e&&(c.bestScore=a.score,UserData.set(c)),this.sendHighScore(c.bestScore),this.fromJSON({children:{backgroundLayer:{type:"CanvasLayer",init:"#back",renderInterval:60,children:{bd:{type:"tm.display.RectangleShape",init:{width:SCREEN_WIDTH,height:SCREEN_HEIGHT,fillStyle:"black",strokeStyle:"transparent"},originX:0,originY:0}}},title:{type:"tm.display.Label",init:["成績",50],x:.5*SCREEN_WIDTH,y:.1*SCREEN_HEIGHT,fillStyle:"rgb(230, 230, 230)"},scoreTitleLabel:{type:"tm.display.Label",init:["スコア ",30],align:"left",x:.2*SCREEN_WIDTH,y:.2*SCREEN_HEIGHT,fillStyle:"rgb(230, 230, 230)"},scoreLabel:{type:"tm.display.Label",init:[a.score+"点",30],align:"right",x:.8*SCREEN_WIDTH,y:.2*SCREEN_HEIGHT,fillStyle:"rgb(230, 230, 230)"},highscoreTitleLabel:{type:"tm.display.Label",init:["ベスト ",30],align:"left",x:.2*SCREEN_WIDTH,y:.3*SCREEN_HEIGHT,fillStyle:"rgb(230, 230, 230)"},highscoreLabel:{type:"tm.display.Label",init:[c.bestScore+"点",30],align:"right",x:.8*SCREEN_WIDTH,y:.3*SCREEN_HEIGHT,fillStyle:"rgb(230, 230, 230)"},updateLabel:{type:"tm.display.Label",init:["new record!!",27],align:"right",x:.8*SCREEN_WIDTH,y:.3*SCREEN_HEIGHT-30,visible:e,fillStyle:"red",update:function(a){this.alpha=.5+Math.floor(a.frame/3)%2*.5}},life:{type:"Life",x:180,y:.45*SCREEN_HEIGHT},shareButton:{type:"ShareButton",init:{size:80,message:RESULT_URL.format(a),url:APP_URL},x:.25*SCREEN_WIDTH,y:.8*SCREEN_HEIGHT,onpointingend:function(){this.blink(),tm.sound.SoundManager.play("sound/ok")}},homeButton:{type:"HomeButton",init:{size:120},x:.5*SCREEN_WIDTH,y:.6*SCREEN_HEIGHT,onpointingend:function(){this.blink(),tm.sound.SoundManager.play("sound/ok"),this.setInteractive(!1),b.exit()}},rankButton:{type:"RankingButton",init:{size:80},x:.5*SCREEN_WIDTH,y:.85*SCREEN_HEIGHT,onpointingend:function(){this.blink(),tm.sound.SoundManager.play("sound/ok")}},adButton:{type:"AdButton",init:{size:80},x:.75*SCREEN_WIDTH,y:.8*SCREEN_HEIGHT,onpointingend:function(){this.blink(),tm.sound.SoundManager.play("sound/ok")}},hmdLayer:{type:"CanvasLayer",init:"#hmd",renderInterval:60,visible:!1}}}),this.adButton.onaded=function(){this.life.recovery()}.bind(this),this.shareButton.onshared=function(){this.life.recovery()}.bind(this),0===tm.util.Random.randint(0,5)&&setTimeout(function(){showAd()},1e3)},sendHighScore:function(a){if(window.gamecenter){var b={score:a,leaderboardId:BOARD_ID};gamecenter.submitScore(function(){},function(){},b)}},exit:function(){var a=this;tm.display.RectangleShape({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,fillStyle:"black",strokeStyle:"transparent"}).setOrigin(0,0).setAlpha(0).addChildTo(this).tweener.fadeIn(1e3).call(function(){a.app.popScene()})}}),tm.main(function(){var a=Application();a.run();var b=tm.game.LoadingScene({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,assets:ASSETS,nextScene:ManagerScene});a.replaceScene(b)}),tm.define("ManagerScene",{superClass:"tm.game.ManagerScene",init:function(){tm.display.Label["default"].fontFamily="unifont",tm.sound.SoundManager.volume=.2,tm.sound.SoundManager.musicVolume=.2,tm.dom.Element("#back").visible=!0,tm.dom.Element("#hmd").visible=!0,this.superInit({startLabel:"title",scenes:[{label:"title",className:"TitleScene",nextLabel:"game"},{label:"game",className:"GameScene",nextLabel:"result"},,{label:"result",className:"ResultScene",nextLabel:"title"}]})}});